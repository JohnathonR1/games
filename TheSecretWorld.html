<!DOCTYPE html>
<html>
<!-- Program exported to HTML using the KA Project Exporter by @MushyAvocado 
https://www.khanacademy.org/computer-programming/ka-project-exporter/5195486791385088
-->

<!-- All code written by Green Ghost -->

<!-- Profile Link Here: https://www.khanacademy.org/profile/kaid_145655330786057731504264 -->
	
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>The Secret World</title>
	<style>
		
		
		/* Change the color as you want */
		:root {
			--background-color: #000000;
		}
		
		body {
		    background-color: var(--background-color);
		}
		
		html, body, #wrapper {
			width: 100%;
		    height: 100%;
			margin: 0px;
			padding: 0px;
		}
		
		
		canvas {
			width: fit-content;
			height: fit-content;
		}
		
		canvas:focus {
			outline: none;
		}
		
		/* Automatically fits to the remaining height and centers the canvas it contains */
		#wrapper {
			padding: 0px;
			margin: 0px;
			display: flex;
			justify-content: center;
			align-items: center;
			width: 100%;
		}

        .back-btn {
            position: absolute;
            top: 90%;
            left: 90%;
        }

        #Karlson-back-btn {
            text-align: center;
            color: black;
            border-radius: 7px;
            width: 9%;
            height: 7%;
            background-color: white;
            transition: 0.35s;
        }

        #Karlson-back-btn:hover {
            cursor: pointer;
            background-color: darkgrey;
        }
		
</style>
</head>
<body id="wrapper">
    
    <a href="index.html">
        <button class="back-btn" id="Karlson-back-btn" type="button">‚Üê Back</button>
    </a>
    
    <!-- Canvases with a class of "sketch" are applied to the program in the order importPJS() is called. -->
    <canvas class="sketch"></canvas>
	<!-- Load the PJS library -->
	<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/Khan/processing-js@master/processing.js"></script>
	<!-- The exporter script must be loaded before the program script -->
	<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/Mushy-Avocado/KA-exporter@main/exporter.js"></script>
	<!-- Run Khan Academy program and import PJS -->
	<script type="application/javascript">
		
		
		function program() {
		    
		    title("The Secret World");
		    size(600, 600);
		    
		    // All code goes here
			/** The Secret World, my thirtieth game! **/
			
			/*
			ABOUT
			Inspiration from the games Coma and Limbo, and also from Coyote's Neinei games.
			
			I finished this a year after I started it. Two days before release it was plagiarized, and later that day I added a few more touches.
			
			A huge thanks to all the people who saw this program in the developement stage!
			
			DESCRIPTION
			The game encompasses the story of Benjamin, a boy. Discover his strange journeys in The Secret World!
			
			CONTROLS
			Arrow keys or WASD to move around. Walk near people to talk to them.
			
			Started: 5/1/2018
			Finished: 5/1/2019
			Released: 5/6/2019
			
			5/6/2019: Released the game a year after I started it! I worked hard on it for about a month.
			About an hour after release and it already has 44 votes and is at the top of the hotlist. 
			It's been about 4.5 hours and it has 161 votes!
			Now it's been less than 6.5 hours and is at 207 votes!
			After less than thirteen hours it has 300 votes and 97 spin-offs! 
			5/7/2019: 551 votes, 195 spin-offs! Top of the hotlist! I've been fixing bugs.
			5/8/2019: 747 votes, 273 spin-offs! Top of the hotlist!
			5/9/2019: 970 votes, 343 spin-offs! Top of the hotlist!
			5/10/2019: Day five at the top of the hotlist! 1120 votes, 406 spin-offs!
			5/11/2019: 1165 votes, 421 spin-offs! Started day six at the top of the hotlist, but dropped to second.
			5/12/2019: 1179 votes!
			5/13/2019: 1228 votes, 446 spin-offs! Low on the hotlist.
			5/14/2019: 1256 votes! Off the first page of the hotlist.
			5/16/2019: 1278 votes!
			8/7/2019: 1435 votes! Updated the grass constructor!
			9/27/2019: 1517 votes!
			2/7/2020: 1690 votes! Added some code (based on an article by Tyler Glaiel) to make the game run at 60fps!
			4/29/2020: 1781 votes! Stuck in quarantine, so I changed the wavy design behind the header using curveVertex().
			12/12/2020: 2006 votes! Hit a landmark!
			2/27/2021: 2406 votes!
			3/22/2021: 2500 votes!
			5/24/2021: 2716 votes!
			3/3/2022: 3039 votes!
			5/5/2023: 3452 votes!
			1/9/2024: 3600 votes!
			*/
			
			// Sets up some things.
			smooth();
			randomSeed(25);
			size(600, 600, P2D);
			
			/** Variables **/
			// {
			    var scene, game, menu, continuePage, introPage, codeScene, credits, creditsPage, resetGame;
			    var click = false, overButton;
			    var speed = 3.5;
			    var speed2 = speed * speed;
			    var curScene = 0, cameraY = 1;
			    var loaded = loaded || false;
			    var Player, Block, Land, Flower, Sliver, Particle, windLeaf, windGrass, Fish, Rain, player;
			    var bgNoiseAmt = 0, starSize;
			    var x = 300, y = 350, Size = 30;
			    var keys = [];
			    var dotSize;
			    var fonts = [
			        createFont("monospace"),
			        createFont("serif Bold"),
			        createFont("FreeSans")
			    ];
			    var start = 6, change = 0.3;
			    var flowers = [], flowerX = 510, flowerY = 60, foundFlower;
			    var lightningAmount = 0;
			    var blockFlash = {
			        opac : 0,
			        mode : "out",
			        pack : function(block) {
			            noStroke();
			            fill(255, 255, 255, this.opac);
			            rect(0, 0, width, height);
			            if (this.mode === "out") {
			                this.opac -= 5;
			            } else {
			                this.opac += 5;
			                if (this.opac >= 255) {
			                    this.mode = "out";
			                    block.y = 30;
			                    player.items.splice(player.getItem("orb"), 1);
			                }
			            }
			            this.opac = constrain(this.opac, 0, 255);
			        }
			    };
			    
			    // Timing variables
			    var deltaTime = millis() + 1, prevTime = millis();
			    var allTime = 0;
			
			    // Prevent the program from crashing.
			    var restarted = restarted || false;
			    if (restarted) {
			        throw {
			            message : "Sorry, restarting the program will most likely end in it crashing. Please refresh this page."
			        };
			    }
			    restarted = true;
			// }
			
			// Scene transition
			var sceneChange = (function() {
			    sceneChange = {
			        nextScene: menu,
			        fade: 255,
			        changeSpeed: 10,
			        mode: "out"
			    };
			    
			    sceneChange.display = function() {
			        fill(0, 0, 0, this.fade);
			        noStroke();
			        rect(0, 0, width, height);
			    };
			    
			    sceneChange.reset = function(nextScene) {
			        if (this.mode === "out") {
			            this.fade = 0;
			            this.mode = "in";
			            this.nextScene = nextScene;
			        }
			    };
			    
			    sceneChange.pack = function() {
			        if (this.mode === "in") {
			            this.fade += this.changeSpeed;
			            if (this.fade >= 255) {
			                this.mode = "out";
			                scene = this.nextScene;
			                if (scene === game) {
			                    // Fix time
			                    deltaTime = millis() + 1;
			                    prevTime = millis();
			                    allTime = 0;
			                }
			            }
			        } else {
			            this.fade -= this.changeSpeed;
			        }
			        this.display();
			    };
			    
			    return sceneChange;
			})();
			
			// Smooth motion method.
			Number.prototype.smooth = function(dest, div) {
			    return (dest - this) / div;
			};
			
			// Gets a point on an ellipse based on a given x position.
			var symbol;
			var getEllipsePoint = function(x1, y1, x2, y2, w, h, mode) {
			    x1 -= x2;
			    y1 -= y2;
			    
			    x1 /= w / 2;
			    y1 /= h / 2;
			    
			    if (mode === "y") {
			        symbol = y1 < 0 ? -1 : 1;
			        x1 = asin(x1);
			        y1 = y2 + cos(x1) * h / 2 * symbol;
			        return y1;
			    } else if (mode === "x") {
			        symbol = x1 < 0 ? -1 : 1;
			        y1 = acos(y1);
			        x1 = x2 + sin(y1) * w / 2 * symbol;
			        return x1;
			    }
			    
			    return 0;
			};
			
			// Images
			var backgroundImages = backgroundImages || [], foregroundImages = foregroundImages || [];
			
			/** Font **/
			var align = CENTER;
			var scriptFont = function(txt, x, y, w, h, c) {
			    strokeJoin(ROUND);
			    strokeCap(ROUND);
			    stroke(c);
			    pushMatrix();
			    translate(x, y);
			    scale(w / 100, h / 100);
			    if (align === CENTER) {
			        for (var i = 0; txt.charAt(i) !== "\n" && i < txt.length; i++) {
			            translate(-15, 0);
			        }
			    }
			    noFill();
			    var scriptX = 0;
			    for (var i = 0; i < txt.length; i++) {
			        if (txt.charAt(i) === "\n") {
			            if (align === CENTER) {
			                translate(-scriptX, 35);
			            }
			            scriptX = 0;
			            continue;
			        }
			        switch (txt.charAt(i)) {
			            case "A":
			                beginShape();
			                vertex(20, 30);
			                vertex(10, 0);
			                vertex(0, 30);
			                vertex(3.5, 20);
			                vertex(20, 20);
			                endShape();
			                break;
			            case "B":
			                beginShape();
			                vertex(0, 30);
			                vertex(0, 0);
			                bezierVertex(20, 0, 25, 15, 0, 15);
			                bezierVertex(25, 15, 25, 30, 0, 30);
			                endShape();
			                break;
			            case "C":
			                arc(15, 15, 30, 30, 70, 290);
			                break;
			            case "D":
			                beginShape();
			                vertex(0, 30);
			                vertex(0, 0);
			                bezierVertex(30, 5, 30, 30, 0, 30);
			                endShape();
			                break;
			            case "E":
			                beginShape();
			                vertex(20, 0);
			                vertex(0, 0);
			                vertex(0, 15);
			                vertex(15, 15);
			                vertex(0, 15);
			                vertex(0, 30);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "F":
			                beginShape();
			                vertex(20, 0);
			                vertex(0, 0);
			                vertex(0, 15);
			                vertex(15, 15);
			                vertex(0, 15);
			                vertex(0, 30);
			                endShape();
			                break;
			            case "G":
			                beginShape();
			                vertex(16, 3);
			                bezierVertex(15, 0, 13, 0, 10, 0);
			                bezierVertex(-5, 0, -5, 30, 10, 30);
			                bezierVertex(15, 30, 22, 25, 22, 18);
			                vertex(10, 18);
			                endShape();
			                break;
			            case "H":
			                beginShape();
			                vertex(0, 0);
			                vertex(0, 30);
			                vertex(0, 15);
			                vertex(20, 15);
			                vertex(20, 30);
			                vertex(20, 0);
			                endShape();
			                break;
			            case "I":
			                beginShape();
			                vertex(5, 0);
			                vertex(15, 0);
			                vertex(10, 0);
			                vertex(10, 30);
			                vertex(15, 30);
			                vertex(5, 30);
			                endShape();
			                break;
			            case "J":
			                beginShape();
			                vertex(10, 0);
			                vertex(20, 0);
			                vertex(15, 0);
			                vertex(15, 20);
			                bezierVertex(15, 35, 0, 35, 0, 20);
			                endShape();
			                break;
			            case "K":
			                beginShape();
			                vertex(0, 0);
			                vertex(0, 15);
			                vertex(20, 0);
			                vertex(0, 15);
			                vertex(20, 30);
			                vertex(0, 15);
			                vertex(0, 30);
			                endShape();
			                break;
			            case "L":
			                beginShape();
			                vertex(0, 0);
			                vertex(0, 30);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "M":
			                beginShape();
			                vertex(0, 30);
			                vertex(0, 0);
			                vertex(10, 10);
			                vertex(20, 0);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "N":
			                beginShape();
			                vertex(0, 30);
			                vertex(0, 0);
			                vertex(20, 30);
			                vertex(20, 0);
			                endShape();
			                break;
			            case "O":
			                ellipse(10, 15, 20, 30);
			                break;
			            case "P":
			                beginShape();
			                vertex(0, 30);
			                vertex(0, 0);
			                vertex(10, 0);
			                bezierVertex(25, 0, 25, 15, 10, 15);
			                vertex(0, 15);
			                endShape();
			                break;
			            case "Q":
			                
			                beginShape();
			                vertex(10, 0);
			                bezierVertex(-5, 0, -5, 30, 10, 30);
			                bezierVertex(10, 30, 17, 30, 17, 27);
			                vertex(10, 20);
			                vertex(20, 30);
			                vertex(17, 27);
			                bezierVertex(25, 15, 18, 0, 10, 0);
			                endShape();
			                break;
			            case "R":
			                beginShape();
			                vertex(0, 30);
			                vertex(0, 0);
			                vertex(10, 0);
			                bezierVertex(25, 0, 25, 15, 10, 15);
			                vertex(0, 15);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "S":
			                beginShape();
			                vertex(20, 10);
			                bezierVertex(20, -5, 0, -5, 0, 10);
			                bezierVertex(0, 15, 20, 15, 20, 20);
			                bezierVertex(20, 35, 0, 35, 0, 20);
			                endShape();
			                break;
			            case "T":
			                beginShape();
			                vertex(20, 0);
			                vertex(0, 0);
			                vertex(10, 0);
			                vertex(10, 30);
			                endShape();
			                break;
			            case "U":
			                beginShape();
			                vertex(0, 0);
			                vertex(0, 20);
			                bezierVertex(0, 35, 20, 35, 20, 20);
			                vertex(20, 0);
			                endShape();
			                break;
			            case "V":
			                beginShape();
			                vertex(0, 0);
			                vertex(10, 30);
			                vertex(20, 0);
			                endShape();
			                break;
			            case "W":
			                beginShape();
			                vertex(0, 0);
			                vertex(0, 30);
			                vertex(10, 15);
			                vertex(20, 30);
			                vertex(20, 0);
			                endShape();
			                break;
			            case "X":
			                beginShape();
			                vertex(0, 0);
			                vertex(10, 15);
			                vertex(20, 0);
			                vertex(10, 15);
			                vertex(20, 30);
			                vertex(10, 15);
			                vertex(0, 30);
			                endShape();
			                break;
			            case "Y":
			                beginShape();
			                vertex(0, 0);
			                vertex(10, 15);
			                vertex(20, 0);
			                vertex(10, 15);
			                vertex(10, 30);
			                endShape();
			                break;
			            case "Z":
			                beginShape();
			                vertex(0, 0);
			                vertex(20, 0);
			                vertex(0, 30);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "a":
			                beginShape();
			                vertex(20, 20);
			                bezierVertex(20, 7, 0, 7, 0, 20);
			                bezierVertex(0, 33, 20, 33, 20, 20);
			                vertex(20, 30);
			                vertex(20, 10);
			                endShape();
			                break;
			            case "b":
			                beginShape();
			                vertex(20, 20);
			                bezierVertex(20, 7, 0, 7, 0, 20);
			                vertex(0, 0);
			                vertex(0, 30);
			                vertex(0, 20);
			                bezierVertex(0, 33, 20, 33, 20, 20);
			                endShape();
			                break;
			            case "c":
			                arc(10, 20, 20, 20, 50, 310);
			                break;
			            case "d":
			                beginShape();
			                vertex(20, 20);
			                bezierVertex(20, 7, 0, 7, 0, 20);
			                bezierVertex(0, 33, 20, 33, 20, 20);
			                vertex(20, 30);
			                vertex(20, 0);
			                endShape();
			                break;
			            case "e":
			                beginShape();
			                vertex(2, 24);
			                vertex(17, 15);
			                bezierVertex(15, 8, 0, 7, 0, 20);
			                bezierVertex(0, 33, 15, 32, 18, 25);
			                endShape();
			                break;
			            case "f":
			                beginShape();
			                vertex(18, 0);
			                bezierVertex(5, 0, 5, 10, 5, 10);
			                vertex(5, 30);
			                vertex(5, 15);
			                vertex(0, 15);
			                vertex(10, 15);
			                endShape();
			                break;
			            case "g":
			                beginShape();
			                vertex(20, 20);
			                bezierVertex(20, 7, 0, 7, 0, 20);
			                bezierVertex(0, 33, 20, 33, 20, 20);
			                vertex(20, 10);
			                vertex(20, 40);
			                bezierVertex(20, 50, 0, 50, 0, 40);
			                endShape();
			                break;
			            case "h":
			                beginShape();
			                vertex(0, 0);
			                vertex(0, 30);
			                vertex(0, 20);
			                bezierVertex(0, 10, 20, 10, 20, 20);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "i":
			                point(15, 0);
			                line(15, 10, 15, 30);
			                break;
			            case "j":
			                point(20, 0);
			                beginShape();
			                vertex(20, 10);
			                vertex(20, 40);
			                bezierVertex(20, 50, 0, 50, 0, 40);
			                endShape();
			                break;
			            case "k":
			                beginShape();
			                vertex(0, 0);
			                vertex(0, 30);
			                vertex(0, 18);
			                vertex(20, 5);
			                vertex(5, 15);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "l":
			                beginShape();
			                vertex(10, 0);
			                vertex(10, 30);
			                vertex(15, 30);
			                endShape();
			                break;
			            case "m":
			                beginShape();
			                vertex(0, 10);
			                vertex(0, 30);
			                vertex(0, 15);
			                bezierVertex(0, 10, 10, 10, 10, 15);
			                vertex(10, 20);
			                vertex(10, 15);
			                bezierVertex(10, 10, 20, 10, 20, 15);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "n":
			                beginShape();
			                vertex(0, 10);
			                vertex(0, 30);
			                vertex(0, 20);
			                bezierVertex(0, 10, 20, 10, 20, 20);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "o":
			                ellipse(10, 20, 20, 20);
			                break;
			            case "p":
			                beginShape();
			                vertex(20, 20);
			                bezierVertex(20, 7, 0, 7, 0, 20);
			                vertex(0, 10);
			                vertex(0, 40);
			                vertex(0, 20);
			                bezierVertex(0, 33, 20, 33, 20, 20);
			                endShape();
			                break;
			            case "q":
			                beginShape();
			                vertex(20, 20);
			                bezierVertex(20, 7, 0, 7, 0, 20);
			                bezierVertex(0, 33, 20, 33, 20, 20);
			                vertex(20, 10);
			                vertex(20, 40);
			                vertex(25, 40);
			                endShape();
			                break;
			            case "r":
			                beginShape();
			                vertex(5, 10);
			                vertex(5, 30);
			                vertex(5, 15);
			                bezierVertex(10, 10, 15, 10, 15, 10);
			                endShape();
			                break;
			            case "s":
			                beginShape();
			                vertex(15, 15);
			                bezierVertex(15, 5, 0, 5, 0, 15);
			                bezierVertex(0, 25, 20, 20, 20, 25);
			                bezierVertex(20, 35, 0, 35, 0, 25);
			                endShape();
			                break;
			            case "t":
			                beginShape();
			                vertex(10, 0);
			                vertex(10, 30);
			                vertex(10, 10);
			                vertex(0, 10);
			                vertex(20, 10);
			                endShape();
			                break;
			            case "u":
			                beginShape();
			                vertex(0, 10);
			                bezierVertex(0, 38, 20, 38, 20, 10);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "v":
			                beginShape();
			                vertex(0, 10);
			                vertex(10, 30);
			                vertex(20, 10);
			                endShape();
			                break;
			            case "w":
			                beginShape();
			                vertex(0, 10);
			                vertex(5, 30);
			                vertex(10, 20);
			                vertex(15, 30);
			                vertex(20, 10);
			                endShape();
			                break;
			            case "x":
			                beginShape();
			                vertex(0, 10);
			                vertex(10, 20);
			                vertex(20, 10);
			                vertex(10, 20);
			                vertex(20, 30);
			                vertex(10, 20);
			                vertex(0, 30);
			                endShape();
			                break;
			            case "y":
			                beginShape();
			                vertex(0, 10);
			                bezierVertex(0, 38, 20, 38, 20, 10);
			                vertex(20, 40);
			                bezierVertex(20, 50, 0, 50, 0, 40);
			                endShape();
			                break;
			            case "z":
			                beginShape();
			                vertex(0, 10);
			                vertex(20, 10);
			                vertex(0, 30);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "0":
			                ellipse(10, 15, 20, 30);
			                break;
			            case "1":
			                beginShape();
			                vertex(10, 30);
			                vertex(10, 0);
			                vertex(5, 5);
			                endShape();
			                break;
			            case "2":
			                beginShape();
			                vertex(0, 10);
			                bezierVertex(0, -3, 20, -3, 20, 10);
			                bezierVertex(20, 20, 0, 20, 0, 30);
			                vertex(20, 30);
			                endShape();
			                break;
			            case "3":
			                beginShape();
			                vertex(0, 0);
			                vertex(20, 0);
			                vertex(0, 15);
			                bezierVertex(25, 10, 25, 35, 0, 30);
			                endShape();
			                break;
			            case "4":
			                beginShape();
			                vertex(20, 15);
			                vertex(0, 15);
			                vertex(15, 0);
			                vertex(15, 30);
			                endShape();
			                break;
			            case "5":
			                beginShape();
			                vertex(20, 0);
			                vertex(0, 0);
			                vertex(0, 15);
			                bezierVertex(25, 10, 25, 35, 0, 30);
			                endShape();
			                break;
			            case "6":
			                beginShape();
			                vertex(20, 20);
			                bezierVertex(20, 7, 0, 7, 0, 20);
			                bezierVertex(0, 5, 10, -3, 17, 3);
			                bezierVertex(10, -3, 0, 5, 0, 20);
			                bezierVertex(0, 33, 20, 33, 20, 20);
			                endShape();
			                break;
			            case "7":
			                beginShape();
			                vertex(0, 0);
			                vertex(20, 0);
			                vertex(0, 30);
			                endShape();
			                break;
			            case "8":
			                beginShape();
			                vertex(10, 30);
			                bezierVertex(23, 30, 23, 12, 10, 12);
			                bezierVertex(17, 12, 17, 0, 10, 0);
			                bezierVertex(1, 0, 1, 12, 10, 12);
			                bezierVertex(-3, 12, -3, 30, 12, 30);
			                endShape();
			                break;
			            case "9":
			                beginShape();
			                vertex(20, 10);
			                bezierVertex(20, -3, 0, -3, 0, 10);
			                bezierVertex(0, 23, 20, 23, 20, 10);
			                bezierVertex(20, 28, 10, 32, 3, 30);
			                endShape();
			                break;
			            case "-":
			                line(5, 15, 15, 15);
			                break;
			            case ":":
			                point(10, 5);
			                point(10, 25);
			                break;
			            case "'":
			                line(10, 5, 10, 10);
			                break;
			            case "\"":
			                line(7, 5, 7, 10);
			                line(13, 5, 13, 10);
			                break;
			            case ".":
			                point(10, 30);
			                break;
			            case "?":
			                beginShape();
			                vertex(0, 7);
			                bezierVertex(0, -3, 20, -3, 20, 7);
			                bezierVertex(20, 8, 15, 14, 10, 14);
			                vertex(10, 20);
			                endShape();
			                point(10, 30);
			                break;
			            case "!":
			                line(10, 0, 10, 20);
			                point(10, 30);
			                break;
			            case ",":
			                line(10, 30, 10, 35);
			                break;
			            case "|":
			                line(10, 0, 10, 30);
			                break;
			            case ">":
			                beginShape();
			                vertex(0, 15);
			                bezierVertex(3, 18, 5, 20, 10, 20);
			                bezierVertex(5, 23, 3, 20, 0, 18);
			                vertex(0, 15);
			                endShape();
			                beginShape();
			                vertex(15, 15);
			                bezierVertex(15, 10, 10, 20, 20, 20);
			                bezierVertex(10, 20, 15, 30, 15, 25);
			                endShape();
			                break;
			            case "<":
			                beginShape();
			                vertex(20, 15);
			                bezierVertex(17, 18, 15, 20, 10, 20);
			                bezierVertex(15, 23, 17, 20, 20, 18);
			                vertex(20, 15);
			                endShape();
			                beginShape();
			                vertex(5, 15);
			                bezierVertex(5, 10, 10, 20, 0, 20);
			                bezierVertex(10, 20, 5, 30, 5, 25);
			                endShape();
			                break;
			            case "\u0000":
			                beginShape();
			                vertex(0, 30);
			                vertex(0, 10);
			                vertex(20, 10);
			                endShape();
			                point(5, 25);
			                point(10, 25);
			                point(15, 25);
			                point(20, 25);
			                break;
			            case "\u0001":
			                line(0, 10, 20, 10);
			                point(3, 15);
			                point(8, 15);
			                point(12, 15);
			                point(17, 15);
			                line(0, 25, 20, 25);
			                point(3, 30);
			                point(8, 30);
			                point(12, 30);
			                point(17, 30);
			                break;
			            case "\u0002":
			                line(0, 10, 7, 10);
			                line(13, 10, 20, 10);
			                line(0, 20, 4, 20);
			                line(16, 20, 20, 20);
			                line(0, 30, 7, 30);
			                line(13, 30, 20, 30);
			                break;
			            case "\u0003":
			                beginShape();
			                vertex(0, 10);
			                vertex(0, 15);
			                vertex(20, 15);
			                vertex(20, 10);
			                line(0, 25, 0, 30);
			                line(20, 25, 20, 30);
			                endShape();
			                break;
			            case "\u0004":
			                beginShape();
			                vertex(0, 15);
			                vertex(3, 15);
			                vertex(3, 10);
			                vertex(6, 10);
			                endShape();
			                beginShape();
			                vertex(15, 10);
			                vertex(15, 15);
			                vertex(20, 15);
			                endShape();
			                beginShape();
			                vertex(20, 25);
			                vertex(15, 25);
			                vertex(15, 30);
			                endShape();
			                beginShape();
			                vertex(0, 25);
			                vertex(5, 25);
			                vertex(5, 30);
			                endShape();
			                break;
			            case "\u0005":
			                line(10, 20, 20, 20);
			                point(5, 12);
			                point(5, 17);
			                point(5, 22);
			                point(5, 27);
			                break;
			        }
			        translate(30, 0);
			        scriptX += 30;
			    }
			    popMatrix();
			};
			
			/** Character rig **/
			// {
			    // Makes a new character rig, taking parameters for each body part.
			    var Rig = function(head, body, lArm1, lArm2, rArm1, rArm2, lLeg1, lLeg2, rLeg1, rLeg2) {
			        this.x = 0;
			        this.y = 0;
			        this.head = head;
			        this.body = body;
			        this.lArm1 = lArm1;
			        this.lArm2 = lArm2;
			        this.rArm1 = rArm1;
			        this.rArm2 = rArm2;
			        this.lLeg1 = lLeg1;
			        this.lLeg2 = lLeg2;
			        this.rLeg1 = rLeg1; 
			        this.rLeg2 = rLeg2;
			        this.headR = 0;
			        this.bodyR = 0;
			        this.arm1R = 0;
			        this.arm2R = 0;
			        this.arm1L = 0;
			        this.arm2L = 0;
			        this.leg1R = 0;
			        this.leg2R = 0;
			        this.leg1L = 0;
			        this.leg2L = 0;
			        this.size = 100;
			        this.direc = "left";
			        this.bounce = 10;
			        this.walkAmount = 0;
			    };
			    
			    // Draws and rotates the body parts of the character.
			    Rig.prototype.display = function() {
			        noStroke();
			        pushMatrix();
			        translate(this.x, this.y);
			        scale(this.size / 100);
			        scale(this.direc === "right" ? -1 : 1, 1);
			        translate(0, 30);
			        scale(1, 1 + Math.abs(sin(this.walkAmount - 90) / 10));
			        translate(0, -30);
			        rotate(this.bodyR);
			        pushMatrix();
			        this.rArm1(this.arm1R);
			        this.rArm2(this.arm2R);
			        popMatrix();
			        pushMatrix();
			        this.rLeg1(this.leg1R);
			        this.rLeg2(this.leg2R);
			        popMatrix();
			        this.body(this.bounce);
			        pushMatrix();
			        rotate(this.headR);
			        this.head();
			        popMatrix();
			        pushMatrix();
			        this.lLeg1(this.leg1L);
			        this.lLeg2(this.leg2L);
			        popMatrix();
			        pushMatrix();
			        this.lArm1(this.arm1L);
			        this.lArm2(this.arm2L);
			        popMatrix();
			        popMatrix();
			    };
			    
			    // Sets the position of the character rig.
			    Rig.prototype.setPos = function(x, y) {
			        this.x = x;
			        this.y = y;
			    };
			    
			    // Changes the direction of scale of the character rig.
			    Rig.prototype.setDirec = function(direc, size) {
			        if (direc) {
			            this.direc = direc;
			        }
			        if (size) {
			            this.size = size;
			        }
			    };
			    
			    // Animates the character rig.
			    Rig.prototype.animate = function(speed) {
			        this.bounce = (this.bounce + speed) % 360;
			        this.walkAmount = (this.walkAmount + speed) % 360;
			        this.arm1L = sin(this.walkAmount) * 30 - 10;
			        this.arm2L = sin(this.walkAmount) * 20 + 30;
			        this.arm1R = sin(-this.walkAmount) * 30 - 10;
			        this.arm2R = sin(-this.walkAmount) * 20 + 30;
			        this.leg1L = sin(-this.walkAmount + 180) * 50;
			        this.leg2L = sin(-this.walkAmount) * 10 - (speed > 0 ? 10 : 0);
			        this.leg1R = sin(-this.walkAmount) * 50;
			        this.leg2R = sin(-this.walkAmount - 180) * 10 - (speed > 0 ? 10 : 0);
			    };
			    
			    // Moves the character rig.
			    Rig.prototype.move = function(xDest, yDest, xSpeed, ySpeed) {
			        // Moves the x position.
			        if (xSpeed > 0) {
			            this.setDirec("right", 60);
			            if (this.x < xDest) {
			                this.x += xSpeed;
			            }
			        } else {
			            this.setDirec("left", 60);
			            if (this.x > xDest) {
			                this.x += xSpeed;
			            }
			        }
			        // Moves the y position.
			        if (ySpeed > 0) {
			            if (this.y < yDest) {
			                this.y += ySpeed;
			            }
			        } else {
			            if (this.y > yDest) {
			                this.y += ySpeed;
			            }
			        }
			        if (dist(this.x, this.y, xDest, yDest) > 1) {
			            this.animate((Math.abs(xSpeed) + Math.abs(ySpeed)) * 1.5);
			        } else {
			            if (this.walkAmount > 180) {
			                this.walkAmount += this.walkAmount.smooth(360, 8);
			            } else {
			                this.walkAmount += this.walkAmount.smooth(0, 8);
			            }
			            if (this.bounce > 180) {
			                this.bounce += this.bounce.smooth(360, 8);
			            } else {
			                this.bounce += this.bounce.smooth(0, 8);
			            }
			            this.animate(0);
			        }
			    };
			    
			    // Sets the rotations of the character rig.
			    Rig.prototype.setRot = function(headR, bodyR, arm1R, arm2R, arm1L, arm2L, leg1R, leg2R, leg1L, leg2L) {
			        this.headR = headR;
			        this.bodyR = bodyR;
			        this.arm1R = arm1R;
			        this.arm2R = arm2R;
			        this.arm1L = arm1L;
			        this.arm2L = arm2L;
			        this.leg1R = leg1R;
			        this.leg2R = leg2R;
			        this.leg1L = leg1L;
			        this.leg2L = leg2L;
			    };
			    
			    // Slides the rotations of the character rig.
			    Rig.prototype.slideRot = function(headR, bodyR, arm1R, arm2R, arm1L, arm2L, leg1R, leg2R, leg1L, leg2L, div) {
			        this.headR += this.headR.smooth(headR, div);
			        this.bodyR += this.bodyR.smooth(bodyR, div);
			        this.arm1R += this.arm1R.smooth(arm1R, div);
			        this.arm2R += this.arm2R.smooth(arm2R, div);
			        this.arm1L += this.arm1L.smooth(arm1L, div);
			        this.arm2L += this.arm2L.smooth(arm2L, div);
			        this.leg1R += this.leg1R.smooth(leg1R, div);
			        this.leg2R += this.leg2R.smooth(leg2R, div);
			        this.leg1L += this.leg1L.smooth(leg1L, div);
			        this.leg2L += this.leg2L.smooth(leg2L, div);
			    };
			    
			    // Resets the rotations of the character rig's joints.
			    Rig.prototype.reset = function() {
			        this.headR = 0;
			        this.bodyR = 0;
			        this.arm1R = 0;
			        this.arm2R = 0;
			        this.arm1L = 0;
			        this.arm2L = 0;
			        this.leg1R = 0;
			        this.leg2R = 0;
			        this.leg1L = 0;
			        this.leg2L = 0;
			    };
			// }
			
			// Makes a person with a customizable head.
			var personRig = function(head) {
			    return new Rig(
			        head,
			        function() {
			            fill(0, 0, 0);
			            beginShape();
			            vertex(-10, 5);
			            bezierVertex(-10, 0, -10, 0, -5, 0);
			            vertex(5, 0);
			            bezierVertex(10, 0, 10, 0, 10, 5);
			            vertex(8, 27);
			            bezierVertex(6, 32, -6, 32, -8, 27);
			            endShape();
			        },
			        function() {
			            fill(0, 0, 0);
			            noStroke();
			            translate(-2, 0);
			            rotate(this.arm1R * 1.5);
			            translate(0, 5);
			            rect(-3, 0, 6, 13);
			            translate(0, 13);
			        },
			        function() {
			            fill(0, 0, 0);
			            rotate(this.arm2R * 1.2);
			            rect(-3, -2, 6, 15, 5);
			        },
			        function() {
			            fill(0, 0, 0);
			            translate(-2, 0);
			            rotate(this.arm1L * 1.5);
			            translate(0, 5);
			            rect(-3, 0, 6, 13);
			            translate(0, 13);
			        },
			        function() {
			            fill(0, 0, 0);
			            rotate(this.arm2L * 1.2);
			            rect(-3, -2, 6, 15, 5);
			        },
			        function() {
			            fill(0, 0, 0);
			            translate(0, 25);
			            rotate(this.leg1R);
			            rect(-4, 5, 8, 10);
			            translate(0, 15);
			        },
			        function() {
			            fill(0, 0, 0);
			            rotate(this.leg2R);
			            (rect)(-4, -2, 8, 12, 0, 0, 3, 3);
			        },
			        function() {
			            fill(0, 0, 0);
			            translate(0, 25);
			            rotate(this.leg1L);
			            rect(-4, 5, 8, 10);
			            translate(0, 15);
			        },
			        function() {
			            fill(0, 0, 0);
			            rotate(this.leg2L);
			            (rect)(-4, -2, 8, 12, 0, 0, 3, 3);
			        }
			    );
			};
			
			/** Character rigs **/
			// {
			    var playerRig, wizardRig, girlRig, fishermanRig, hurtRig, boredRig, roamerRig;
			    playerRig = personRig(
			        function() {
			            fill(0, 0, 0);
			            ellipse(0, -7, 20, 20);
			        }
			    );
			    wizardRig = personRig(
			        function() {
			            fill(0, 0, 0);
			            ellipse(0, -7, 20, 20);
			            beginShape();
			            vertex(-20, -7);
			            bezierVertex(-10, -10, 10, -10, 20, -5);
			            bezierVertex(20, -9, 13, -11, 10, -13);
			            bezierVertex(14, -12, 12, -20, 15, -24);
			            vertex(23, -20);
			            bezierVertex(20, -30, 12, -30, 5, -25);
			            vertex(-10, -13);
			            bezierVertex(-13, -11, -20, -9, -20, -7);
			            endShape();
			        }
			    );
			    girlRig = personRig(
			        function() {
			            fill(0, 0, 0);
			            ellipse(0, -7, 25, 25);
			            beginShape();
			            vertex(5, -15);
			            bezierVertex(13, -24, 18, -10, 26, -10);
			            bezierVertex(18, -5, 13, -13, 8, -10);
			            endShape();
			            beginShape();
			            vertex(-5, -15);
			            bezierVertex(-10, -24, -15, -10, -20, -10);
			            bezierVertex(-15, -5, -10, -13, -5, -10);
			            endShape();
			        }
			    );
			    fishermanRig = personRig(
			        function() {
			            fill(0, 0, 0);
			            ellipse(0, -7, 20, 20);
			            beginShape();
			            vertex(-20, -12);
			            bezierVertex(-10, -8, 10, -10, 20, -5);
			            bezierVertex(20, -9, 13, -11, 10, -13);
			            vertex(10, -15);
			            bezierVertex(9, -20, 3, -20, 0, -18);
			            bezierVertex(-1, -20, -7, -20, -10, -15);
			            vertex(-10, -13);
			            bezierVertex(-13, -11, -20, -14, -20, -12);
			            endShape();
			        }
			    );
			    hurtRig = personRig(
			        function() {
			            fill(0, 0, 0);
			            ellipse(0, -7, 20, 20);
			        }
			    );
			    boredRig = personRig(
			        function() {
			            fill(0, 0, 0);
			            ellipse(0, -7, 20, 20);
			        }
			    );
			    roamerRig = personRig(
			        function() {
			            fill(0, 0, 0);
			            ellipse(0, -7, 20, 20);
			            beginShape();
			            vertex(-20, -7);
			            bezierVertex(-10, -10, 10, -10, 20, -7);
			            bezierVertex(20, -9, 13, -11, 10, -13);
			            vertex(11, -25);
			            vertex(-6, -32);
			            vertex(-6, -31);
			            vertex(8, -25);
			            vertex(-8, -26);
			            vertex(-10, -13);
			            bezierVertex(-13, -11, -20, -9, -20, -7);
			            endShape();
			        }
			    );
			    
			    var drawCharacter = function(x, y, character, posNum) {
			        switch (character) {
			            case "wizard":
			                wizardRig.setPos(x, y);
			                wizardRig.setDirec("left", 50);
			                wizardRig.setRot(0, 0, -35 + sin(frameCount) * 5, 55 - sin(frameCount) * 5, 20, 25, -20, 0, 20, -10);
			                wizardRig.display();
			                break;
			            case "girl":
			                girlRig.setPos(x, y);
			                girlRig.setDirec("left", 35);
			                girlRig.setRot(0, 0, -35 + sin(frameCount) * 5, 55 - sin(frameCount) * 5, 10 - sin(frameCount) * 5, 20 + sin(frameCount) * 5, -20, 0, 20, -10);
			                girlRig.display();
			                break;
			            case "fisherman":
			                fishermanRig.setPos(x, y);
			                fishermanRig.setDirec("right", 50);
			                fishermanRig.setRot(-15, 0, 15, 45, 25, 35, 60, -100, 60, -60);
			                fishermanRig.display();
			                break;
			            case "hurt":
			                hurtRig.setPos(x, y);
			                hurtRig.setDirec("right", 50);
			                if (posNum === 0) {
			                    hurtRig.setRot(-40, 70, -70, 100, 20, 30 + sin(frameCount * 5) * 10, 10, -10, 50, -70);
			                } else {
			                    hurtRig.setRot(0, 5, 10, 35, 15, 30, 70, -100, 70, -60);
			                }
			                hurtRig.display();
			                break;
			            case "bored":
			                boredRig.setPos(x, y);
			                boredRig.setDirec("right", 50);
			                if (posNum === 0) {
			                    boredRig.setRot(-25, -5, 30, 120, -30, 30, 55, -60, -65, 100);
			                } else {
			                    boredRig.setRot(0, 0, 40, 120, 20, 130, 55, -60, 65, -100);
			                }
			                boredRig.display();
			                break;
			            case "roamer":
			                roamerRig.setPos(x, y);
			                roamerRig.setDirec("right", 50);
			                roamerRig.setRot(-10, 5, 10, 35, 15, 30, 70, -100, 70, -60);
			                roamerRig.display();
			                break;
			        }
			    };
			// }
			
			/** Graphic functions **/
			// {
			    var mountain = function(x, y, size) {
			        fill(100, 100, 100);
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        beginShape();
			        vertex(0, 0);
			        vertex(size / 20, -size / 10);
			        vertex(size / 9, -size / 2.8);
			        vertex(size / 6, -size / 2.8);
			        vertex(size / 4, -size / 2);
			        vertex(size / 3.4, -size / 2);
			        vertex(size / 3, -size / 3);
			        vertex(size / 2, -size / 3.5);
			        vertex(size / 1.8, -size / 5);
			        vertex(size / 1.6, -size / 4.8);
			        vertex(size / 1.4, -size / 10);
			        vertex(size, 0);
			        endShape();
			        
			        fill(255, 255, 255, 50);
			        triangle(size / 5.9, -size / 2.9, size / 3.9, -size / 2.05, size / 4.6, -size / 3);
			        popMatrix();
			    };
			    
			    var mountain2 = function(x, y, size) {
			        fill(100, 100, 100);
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        beginShape();
			        vertex(0, 0);
			        vertex(size / 20, -size / 10);
			        vertex(size / 10, -size / 8);
			        vertex(size / 8, -size / 5);
			        vertex(size / 3, -size / 3);
			        vertex(size / 2.8, -size / 2.8);
			        vertex(size / 2, -size / 4);
			        vertex(size / 1.8, -size / 6);
			        vertex(size / 1.5, -size / 7);
			        vertex(size, 0);
			        endShape();
			        
			        fill(255, 255, 255, 50);
			        triangle(size / 2.8, -size / 2.9, size / 3, -size / 3.5, size / 7, -size / 5);
			        popMatrix();
			    };
			    
			    var drawFlower = function(x, y, size, r, opac) {
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        fill(255, 255, 255, opac);
			        beginShape();
			        vertex(-size / 8, -size / 8);
			        bezierVertex(-size / 8, -size / 2, size / 8, -size / 2, size / 8, -size / 8);
			        bezierVertex(size / 2, -size / 8, size / 2, size / 8, size / 8, size / 8);
			        bezierVertex(size / 8, size / 2, -size / 8, size / 2, -size / 8, size / 8);
			        bezierVertex(-size / 2, size / 8, -size / 2, -size / 8, -size / 8, -size / 8);
			        endShape();
			        popMatrix();
			    };
			    
			    var leaves = function(x, y, size) {
			        noStroke();
			        fill(255, 255, 255, 70);
			        ellipse(x, y, size * 1.06, size * 0.55);
			        fill(255, 255, 255);
			        ellipse(x, y, size, size / 2);
			        fill(100, 80, 0, 25);
			        ellipse(x + size / 20, y + size / 15, size / 1.5, size / 3);
			    };
			    
			    var rock = function(x, y, size, r) {
			        fill(70, 70, 70);
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        beginShape();
			        vertex(0, -size / 2);
			        vertex(size / 4, -size / 3);
			        vertex(size / 2, 0);
			        vertex(size / 3, size / 8);
			        vertex(size / 2, size / 6);
			        vertex(size / 4, size / 1.5);
			        vertex(-size / 3, size / 2);
			        vertex(-size / 2, 0);
			        vertex(-size / 2, -size / 8);
			        vertex(-size / 5, -size / 2.5);
			        endShape();
			        fill(0, 0, 0, 20);
			        beginShape();
			        vertex(0, -size / 2);
			        vertex(-size / 3, size / 2);
			        vertex(-size / 30, 0);
			        endShape();
			        beginShape();
			        vertex(-size / 2, 0);
			        vertex(size / 2, size / 6);
			        vertex(size / 5, size / 5);
			        vertex(size / 15, size / 3);
			        vertex(0, size / 5);
			        endShape();
			        ellipse(0, 0, size / 1.5, size / 1.5);
			        popMatrix();
			    };
			    
			    var sliver = function(x, y, w, h, opacity) {
			        fill(255, 255, 255, opacity);
			        beginShape();
			        vertex(x, y);
			        bezierVertex(x + w / 2, y + h / 3, x + w / 2, y + h / 3 * 2, x, y + h);
			        bezierVertex(x - w / 2, y + h / 3 * 2, x - w / 2, y + h / 3, x, y);
			        endShape();
			    };
			    
			    var plank = function(x, y, w, h, r) {
			        pushMatrix();
			        noStroke();
			        translate(x, y);
			        rotate(r);
			        scale(w / 300, h / 300);
			        fill(160, 130, 80);
			        beginShape();
			        vertex(0, 0);
			        bezierVertex(100, 20, 200, -20, 300, 0);
			        bezierVertex(290, 100, 310, 200, 300, 300);
			        bezierVertex(200, 280, 100, 320, 0, 300);
			        bezierVertex(10, 200, -10, 100, 0, 150);
			        vertex(10, 130);
			        vertex(0, 110);
			        bezierVertex(5, 70, -5, 30, 0, 0);
			        endShape();
			        noFill();
			        stroke(140, 110, 70);
			        strokeWeight(15);
			        bezier(50, 80, 100, 90, 200, 100, 250, 80);
			        bezier(30, 140, 100, 170, 200, 130, 260, 140);
			        bezier(60, 230, 100, 220, 200, 240, 250, 230);
			        popMatrix();
			    };
			    
			    var bricks = function(x, y, num) {
			        for (var i = 0; i < num; i++) {
			            rect(x + i * 9, y + (i % 2) * 10, 15, 8);
			        }
			    };
			    
			    var brickFloor = function() {
			        noStroke();
			        var colorAmount;
			        for (var i = 0; i < width / 25 + 1; i++) {
			            for (var j = 0; j < 15; j++) {
			                colorAmount = 30 + sin(i * 40) * 2 - cos(j * 30) * 4;
			                fill(colorAmount, colorAmount, colorAmount + 5);
			                rect(i * 25 - (j % 2) * 10, 455 + j * 10, 20, 5);
			            }
			        }
			    };
			    
			    var leaf = function(x, y, r, size) {
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        scale(size / 100, size / 100);
			        fill(50, 160, 70);
			        noStroke();
			        beginShape();
			        vertex(0, 0);
			        bezierVertex(0, -10, 10, -10, 10, 0);
			        bezierVertex(10, 10, 5, 15, 0, 30);
			        bezierVertex(-5, 15, -10, 10, -10, 0);
			        bezierVertex(-10, -10, 0, -10, 0, 0);
			        endShape();
			        fill(0, 0, 130, 30);
			        beginShape();
			        vertex(0, 0);
			        bezierVertex(0, -10, 10, -10, 10, 0);
			        bezierVertex(10, 10, 5, 15, 0, 30);
			        endShape();
			        popMatrix();
			    };
			    
			    var greenLeaves = function(x, y, r, size) {
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        scale(size / 100, size / 100);
			        leaf(0, 0, 0, 100);
			        leaf(-5, -5, 30, 90);
			        leaf(5, -5, -25, 80);
			        leaf(-20, -5, 5, 70);
			        leaf(-5, -20, -5, 60);
			        leaf(10, -15, -10, 70);
			        leaf(15, -5, -40, 60);
			        popMatrix();
			    };
			    
			    var grass = function(x, y, w, h, amount) {
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        fill(100, 170, 80);
			        rotate(-50);
			        for (var i = 0; i < amount; i++) {
			            rotate(100 / amount);
			            pushMatrix();
			            scale(w / 100, h / 100);
			            triangle(-5, 0, 5, 0, 0, -30 + sin(i * 175) * 15);
			            popMatrix();
			        }
			        popMatrix();
			    };
			    
			    var cypressLeaf = function(x, y, w, h) {
			        fill(100, 160, 90);
			        ellipse(x, y, w, h);
			        ellipse(x - w / 3.5, y - h / 4, w / 5, h / 1.5);
			        fill(110, 170, 95);
			        ellipse(x, y - h / 3, w / 4, h / 1.5);
			        fill(120, 180, 100);
			        ellipse(x + w / 3.5, y - h / 4, w / 5, h / 1.5);
			    };
			    
			    var cypress = function(x, y, w, h) {
			        pushMatrix();
			        translate(x, y);
			        scale(w / 100, h / 100);
			        noStroke();
			        fill(170, 100, 60);
			        beginShape();
			        vertex(-15, 0);
			        vertex(15, 0);
			        vertex(15, 65);
			        vertex(20, 72);
			        vertex(5, 70);
			        vertex(0, 75);
			        vertex(-5, 70);
			        vertex(-20, 72);
			        vertex(-15, 65);
			        endShape();
			        fill(0, 0, 50, 50);
			        rect(-10, 0, 10, 70, 5);
			        fill(120, 180, 100);
			        ellipse(0, 0, 100, 100);
			        cypressLeaf(5, -30, 40, 35);
			        cypressLeaf(-20, -15, 35, 40);
			        cypressLeaf(25, -10, 40, 40);
			        cypressLeaf(5, 5, 35, 35);
			        cypressLeaf(-25, 20, 40, 40);
			        cypressLeaf(25, 20, 35, 40);
			        cypressLeaf(-5, 35, 40, 35);
			        popMatrix();
			    };
			    
			    var willowLeaf = function(x, y, w, h, d, c) {
			        fill(c);
			        if (d === "left") {
			            (rect)(x, y, w, h, w, w / 40, w / 40, w / 40);
			            fill(0, 0, 50, 30);
			            (rect)(x + w / 8, y + w / 8, w / 1.2, h / 1.2, w, 0, 0, 0);
			        } else if (d === "right") {
			            (rect)(x, y, w, h, w / 40, w, w / 40, w / 40);
			            fill(0, 0, 50, 30);
			            (rect)(x + w * 7 / 8 - w / 1.2, y + w / 8, w / 1.2, h / 1.2, 0, w, 0, 0);
			        }
			        stroke(lerpColor(c, color(0, 0, 0, 50), 0.2));
			        strokeWeight(Math.min(w, h) / 20);
			        line(x + w / 6, y + h / 2.3, x + w / 6, y + h * 1.05);
			        line(x + w / 3, y + h / 2.5, x + w / 3, y + h * 1.15);
			        line(x + w / 3.4 * 2, y + h / 2.5, x + w / 3.4 * 2, y + h * 1.2);
			        line(x + w / 6 * 5, y + h / 2, x + w / 6 * 5, y + h * 1.1);
			        noStroke();
			    };
			    
			    var willow = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        noStroke();
			        fill(120, 110, 100);
			        beginShape();
			        vertex(100, 40);
			        bezierVertex(100, 85, 150, 105, 150, 110);
			        bezierVertex(150, 110, 200, 100, 200, 40);
			        vertex(220, 40);
			        vertex(160, 115);
			        vertex(240, 60);
			        bezierVertex(200, 80, 180, 120, 160, 125);
			        bezierVertex(158, 130, 158, 140, 160, 145);
			        bezierVertex(180, 145, 180, 160, 180, 165);
			        bezierVertex(170, 155, 165, 155, 160, 155);
			        bezierVertex(165, 155, 165, 170, 165, 170);
			        bezierVertex(180, 170, 180, 185, 180, 185);
			        bezierVertex(180, 180, 165, 180, 165, 180);
			        bezierVertex(168, 180, 168, 190, 165, 190);
			        bezierVertex(165, 185, 160, 175, 155, 170);
			        bezierVertex(155, 160, 155, 160, 150, 160);
			        bezierVertex(150, 170, 130, 170, 100, 170);
			        bezierVertex(95, 170, 90, 170, 90, 200);
			        bezierVertex(85, 190, 85, 180, 90, 170);
			        bezierVertex(75, 170, 75, 170, 75, 185);
			        bezierVertex(60, 170, 80, 160, 95, 160);
			        bezierVertex(100, 160, 130, 155, 135, 145);
			        bezierVertex(137, 140, 137, 135, 135, 130);
			        bezierVertex(100, 130, 80, 100, 60, 90);
			        vertex(80, 90);
			        bezierVertex(95, 110, 115, 110, 130, 110);
			        bezierVertex(110, 100, 90, 70, 80, 40);
			        endShape();
			        fill(0, 0, 50, 50);
			        rect(140, 115, 5, 40, 5);
			        rect(148, 120, 5, 25, 5);
			        willowLeaf(50, -50, 100, 120, "left", color(100, 160, 70));
			        willowLeaf(140, -20, 90, 110, "right", color(120, 180, 90));
			        willowLeaf(0, 0, 90, 90, "left", color(140, 200, 100));
			        willowLeaf(160, 30, 80, 80, "right", color(140, 200, 100));
			        popMatrix();
			    };
			    
			    var birchLeaf = function(x, y, size, r) {
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        scale(size / 100, size / 100);
			        for (var i = 0; i < 10; i++) {
			            fill(255 - size / 5 + sin(i * 155 + r * 65) * 10, 220 - size / 5 + sin(i * 155 + r * 65) * 10, 100 - size / 7 + sin(i * 155 + r * 65) * 10);
			            pushMatrix();
			            rotate(-220 + i * 10);
			            ellipse(0, (20 + sin(i * 275 + x + y + r * 65) * 10), 5, 15);
			            popMatrix();
			        }
			        popMatrix();
			    };
			    
			    var birchRidge = function(x, y, r) {
			        noFill();
			        strokeCap(ROUND);
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        strokeWeight(1.5);
			        stroke(0, 0, 0);
			        arc(0, 0, 10, 10 , 241, 300);
			        noStroke();
			        popMatrix();
			    };
			    
			    var birch = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        fill(240, 235, 210);
			        beginShape();
			        vertex(0, 0);
			        bezierVertex(0, 30, 5, 35, 15, 40);
			        bezierVertex(20, 30, 35, 15, 40, -10);
			        bezierVertex(40, 20, 20, 40, 18, 50);
			        bezierVertex(16, 55, 17, 60, 17, 65);
			        bezierVertex(20, 65, 30, 50, 30, 45);
			        bezierVertex(30, 60, 20, 70, 18, 70);
			        bezierVertex(19, 90, 20, 110, 20, 120);
			        vertex(10, 120);
			        bezierVertex(10, 100, 5, 80, 8, 45);
			        bezierVertex(5, 45, -8, 30, 0, 0);
			        endShape();
			        fill(0, 0, 0, 20);
			        arc(15, 120, 10, 50, 181, 360);
			        fill(0, 0, 0, 50);
			        arc(14, 120, 5, 20, 181, 360);
			        birchRidge(12, 60, 5);
			        birchRidge(13, 80, -10);
			        birchRidge(13, 90, 10);
			        birchRidge(15, 105, -15);
			        birchRidge(15, 108, 5);
			        birchRidge(15, 115, 10);
			        birchRidge(15, 122, -5);
			        birchLeaf(30, 50, 50, 0);
			        birchLeaf(30, 50, 50, 20);
			        birchLeaf(0, 5, 100, 0);
			        birchLeaf(0, 5, 100, -25);
			        birchLeaf(40, -5, 100, -25);
			        birchLeaf(40, 5, 100, 15);
			        birchLeaf(40, 5, 100, 30);
			        birchLeaf(20, -5, 100, 5);
			        birchLeaf(15, 0, 100, -25);
			        birchLeaf(15, 5, 80, 5);
			        birchLeaf(25, 5, 70, 10);
			        birchLeaf(40, -5, 60, -25);
			        birchLeaf(0, 5, 60, 10);
			        birchLeaf(-10, -5, 60, -25);
			        birchLeaf(0, 10, 60, -25);
			        birchLeaf(40, -5, 60, 45);
			        birchLeaf(40, 5, 40, 10);
			        popMatrix();
			    };
			    
			    var glowTree = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        fill(100, 70, 40);
			        beginShape();
			        vertex(0, 0);
			        bezierVertex(0, 30, 10, 35, 20, 40);
			        bezierVertex(40, 40, 45, 25, 50, 10);
			        bezierVertex(50, 30, 40, 45, 30, 45);
			        bezierVertex(30, 60, 35, 70, 35, 80);
			        vertex(15, 80);
			        bezierVertex(20, 70, 20, 60, 20, 50);
			        bezierVertex(5, 50, -10, 35, -10, 20);
			        bezierVertex(-5, 35, 10, 45, 15, 45);
			        bezierVertex(0, 40, -5, 20, 0, 0);
			        endShape();
			        fill(0, 0, 50, 50);
			        rect(23, 45, 4, 20, 2);
			        rect(20, 68, 3, 10, 2);
			        fill(70, 190, 255);
			        ellipse(20, 15, 70, 40);
			        fill(70, 190, 255, 15);
			        for (var i = 0; i < 20; i++) {
			            ellipse(20 + sin(i * 18) * 15, 15 - cos(i * 18) * 15, 80, 40);
			        }
			        for (var i = 0; i < 20; i++) {
			            pushMatrix();
			            translate(20, 30);
			            rotate(-85.5 + i * 9);
			            fill(70 - Math.abs(sin(i * 42) * 40), 190 - Math.abs(sin(i * 13) * 40), 255 + sin(i * 157) * 40);
			            for (var j = 0; j < 5; j++) {
			                ellipse(sin(i * 15 + j * 137) * 3, -j * (9 + sin(i * 167) / 2), 5, 10);
			            }
			            popMatrix();
			        }
			        popMatrix();
			    };
			    
			    var waveTree = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        fill(150, 140, 130);
			        beginShape();
			        vertex(25, 0);
			        bezierVertex(26, 40, 28, 60, 40, 80);
			        vertex(20, 75);
			        vertex(5, 85);
			        vertex(-10, 70);
			        vertex(-20, 75);
			        bezierVertex(-18, 60, -18, 40, -25, 0);
			        endShape();
			        fill(0, 0, 50, 50);
			        rect(-15, 30, 5, 35);
			        rect(-7, 30, 5, 39);
			        fill(150, 200, 170);
			        noStroke();
			        beginShape();
			        vertex(0, 50);
			        bezierVertex(-30, 50, -50, 30, -50, 0);
			        bezierVertex(-50, -30, -30, -50, 0, -50);
			        for (var i = 0; i < 80; i++) {
			            vertex(i * 1.5, -50 + i / 2 + sin(x / 3 + frameCount * 10 + i * 4) * i / 10);
			        }
			        for (var i = 0; i < 80; i++) {
			            vertex(120 - i * 1.5, -10 + i / 4 * 3 + sin(x / 3 + frameCount * 10 + i * 4 - 50) * (80 - i) / 10);
			        }
			        endShape();
			        fill(0, 0, 50, 20);
			        ellipse(10, -10, 80, 60);
			        ellipse(15, -15, 50, 30);
			        popMatrix();
			    };
			    
			    var pumpkin = function(x, y, w, h, r) {
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        scale(w / 100, h / 100);
			        rotate(r);
			        fill(245, 140, 30);
			        rect(-50, -40, 100, 80, 50);
			        
			        fill(160, 100, 50);
			        beginShape();
			        vertex(-15, -40);
			        vertex(-8, -38);
			        vertex(0, -30);
			        vertex(8, -38);
			        vertex(15, -40);
			        bezierVertex(8, -40, 6, -55, 6, -55);
			        bezierVertex(8, -55, 11, -55, 13, -53);
			        vertex(13, -60);
			        bezierVertex(7, -62, 0, -62, -3, -60);
			        bezierVertex(-3, -55, -3, -40, -15, -40);
			        endShape();
			        
			        fill(0, 0, 50, 50);
			        rect(3, -45, 3, 10);
			        rect(-2, -50, 3, 13);
			        
			        strokeWeight(2);
			        noFill();
			        stroke(250, 160, 50);
			        arc(10, 0, 60, 80, -59, 60);
			        arc(0, 0, 40, 80, -59, 60);
			        stroke(225, 120, 40);
			        arc(-10, 0, 60, 80, 121, 240);
			        arc(0, 0, 40, 80, 121, 240);
			        
			        strokeWeight(20);
			        stroke(255, 255, 235, 50);
			        arc(0, 0, 70, 50, 280, 340);
			        noStroke();
			        fill(0, 0, 50, 10);
			        rect(-35, -20, 60, 55, 30);
			        rect(-30, -15, 50, 45, 30);
			        rect(-19, -5, 28, 24, 30);
			        popMatrix();
			    };
			    
			    var glow = function(x, y, size, color) {
			        noStroke();
			        fill(color, 15);
			        for (var i = 0; i < 20; i++) {
			            ellipse(x + sin(i * 18) * size / 2, y - cos(i * 18) * size / 2, size, size);
			        }
			    };
			    
			    var light = function(x, y, color) {
			        noStroke();
			        fill(color, 100);
			        ellipse(x, y, 2 + sin(x * 15 + y * 25), 2 + sin(x * 15 + y * 25));
			        glow(x, y, 3 + sin(x * 15 + y * 25), color);
			    };
			    
			    var statue = function(x, y, size, r) {
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        scale(size / 100, size / 100);
			        fill(140, 140, 135);
			        beginShape();
			        vertex(-20, -50);
			        vertex(20, -50);
			        vertex(50, -5);
			        vertex(30, 20);
			        vertex(35, 30);
			        vertex(25, 45);
			        vertex(10, 50);
			        vertex(-10, 50);
			        vertex(-25, 45);
			        vertex(-35, 30);
			        vertex(-30, 20);
			        vertex(-50, -5);
			        endShape();
			        
			        fill(95, 95, 100);
			        quad(25, -5, 11, -5, 11, 2, 25, 0);
			        quad(-25, -5, -11, -5, -11, 2, -25, 0);
			        quad(-5, 0, -6, 13, 4, 15, -3, 11);
			        
			        fill(0, 0, 50, 50);
			        beginShape();
			        vertex(-15, -45);
			        vertex(-45, -5);
			        vertex(-25, 20);
			        vertex(-30, 30);
			        vertex(-20, 45);
			        vertex(-15, 45);
			        vertex(-10, 35);
			        vertex(-20, 20);
			        vertex(-25, 0);
			        vertex(-10, -20);
			        endShape();
			        
			        strokeWeight(3);
			        stroke(0, 0, 50, 50);
			        noFill();
			        line(10, -42, 20, -35);
			        line(5, -35, 25, -25);
			        beginShape();
			        vertex(10, -25);
			        vertex(12, -20);
			        vertex(20, -18);
			        endShape();
			        popMatrix();
			    };
			    
			    var drawWaves = function(x, y, amt, w, h) {
			        noStroke();
			        fill(255, 255, 255, 90);
			        
			        pushMatrix();
			        translate(x, y);
			        
			        beginShape();
			        for (var i = 0; i < amt + 1; i++) {
			            curveVertex(cos(i * 360 / amt - 5) * w, sin(i * 360 / amt - 5) * h);
			            curveVertex(cos(i * 360 / amt + 5) * w, sin(i * 360 / amt + 5) * h);
			            curveVertex(cos(i * 360 / amt + 180 / amt) * (w - 20), sin(i * 360 / amt + 180 / amt) * (h - 20));
			        }
			        endShape();
			        
			        popMatrix();
			    };
			
			    var title = function(x, y, size) {
			        strokeCap(PROJECT);
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        
			        // THE
			        pushMatrix();
			        translate(-188, 2);
			        // {
			            noFill();
			            strokeWeight(4);
			            stroke(20, 60, 40);
			            beginShape();
			            vertex(0, 5);
			            vertex(0, 0);
			            vertex(10, 0);
			            vertex(10, 25);
			            vertex(5, 25);
			            vertex(15, 25);
			            vertex(10, 25);
			            vertex(10, 0);
			            vertex(20, 0);
			            vertex(20, 5);
			            endShape();
			            translate(30, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(0, 27);
			            vertex(0, 10);
			            vertex(15, 10);
			            vertex(15, 27);
			            vertex(15, 0);
			            endShape();
			            translate(25, 0);
			            beginShape();
			            vertex(15, 0);
			            vertex(0, 0);
			            vertex(0, 25);
			            vertex(17, 25);
			            vertex(0, 25);
			            vertex(0, 10);
			            vertex(10, 10);
			            endShape();
			            noStroke();
			        // }
			        popMatrix();
			        
			        // SECRET
			        pushMatrix();
			        translate(-100, 0);
			        // Text
			        // {
			            pushMatrix();
			            fill(100, 100, 110);
			            beginShape();
			            vertex(5, 0);
			            vertex(0, 5);
			            vertex(0, 30);
			            vertex(20, 30);
			            vertex(22, 28);
			            vertex(25, 30);
			            vertex(30, 30);
			            vertex(30, 45);
			            vertex(0, 45);
			            vertex(0, 55);
			            vertex(35, 55);
			            vertex(40, 50);
			            vertex(40, 25);
			            vertex(35, 20);
			            vertex(10, 20);
			            vertex(10, 10);
			            vertex(25, 10);
			            vertex(28, 8);
			            vertex(30, 10);
			            vertex(40, 10);
			            vertex(40, 0);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(40, 0);
			            vertex(40, 15);
			            vertex(35, 15);
			            vertex(35, 10);
			            vertex(10, 10);
			            vertex(10, 20);
			            vertex(15, 20);
			            vertex(18, 23);
			            vertex(20, 20);
			            vertex(25, 20);
			            vertex(25, 30);
			            vertex(10, 30);
			            vertex(10, 45);
			            vertex(35, 45);
			            vertex(35, 40);
			            vertex(40, 40);
			            vertex(40, 55);
			            vertex(0, 55);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(35, 0);
			            vertex(40, 5);
			            vertex(40, 15);
			            vertex(35, 15);
			            vertex(35, 10);
			            vertex(10, 10);
			            vertex(10, 45);
			            vertex(35, 45);
			            vertex(35, 40);
			            vertex(40, 40);
			            vertex(40, 55);
			            vertex(5, 55);
			            vertex(0, 50);
			            vertex(0, 40);
			            vertex(3, 38);
			            vertex(0, 35);
			            endShape();   
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(40, 0);
			            vertex(30, 10);
			            vertex(10, 10);
			            vertex(10, 20);
			            vertex(30, 20);
			            vertex(30, 10);
			            vertex(40, 0);
			            vertex(40, 25);
			            vertex(35, 30);
			            vertex(20, 30);
			            vertex(40, 55);
			            vertex(28, 55);
			            vertex(10, 33);
			            vertex(10, 40);
			            vertex(8, 43);
			            vertex(10, 45);
			            vertex(10, 55);
			            vertex(0, 55);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(40, 0);
			            vertex(40, 15);
			            vertex(35, 15);
			            vertex(35, 10);
			            vertex(10, 10);
			            vertex(10, 20);
			            vertex(25, 20);
			            vertex(25, 30);
			            vertex(20, 30);
			            vertex(18, 28);
			            vertex(15, 30);
			            vertex(10, 30);
			            vertex(10, 45);
			            vertex(35, 45);
			            vertex(35, 40);
			            vertex(40, 40);
			            vertex(40, 55);
			            vertex(0, 55);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(10, 0);
			            vertex(13, 2);
			            vertex(15, 0);
			            vertex(40, 0);
			            vertex(40, 15);
			            vertex(30, 15);
			            vertex(30, 10);
			            vertex(25, 10);
			            vertex(25, 20);
			            vertex(22, 23);
			            vertex(25, 25);
			            vertex(25, 45);
			            vertex(30, 45);
			            vertex(30, 55);
			            vertex(10, 55);
			            vertex(10, 45);
			            vertex(15, 45);
			            vertex(15, 10);
			            vertex(10, 10);
			            vertex(10, 15);
			            vertex(0, 15);
			            endShape();
			            popMatrix();
			        // }
			        
			        // Highlights
			        // {
			            pushMatrix();
			            fill(255, 255, 255, 40);
			            beginShape();
			            vertex(5, 0);
			            vertex(0, 5);
			            vertex(10, 10);
			            vertex(25, 10);
			            vertex(28, 8);
			            vertex(30, 10);
			            vertex(40, 10);
			            vertex(40, 0);
			            endShape();
			            beginShape();
			            vertex(5, 0);
			            vertex(10, 10);
			            vertex(25, 10);
			            vertex(28, 8);
			            vertex(30, 10);
			            vertex(35, 10);
			            vertex(40, 0);
			            endShape();
			            beginShape();
			            vertex(0, 30);
			            vertex(20, 30);
			            vertex(22, 28);
			            vertex(25, 30);
			            vertex(30, 30);
			            vertex(30, 45);
			            vertex(40, 50);
			            vertex(40, 25);
			            vertex(35, 20);
			            vertex(10, 20);
			            endShape();
			            beginShape();
			            vertex(25, 30);
			            vertex(40, 25);
			            vertex(35, 20);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(40, 0);
			            vertex(40, 15);
			            vertex(35, 15);
			            vertex(35, 10);
			            vertex(10, 10);
			            endShape();
			            quad(0, 0, 40, 0, 35, 10, 10, 10);
			            rect(10, 20, 15, 10);
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(35, 0);
			            vertex(40, 5);
			            vertex(40, 15);
			            vertex(35, 15);
			            vertex(35, 10);
			            vertex(10, 10);
			            endShape();
			            
			            beginShape();
			            vertex(0, 0);
			            vertex(35, 0);
			            vertex(40, 5);
			            vertex(35, 10);
			            vertex(10, 10);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(20, 30);
			            vertex(40, 55);
			            vertex(28, 55);
			            vertex(10, 33);
			            endShape();
			            
			            beginShape();
			            vertex(0, 0);
			            vertex(40, 0);
			            vertex(40, 25);
			            vertex(30, 20);
			            vertex(30, 10);
			            vertex(10, 10);
			            endShape();
			            
			            beginShape();
			            vertex(0, 0);
			            vertex(40, 0);
			            vertex(30, 10);
			            vertex(10, 10);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(40, 0);
			            vertex(40, 15);
			            vertex(35, 15);
			            vertex(35, 10);
			            vertex(10, 10);
			            endShape();
			            quad(0, 0, 40, 0, 35, 10, 10, 10);
			            rect(10, 20, 15, 10);
			            
			            translate(50, 0);
			            beginShape();
			            vertex(0, 0);
			            vertex(10, 0);
			            vertex(13, 2);
			            vertex(15, 0);
			            vertex(40, 0);
			            vertex(40, 15);
			            vertex(30, 15);
			            vertex(30, 10);
			            vertex(10, 10);
			            endShape();
			            quad(40, 0, 40, 15, 30, 15, 30, 10);
			            
			            beginShape();
			            vertex(0, 0);
			            vertex(10, 0);
			            vertex(13, 2);
			            vertex(15, 0);
			            vertex(40, 0);
			            vertex(40, 15);
			            vertex(30, 15);
			            vertex(30, 10);
			            vertex(25, 10);
			            vertex(25, 20);
			            vertex(22, 23);
			            vertex(25, 25);
			            vertex(25, 45);
			            vertex(30, 45);
			            vertex(30, 55);
			            vertex(10, 55);
			            vertex(10, 45);
			            vertex(15, 45);
			            vertex(15, 10);
			            vertex(10, 10);
			            vertex(10, 15);
			            vertex(0, 15);
			            endShape();
			            quad(30, 45, 30, 55, 20, 55, 25, 45);
			            popMatrix();
			        // }
			        
			        // Shadows
			        // {
			            pushMatrix();
			            fill(0, 0, 0, 40);
			            rect(0, 45, 30, 10);
			            
			            translate(50, 0);
			            quad(0, 55, 40, 55, 35, 45, 10, 45);
			            
			            translate(50, 0);
			            beginShape();
			            vertex(10, 45);
			            vertex(35, 45);
			            vertex(40, 55);
			            vertex(5, 55);
			            vertex(0, 50);
			            endShape();
			            
			            translate(50, 0);
			            beginShape();
			            vertex(10, 20);
			            vertex(20, 30);
			            vertex(28, 55);
			            vertex(10, 33);
			            endShape();
			            
			            translate(50, 0);
			            quad(0, 55, 40, 55, 35, 45, 10, 45);
			            
			            translate(50, 0);
			            quad(0, 0, 0, 15, 10, 15, 10, 10);
			            quad(10, 45, 10, 55, 20, 55, 15, 45);
			            popMatrix();
			        // }
			        
			        // Moss
			        // {
			            pushMatrix();
			            fill(100, 130, 110);
			            ellipse(10, 5, 5, 5);
			            ellipse(15, 6, 8, 7);
			            ellipse(18, 23, 4, 4);
			            ellipse(22, 25, 3, 3);
			            
			            translate(50, 0);
			            ellipse(5, 20, 5, 5);
			            ellipse(7, 23, 4, 7);
			            ellipse(15, 50, 4, 4);
			            ellipse(20, 52, 3, 3);
			    
			            translate(50, 0);
			            ellipse(6, 10, 3, 4);
			            ellipse(4, 30, 5, 4);
			            ellipse(36, 50, 4, 6);
			            
			            translate(50, 0);
			            ellipse(30, 5, 6, 5);
			            ellipse(20, 35, 4, 4);
			            
			            translate(50, 0);
			            ellipse(30, 5, 4, 4);
			            ellipse(25, 6, 5, 3);
			            ellipse(4, 30, 3, 3);
			            ellipse(7, 35, 4, 4);
			            
			            translate(50, 0);
			            ellipse(5, 5, 4, 4);
			            ellipse(8, 6, 3, 3);
			            ellipse(23, 50, 5, 7);
			            popMatrix();
			        // }
			        popMatrix();
			        
			        // WORLD
			        pushMatrix();
			        translate(-190, 43);
			        scale(1, 1.2);
			        // Text
			        // {
			            for (var i = 0; i < 2; i++) {
			                if (i === 1) {
			                    translate(0, -3);
			                }
			                fill(70, 70, 75);
			                if (i === 0) {
			                    fill(255, 255, 255, 50);
			                }
			                beginShape();
			                vertex(7, 5);
			                vertex(0, 3);
			                vertex(0, 0);
			                vertex(20, 0);
			                vertex(20, 3);
			                vertex(13, 5);
			                vertex(30, 55);
			                vertex(40, 30);
			                vertex(50, 55);
			                vertex(67, 5);
			                vertex(60, 3);
			                vertex(60, 0);
			                vertex(80, 0);
			                vertex(80, 3);
			                vertex(73, 5);
			                vertex(55, 60);
			                vertex(45, 60);
			                vertex(40, 45);
			                vertex(35, 60);
			                vertex(25, 60);
			                endShape();
			                
			                noFill();
			                strokeWeight(5);
			                stroke(70, 70, 75);
			                if (i === 0) {
			                    stroke(255, 255, 255, 50);
			                }
			                pushMatrix();
			                translate(115, 43);
			                scale(1.5, 0.8);
			                rotate(45);
			                ellipse(0, 0, 40, 40);
			                ellipse(0, 0, 35, 40);
			                popMatrix();
			                
			                fill(70, 70, 75);
			                if (i === 0) {
			                    fill(255, 255, 255, 50);
			                }
			                noStroke();
			                pushMatrix();
			                translate(165, 26);
			                scale(1.5, 1);
			                beginShape();
			                vertex(10, 12);
			                bezierVertex(35, 13, 35, 4, 13, 5);
			                vertex(7, 5);
			                vertex(0, 3);
			                vertex(0, 0);
			                vertex(20, 0);
			                bezierVertex(47, 0, 47, 17, 20, 17);
			                bezierVertex(30, 17, 27, 33, 40, 32);
			                vertex(40, 34);
			                vertex(30, 34);
			                bezierVertex(20, 34, 20, 17, 13, 17);
			                vertex(13, 29);
			                vertex(20, 32);
			                vertex(20, 34);
			                vertex(0, 34);
			                vertex(0, 32);
			                vertex(7, 29);
			                vertex(7, 5);
			                vertex(13, 5);
			                vertex(13, 20);
			                endShape();
			                popMatrix();
			                
			                pushMatrix();
			                translate(245, 26);
			                scale(1.5, 1);
			                beginShape();
			                vertex(0, 0);
			                vertex(20, 0);
			                vertex(20, 2);
			                vertex(13, 5);
			                vertex(13, 29);
			                vertex(30, 29);
			                vertex(33, 24);
			                vertex(35, 24);
			                vertex(35, 34);
			                vertex(0, 34);
			                vertex(0, 32);
			                vertex(7, 29);
			                vertex(7, 5);
			                vertex(0, 2);
			                endShape();
			                popMatrix();
			                
			                pushMatrix();
			                translate(315, 26);
			                scale(1.5, 1);
			                beginShape();
			                vertex(0, 0);
			                vertex(20, 0);
			                bezierVertex(47, 0, 47, 34, 20, 34);
			                vertex(20, 29);
			                vertex(15, 29);
			                bezierVertex(35, 29, 35, 5, 15, 5);
			                vertex(15, 29);
			                vertex(20, 29);
			                vertex(20, 34);
			                vertex(0, 34);
			                vertex(0, 32);
			                vertex(7, 29);
			                vertex(7, 5);
			                vertex(0, 2);
			                endShape();
			                popMatrix();
			            }
			        // }
			        
			        // Moss
			        // {
			            fill(0, 70, 40);
			            rect(18, 25, 5, 30, 5);
			            rect(21, 35, 5, 30, 5);
			            rect(63, 10, 5, 40, 5);
			            rect(93, 27, 5, 30, 5);
			            rect(96, 25, 5, 25, 5);
			            rect(178, 25, 5, 20, 5);
			            rect(182, 25, 5, 25, 5);
			            rect(208, 50, 5, 20, 5);
			            rect(253, 25, 5, 25, 5);
			            rect(275, 55, 5, 10, 5);
			            rect(278, 55, 5, 15, 5);
			            rect(350, 25, 5, 20, 5);
			            rect(353, 26, 5, 30, 5);
			        // }
			        popMatrix();
			        popMatrix();
			        strokeCap(ROUND);
			    };
			    
			    var scarecrow = function(x, y, size, r, speed) {
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        scale(size / 100, size / 100);
			        fill(120, 70, 40);
			        rect(-10, 0, 20, 60);
			        fill(0, 0, 0);
			        beginShape();
			        vertex(-25, 0);
			        vertex(30, 10);
			        vertex(25, -50);
			        vertex(70, -40);
			        vertex(70, -60);
			        vertex(25, -70);
			        vertex(-25, -70);
			        vertex(-70, -60);
			        vertex(-70, -40);
			        vertex(-25, -50);
			        endShape();
			        ellipse(0, -85, 40, 40);
			        beginShape();
			        vertex(-50, -85);
			        bezierVertex(-20, -90, 20, -90, 50, -80);
			        bezierVertex(20, -100, -20, -105, -50, -85);
			        endShape();
			        (rect)(-20, -110, 40, 20, 7, 5, 0, 0);
			        bezier(-60, -45, -60 + sin(frameCount * speed) * 5, -30, -40 + sin(frameCount * speed + 90) * 5, -20, -40 + sin(frameCount * speed + 180) * 5, -10);
			        bezier(-55, -50, -55 + sin(frameCount * speed + 30) * 5, -30, -35 + sin(frameCount * speed + 120) * 5, -20, -35 + sin(frameCount * speed + 230) * 5, -5);
			        bezier(-45, -55, -45 + sin(frameCount * speed - 70) * 5, -30, -25 + sin(frameCount * speed + 20) * 5, -20, -25 + sin(frameCount * speed + 110) * 5, -10);
			        bezier(50, -45, 50 + sin(frameCount * speed - 40) * 5, -30, 70 + sin(frameCount * speed + 50) * 5, -20, 70 + sin(frameCount * speed + 140) * 5, -10);
			        bezier(60, -45, 60 + sin(frameCount * speed + 10) * 5, -30, 80 + sin(frameCount * speed + 100) * 5, -20, 80 + sin(frameCount * speed + 190) * 5, -10);
			        popMatrix();
			    };
			    
			    var pipe = function(x, y) {
			        noStroke();
			        fill(40, 50, 60);
			        rect(x - 40, y - 40, 80, 80);
			        fill(60, 65, 70);
			        rect(x - 40, y - 45, 10, 90);
			        rect(x + 30, y - 45, 10, 90);
			        for (var i = 0; i < 40; i++) {
			            fill(255, 255, 255, sin(i * 4.5) * 15);
			            rect(x - 40, y - 40 + i * 2, 80, 2);
			        }
			    };
			    
			    var item = function(x, y, size, r, item) {
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        rotate(r);
			        scale(size / 100, size / 100);
			        switch (item) {
			            case "flower":
			                drawFlower(0, 0, 100, 0, 255);
			                break;
			            case "turnip":
			                glow(0, 40, 70, color(255, 255, 255));
			                fill(70, 120, 115);
			                beginShape();
			                vertex(-10, 5);
			                bezierVertex(-10, -65, -30, -55, -50, -110);
			                bezierVertex(-60, -170, 20, -70, 2, 5);
			                endShape();
			                fill(100, 150, 130);
			                beginShape();
			                vertex(10, 5);
			                bezierVertex(10, -45, 30, -35, 50, -90);
			                bezierVertex(60, -150, -20, -50, -2, 5);
			                endShape();
			                fill(255, 250, 235);
			                beginShape();
			                vertex(-50, 50);
			                bezierVertex(-60, -30, 60, -30, 50, 50);
			                bezierVertex(45, 80, 5, 90, 0, 120);
			                bezierVertex(-5, 90, -45, 80, -50, 50);
			                endShape();
			                fill(190, 130, 220);
			                beginShape();
			                vertex(-50, 50);
			                bezierVertex(-60, -30, 60, -30, 50, 50);
			                bezierVertex(10, 40, -20, 10, -50, 50);
			                endShape();
			                fill(255, 250, 235, 100);
			                ellipse(-20, 25, 15, 20);
			                ellipse(15, 35, 20, 30);
			                fill(0, 0, 50, 20);
			                ellipse(-30, 60, 20, 10);
			                ellipse(-5, 90, 20, 10);
			                ellipse(-10, 75, 30, 10);
			                fill(255, 255, 255, 100);
			                break;
			            case "telescope":
			                rotate(-90);
			                scale(1.5, 1.5);
			                fill(180, 160, 110);
			                ellipse(75, 0, 9, 18);
			                rect(45, -9, 30, 18);
			                fill(190, 170, 120);
			                ellipse(45, 0, 9, 30);
			                rect(0, -15, 45, 30);
			                fill(200, 180, 130);
			                ellipse(0, 0, 9, 42);
			                rect(-60, -21, 60, 42);
			                fill(215, 195, 130);
			                ellipse(-60, 0, 9, 42);
			                fill(150, 190, 255, 170);
			                ellipse(-60, 0, 5, 35);
			                
			                fill(0, 0, 50, 50);
			                rect(55, 3, 20, 5);
			                rect(5, 6, 40, 5);
			                rect(-55, 9, 50, 5);
			                break;
			            case "coin":
			                noStroke();
			                fill(210, 180, 120);
			                ellipse(0, 0, 60, 60);
			                
			                fill(150, 120, 90);
			                textAlign(CENTER, CENTER);
			                textFont(fonts[1], 45);
			                text("1", 0, 0);
			                
			                noFill();
			                strokeWeight(3);
			                stroke(180, 150, 100);
			                ellipse(0, 0, 60, 60);
			                noStroke();
			                break;
			            case "key":
			                translate(-20, -50);
			                fill(180, 160, 100);
			                beginShape();
			                vertex(0, 0);
			                vertex(10, 0);
			                vertex(10, 10);
			                vertex(30, 10);
			                vertex(30, 5);
			                vertex(40, 5);
			                vertex(40, 60);
			                bezierVertex(65, 65, 65, 105, 35, 110);
			                vertex(35, 100);
			                bezierVertex(55, 95, 55, 75, 35, 70);
			                bezierVertex(15, 75, 15, 95, 35, 100);
			                vertex(35, 110);
			                bezierVertex(5, 105, 5, 65, 30, 60);
			                vertex(30, 40);
			                vertex(10, 40);
			                vertex(10, 45);
			                vertex(0, 45);
			                vertex(0, 30);
			                vertex(30, 30);
			                vertex(30, 20);
			                vertex(0, 20);
			                endShape();
			                fill(0, 0, 50, 50);
			                beginShape();
			                vertex(30, 40);
			                vertex(10, 40);
			                vertex(10, 45);
			                vertex(0, 45);
			                vertex(0, 30);
			                vertex(30, 30);
			                endShape();
			                stroke(0, 0, 50, 50);
			                strokeWeight(5);
			                strokeCap(SQUARE);
			                line(35, 100, 35, 110);
			                line(25, 95, 25, 105);
			                line(45, 95, 45, 105);
			                line(30, 50, 40, 50);
			                strokeCap(ROUND);
			                break;
			            case "orb":
			                noStroke();
			                glow(0, 0, 80, color(110, 180, 255));
			                fill(170, 230, 255, 100);
			                ellipse(0, 0, 90, 90);
			                fill(190, 250, 255, 100);
			                ellipse(0, 0, 50, 50);
			                noFill();
			                strokeWeight(10);
			                stroke(255, 255, 245, 100);
			                arc(0, 0, 60, 60, 260, 370);
			                stroke(0, 0, 50, 50);
			                arc(0, 0, 60, 60, 60, 190);
			                break;
			        }
			        popMatrix();
			    };
			    
			    var fishingPole = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        fill(0, 0, 0);
			        ellipse(0, 2, 5, 5);
			        noFill();
			        stroke(0, 0, 0);
			        strokeWeight(2);
			        bezier(0, 0, 30, -20, 60, -30, 90, -30);
			        strokeWeight(1.3);
			        line(90, -30, 90, 600);
			        arc(90, 605, 10, 10, 270, 450);
			        popMatrix();
			        noStroke();
			    };
			    
			    var lantern = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        glow(0, 0, 30, color(255, 255, 150)); 
			        fill(150, 40, 10);
			        triangle(0, -35, -20, -15, 20, -15);
			        ellipse(0, -38, 3, 10);
			        ellipse(0, -38, 10, 3);
			        arc(-20, -18, 5, 5, 0, 240);
			        arc(20, -18, 5, 5, -60, 180);
			        (rect)(-18, 15, 36, 5, 0, 0, 2, 2);
			        rect(-20, 15, 40, 2);
			        fill(0, 0, 50, 40);
			        triangle(0, -30, -13, -19, 13, -19);
			        fill(50, 50, 50);
			        rect(-15, -15, 30, 30);
			        fill(80, 80, 70);
			        rect(-14, -15, 28, 30);
			        fill(255, 200, 0);
			        rect(-13, -15, 26, 30);
			        fill(255, 255, 0, 80);
			        rect(-6, -10, 15, 20);
			        rect(-1, -7, 6, 13);
			        popMatrix();
			    };
			    
			    var deadTree = function(x, y, size) {
			        strokeCap(ROUND);
			        noFill();
			        stroke(0, 0, 0);
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        strokeWeight(5);
			        bezier(0, 100, 0, 50, 20, 40, 20, 0);
			        strokeWeight(3);
			        bezier(20, 0, 20, -20, 10, -30, 20, -60);
			        bezier(20, 10, 20, 10, 40, -30, 40, -45);
			        bezier(13, 40, 20, 30, 40, 20, 40, 10);
			        strokeWeight(2);
			        bezier(5, 0, 10, 5, 5, 10, 15, 20);
			        bezier(5, -35, 10, -30, 10, -25, 16, -20);
			        bezier(33, -20, 33, -20, 25, -30, 25, -40);
			        popMatrix();
			    };
			    
			    var flame = function(x, y, h, plus) {
			        noStroke();
			        fill(255, 120 + sin(frameCount * 3 + plus) * 20, 10, 100);
			        triangle(x, y, x + 20, y, x + 10 + sin(frameCount * 4 + plus + y) * 10, y - h + sin(frameCount * 7 + plus + x) * 10);
			    };
			    
			    var cloud = function(x, y, size, bgColor) {
			        fill(lerpColor(bgColor, 255, 0.8));
			        strokeWeight(4);
			        stroke(lerpColor(bgColor, 255, 0.8), 100);
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        beginShape();
			        curveVertex(-100, -30 + sin(size * 5 + 20) * 20);
			        curveVertex(0, -10 + sin(size * 8 + 50) * 20);
			        curveVertex(40, -30 + sin(size * 7 + 30) * 20);
			        curveVertex(80, -20 + sin(size * 7 + 30) * 20);
			        curveVertex(100, 30);
			        curveVertex(0, 40);
			        curveVertex(-100, 30);
			        curveVertex(-80, -20 + sin(size * 7 + 110) * 20);
			        curveVertex(-40, -30 + sin(size * 7 + 110) * 20);
			        curveVertex(0, -10 + sin(size * 8 + 50) * 20);
			        curveVertex(0, -40 + sin(size * 2) * 20);
			        endShape();
			        noStroke();
			        fill(255, 255, 255, 50);
			        ellipse(-50, 15, 65, 35);
			        ellipse(50, 20, 55, 15);
			        ellipse(-50, 15, 70, 30);
			        ellipse(50, 20, 60, 20);
			        ellipse(-50, 15, 75, 35);
			        ellipse(50, 20, 65, 25);
			        popMatrix();
			    };
			    
			    var cloud2 = function(x, y, w, h, size, color) {
			        pushMatrix();
			        translate(x, y);
			        scale(w, h);
			        cloud(0, 0, size, color);
			        popMatrix();
			    };
			    
			    var portal = function(x, y, size, c1, c2, c3) {
			        noStroke();
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        for (var i = 0; i < 10; i++) {
			            if (i < 5) {
			                fill(lerpColor(c1, c2, i / 5), 100);
			            } else {
			                fill(lerpColor(c2, c3, (i - 5) / 5), 100);
			            }
			            if (i < 9) {
			                for (var j = 0; j < 10; j++) {
			                    ellipse(sin(j * 36 + i * frameCount / 10) * (i * 4 + 10), -cos(j * 36 + i * frameCount / 10) * (i * 4 + 10), 10 + i * 2, 10 + i * 2);
			                }
			            } else {
			                noFill();
			                strokeWeight(3);
			                stroke(c3, 100);
			                for (var j = 0; j < 10; j++) {
			                    ellipse(sin(j * 36 + i * frameCount / 20) * (i * 4 + 30), -cos(j * 36 + i * frameCount / 20) * (i * 4 + 30), 8, 8);
			                }
			            }
			        }
			        noStroke();
			        fill(c1, 50);
			        pushMatrix();
			        rotate(frameCount / 20);
			        for (var i = 0; i < 20; i++) {
			            ellipse(80 + sin(frameCount + i * 100) * 10, 0, 50 + sin(i * 100) * 30, 5);
			            rotate(18);
			        }
			        popMatrix();
			        popMatrix();
			    };
			    
			    var candle = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        noStroke();
			        glow(3, -15, 30, color(255, 220, 20));
			        fill(255, 180, 10);
			        beginShape();
			        vertex(5 + sin(frameCount * 5 + x * 10 + y) * 3, -25);
			        bezierVertex(5, -15, -10, -10, 0, -5);
			        bezierVertex(15, -5, 5, -20, 5 + sin(frameCount * 5 + x * 10 + y) * 3, -25);
			        endShape();
			        fill(240, 120, 80);
			        beginShape();
			        vertex(5 + sin(frameCount * 5 + x * 10 + y) * 3, -20);
			        bezierVertex(5, -12, -8, -10, 4, -6);
			        bezierVertex(8, -10, 5, -15, 5 + sin(frameCount * 5 + x * 10 + y) * 3, -20);
			        endShape();
			        noFill();
			        stroke(0, 0, 0);
			        strokeWeight(3);
			        bezier(3, -10, 3, -10, -3, 0, 0, 33);
			        noStroke();
			        noStroke();
			        fill(240, 240, 230);
			        beginShape();
			        vertex(-10, 0);
			        vertex(3, 0);
			        vertex(5, 3);
			        vertex(7, 0);
			        vertex(10, 0);
			        vertex(11, 5);
			        vertex(10, 20);
			        vertex(11, 30);
			        vertex(10, 35);
			        vertex(10, 60);
			        bezierVertex(13, 60, 15, 62, 15, 65);
			        vertex(10, 64);
			        bezierVertex(10, 70, 5, 70, 5, 65);
			        vertex(0, 63);
			        bezierVertex(-15, 69, -15, 65, -10, 60);
			        vertex(-10, 30);
			        bezierVertex(-10, 30, -15, 30, -15, 25);
			        bezierVertex(-15, 25, -10, 10, -10, 0);
			        endShape();
			        fill(0, 0, 50, 50);
			        rect(0, 20, 3, 30, 5);
			        rect(-5, 10, 3, 50, 5);
			        popMatrix();
			    };
			
			    var windmill = function(x, y, size) {
			        pushMatrix();
			        translate(x, y);
			        scale(size / 100, size / 100);
			        stroke(50, 40, 30);
			        strokeWeight(3);
			        noFill();
			        line(0, 0, -30, 200);
			        line(0, 0, 20, 200);
			        line(0, 0, -5, 200);
			        line(-20, 150, 15, 150);
			        line(-15, 100, 10, 100);
			        line(-10, 70, 5, 70);
			        line(0, 0, 20, 0);
			        ellipse(-1, 40, 30, 8);
			        stroke(255, 255, 245, 50);
			        strokeWeight(2);
			        line(1, 0, -29, 200);
			        line(1, 0, 21, 200);
			        line(1, 0, -4, 200);
			        stroke(50, 40, 30);
			        strokeWeight(3);
			        arc(-1, 40, 30, 8, 0, 180);
			        noStroke();
			        fill(50, 40, 30);
			        beginShape();
			        vertex(-5, 0);
			        bezierVertex(-2, -10, 2, -10, 5, 0);
			        bezierVertex(5, 5, -5, 5, -5, 0);
			        endShape();
			        fill(80, 50, 30);
			        quad(20, -4, 20, 4, 40, 8, 40, -8);
			        fill(0, 0, 50, 50);
			        quad(40, 8, 40, -8, 35, -7, 35, 7);
			        noFill();
			        strokeWeight(1.2);
			        stroke(50, 40, 30);
			        for (var i = 0; i < 6; i++) {
			            line(0, 0, sin(i * 60 + frameCount) * 25, -cos(i * 60 + frameCount) * 25);
			        }
			        ellipse(0, 0, 50, 50);
			        ellipse(0, 0, 20, 20);
			        noStroke();
			        pushMatrix();
			        rotate(frameCount);
			        for (var i = 0; i < 18; i++) {
			            fill(90 + sin(i * 20 + frameCount + 120) * 15, 70 + sin(i * 20 + frameCount + 120) * 15, 50 + sin(i * 20 + frameCount + 120) * 5);
			            beginShape();
			            vertex(10, -2);
			            vertex(10, 2);
			            vertex(30, 3);
			            bezierVertex(28, 2, 28, -2, 30, -3);
			            endShape();
			            rotate(20);
			        }
			        popMatrix();
			        popMatrix();
			    };
			// }
			
			/** Button constructor **/
			var Button = (function() {
			    Button = function(x, y, w, h, txt, func) {
			        this.x = x - w / 2;
			        this.y = y - h / 2;
			        this.w = w;
			        this.h = h;
			        this.txt = txt;
			        this.func = func;
			        this.over = false;
			        this.yPlus = 0;
			    };
			    
			    Button.prototype.display = function() {
			        this.yPlus += this.yPlus.smooth(this.over ? 5 : 0, 15);
			        strokeWeight(4);
			        pushMatrix();
			        stroke(100, 90, 90);
			        fill(100, 90, 90);
			        rect(this.x, this.y + 5, this.w, this.h);
			        translate(0, this.yPlus);
			        fill(lerpColor(color(160, 100, 70), 255, this.yPlus / 50));
			        stroke(200, 160, 70);
			        rect(this.x, this.y, this.w, this.h);
			        noStroke();
			        fill(255, 255, 255, 10);
			        for (var i = 0; i < 3; i++) {
			            rect(this.x + i * this.w / 30 + this.w / 10, this.y + i * this.h / 10 + this.h / 8, this.w / (i * i + 1.5), this.h / (i * i + 1.5), 10);
			        }
			        fill(200, 160, 70);
			        ellipse(this.x + 5, this.y + 5, 10, 10);
			        ellipse(this.x + this.w - 5, this.y + 5, 10, 10);
			        ellipse(this.x + this.w - 5, this.y + this.h - 5, 10, 10);
			        ellipse(this.x + 5, this.y + this.h - 5, 10, 10);
			        fill(0, 0, 0, 50);
			        ellipse(this.x + 5, this.y + 5, 5, 5);
			        ellipse(this.x + this.w - 5, this.y + 5, 5, 5);
			        ellipse(this.x + this.w - 5, this.y + this.h - 5, 5, 5);
			        ellipse(this.x + 5, this.y + this.h - 5, 5, 5);
			        strokeWeight(5);
			        scriptFont("<" + this.txt + ">", this.x + this.w / 2, this.y + this.h / 3, this.w / 4, this.h * 1.2, color(255, 255, 255));
			        popMatrix();
			    };
			    
			    Button.prototype.check = function() {
			        return mouseX > this.x && mouseX < this.x + this.w && mouseY > this.y && mouseY < this.y + this.h;
			    };
			    
			    Button.prototype.pack = function() {
			        this.over = false;
			        if (this.check()) {
			            this.over = true;
			            overButton = true;
			            if (click) {
			                this.func();
			            }
			        }
			        this.display();
			    };
			    
			    return Button;
			})();
			
			// Buttons object
			var buttons = {
			    play : new Button(300, 550, 250, 50, "PLAY", function() {
			        resetGame();
			        sceneChange.reset(game);
			    }), cont : new Button(300, 550, 250, 50, "CONTINUE", function() {
				credits.y = 0;
			        sceneChange.reset(introPage);
			    }), back : new Button(100, 50, 150, 50, "BACK", function() {
			        sceneChange.reset(game);
			    })
			};
			
			/** Talk constructor **/
			var Talk = (function() {
			    Talk = function() {
			        this.message = "";
			        this.options = [];
			        this.functions = [];
			        this.buttons = [];
			        this.y = 600;
			        this.h = 130;
			        this.mode = "down";
			        this.txtY = 0;
			        this.txtH = 30;
			        this.funcNum = undefined;
			    };
			    
			    Talk.prototype.display = function() {
			        this.h = this.txtH * this.options.length + (this.message.length > 0 ? this.txtH + 30 : 0);
			        this.txtY = 0;
			        if (this.message.length > 0) {
			            this.txtY += this.txtH + 20;
			        }
			        noStroke();
			        fill(10, 10, 10, 50);
			        rect(0, this.y - constrain((600 - this.y) / this.txtH, 0, 5), 600, 10);
			        fill(10, 10, 10);
			        rect(0, this.y, 600, this.h);
			        fill(35, 35, 40, 60);
			        rect(50, this.y + this.h / 5, 450, this.h / 2);
			        rect(200, this.y + this.h / 3, 360, this.h / 5 * 3);
			        align = LEFT;
			        strokeWeight(4);
			        scriptFont(this.message, 10, this.y + 10, 45, 60, color(255, 255, 255));
			        for (var i = 0; i < this.buttons.length; i++) {
			            this.buttons[i].y = this.y + this.txtY + 10;
			            this.buttons[i].display(this);
			            this.txtY += this.txtH;
			        }
			        if (this.funcNum !== undefined) {
			            this.buttons[this.funcNum].func();
			        }
			        this.funcNum = undefined;
			    };
			    
			    Talk.prototype.getChoice = function(num) {
			        return {
			            txt : " > " + this.options[num],
			            x : 10,
			            y : 700,
			            h : this.txtH,
			            func : this.functions[num],
			            opac : 0,
			            display : function(parent) {
			                strokeWeight(3);
			                scriptFont(this.txt, this.x, this.y, 45, 45, color(255, 255, 255));
			                if (mouseY > this.y && mouseY < this.y + this.h) {
			                    overButton = true;
			                    this.opac += this.opac.smooth(100, 8);
			                    if (click) {
			                        parent.funcNum = num;
			                    }
			                } else {
			                    this.opac += this.opac.smooth(0, 8);
			                }
			                if (this.opac > 1) {
			                    strokeWeight(10);
			                    scriptFont(this.txt, this.x, this.y, 45, 45, color(255, 255, 255, this.opac));
			                }
			            }
			        };
			    };
			    
			    Talk.prototype.change = function(message, options, functions) {
			        this.message = message;
			        this.options = options;
			        this.functions = functions;
			        this.buttons = [];
			        for (var i = 0; i < this.options.length; i++) {
			            this.buttons.push(this.getChoice(i));
			        }
			        if (this.mode === "up") {
			            this.h = this.txtH * this.options.length + (this.message.length > 0 ? this.txtH + 30 : 0);
			            this.y = height - this.h;
			        }
			    };
			    
			    Talk.prototype.move = function() {
			        if (this.mode === "up") {
			            this.y += this.y.smooth(height - this.h, 10);
			        } else {
			            this.y += this.y.smooth(height, 10);
			        }
			    };
			    
			    return Talk;
			})();
			var talk = new Talk();
			
			// Buttons for the code scene.
			var codeButtons = (function() {
			    codeButtons = {};
			    
			    codeButtons.buttons = [];
			    codeButtons.size = 80;
			    codeButtons.code = "";
			    codeButtons.fade = 255;
			    codeButtons.match = "\u0000\u0003\u0001\u0005";
			    codeButtons.shake = 0;
			    codeButtons.chars = [
			        "\u0000",
			        "\u0001",
			        "\u0002",
			        "\u0003",
			        "\u0004",
			        "\u0005"
			    ];
			    
			    for (var i = 0; i < 6; i++) {
			        codeButtons.buttons.push(
			            {
			                x : 260 + (i % 3) * codeButtons.size,
			                y : 190 + Math.floor(i / 3) * codeButtons.size,
			                fadePlus : 0,
			                char : codeButtons.chars[i]
			            }
			        );
			    }
			    
			    codeButtons.display = function() {
			        align = CENTER;
			        noStroke();
			        fill(130, 130, 130);
			        rect(260, 190, this.size * 3, this.size * 2.1);
			        strokeWeight(2);
			        for (var i = 0; i < this.buttons.length; i++) {
			            noStroke();
			            this.buttons[i].over = false;
			            if (mouseX > this.buttons[i].x && mouseY > this.buttons[i].y && mouseX < this.buttons[i].x + this.size && mouseY < this.buttons[i].y + this.size) {
			                overButton = true;
			                this.buttons[i].fadePlus += this.buttons[i].fadePlus.smooth(1, 10);
			                if (click && this.code.length < 4) {
			                    this.code += this.buttons[i].char;
			                }
			            } else {
			                this.buttons[i].fadePlus += this.buttons[i].fadePlus.smooth(0, 10);
			            }
			            fill(100 + this.buttons[i].fadePlus * 15, 100 + this.buttons[i].fadePlus * 15, 105 + this.buttons[i].fadePlus * 10);
			            rect(this.buttons[i].x, this.buttons[i].y, this.size, this.size);
			            scriptFont(this.buttons[i].char, this.buttons[i].x + this.size / 7 * 4, this.buttons[i].y + this.size / 5, 130, 130, color(255, 255, 255));
			        }
			        if (this.code.length === 4) {
			            if (this.code !== this.match) {
			                if (this.fade === 255) {
			                    this.shake = 15;
			                }
			                this.fade += this.fade.smooth(0, 8);
			                if (this.fade <= 1) {
			                    this.code = "";
			                    this.fade = 255;
			                }
			            } else {
			                if (!player.open[0]) {
			                    player.talking = true;
			                    talk.change(
			                        "",
			                        [
			                            "The door has been opened."
			                        ], [
			                            function() {
			                                player.talking = false;
			                                talk.mode = "down";
			                            }
			                        ]
			                    );
			                    talk.mode = "up";
			                }
			                player.open[0] = true;
			            }
			        }
			        this.shake += this.shake.smooth(0, 8);
			        pushMatrix();
			        translate(sin(this.shake * 100) * this.shake, 0);
			        noStroke();
			        fill(130, 130, 130);
			        rect(260, 190 - this.size, this.size * 3, this.size / 3 * 2.3);
			        fill(100, 100, 105);
			        rect(260, 190 - this.size, this.size * 3, this.size / 3 * 2);
			        align = LEFT;
			        scriptFont(this.code, 275, 190 - this.size / 8 * 7, 100, 100, color(255, 255, 255, this.fade));
			        align = CENTER;
			        popMatrix();
			    };
			    
			    return codeButtons;
			})();
			
			/** Land constructor **/
			Land = (function() {
			    Land = function(sides) {
			        this.sides = sides;
			        this.x = this.sides[0][0];
			        this.y = this.sides[0][1];
			        this.sides.push(this.sides[0]);
			        this.pos1 = 0;
			        this.pos2 = 0;
			        this.count = 0;
			        this.x1 = 0;
			        this.x2 = 0;
			        this.y1 = 0;
			        this.y2 = 0;
			        this.fx1 = 0;
			        this.fx2 = 0;
			        this.fy1 = 0;
			        this.fy2 = 0;
			    };
			    
			    Land.prototype.display = function(c) {
			        fill(c);
			        textAlign(CENTER, CENTER);
			        noStroke();
			        beginShape();
			        for (var i = 0; i < this.sides.length; i++) {
			            vertex(this.sides[i][0], this.sides[i][1]);
			        }
			        endShape();
			    };
			    
			    Land.prototype.check = function(x, y) {
			        this.pos1 = 0;
			        this.pos2 = 0;
			        this.count = 0;
			        this.x1 = 0;
			        this.x2 = 0;
			        this.y1 = 0;
			        this.y2 = 0;
			        this.fx1 = 0;
			        this.fx2 = 0;
			        this.fy1 = 0;
			        this.fy2 = 0;
			        for (var i = 1; i < this.sides.length; i++) {
			            this.x1 = this.sides[i][0];
			            this.x2 = this.sides[i - 1][0];
			            this.y1 = this.sides[i][1];
			            this.y2 = this.sides[i - 1][1];
			            
			            this.fx1 = this.x1;
			            this.fx2 = this.x2;
			            this.fy1 = this.y1;
			            this.fy2 = this.y2;
			            
			            if (this.x1 >= this.x2) {
			                this.fx1 = this.x2;
			                this.fx2 = this.x1;
			                this.fy1 = this.y2;
			                this.fy2 = this.y1;
			            }
			            if (x < this.fx1 || x > this.fx2) {
			                continue;
			            }
			            
			            this.pos1 = (this.fx2 - this.fx1) * (y - this.fy1);
			            this.pos2 = (x - this.fx1) * (this.fy2 - this.fy1);
			            if (this.pos1 >= this.pos2) {
			                this.count ++;
			            }
			        }
			        return this.count % 2 === 1;
			    };
			    
			    Land.prototype.setPoints = function(land) {
			        this.sides = land;
			    };
			    
			    return Land;
			})();
			
			/** Block constructor **/
			Block = (function() {
			    Block = function() {
			        this.type = arguments[0];
			        this.x = arguments[1];
			        this.y = arguments[2];
			        this.collideType = undefined;
			        switch (this.type) {
			            case "circle":
			                this.w = arguments[3];
			                this.h = arguments[3];
			                this.color = arguments[4];
			                break;
			            case "rect":
			                this.w = arguments[3];
			                this.h = arguments[4];
			                this.color = arguments[5];
			                break;
			            case "water":
			                this.w = arguments[3];
			                this.h = arguments[4];
			                this.color = color(50, 90, 100, 150);
			                break;
			            case "ladder":
			                this.w = arguments[3];
			                this.h = arguments[4];
			                this.color = color(0, 0, 0);
			                break;
			        }
			    };
			    
			    Block.prototype.display = function() {
			        noStroke();
			        fill(this.color);
			        switch (this.type) {
			            case "circle":
			                ellipse(this.x, this.y, this.w, this.h);
			                break;
			            case "rect":
			                rect(this.x, this.y, this.w, this.h);
			                break;
			            case "water":
			                beginShape();
			                vertex(this.x, this.y);
			                bezierVertex(this.x + this.w / 3, this.y + sin(frameCount * 3) * 10, this.x + this.w / 3 * 2, this.y + sin(frameCount * 3 + 90) * 10, this.x + this.w, this.y);
			                vertex(this.x + this.w, this.y + this.h);
			                vertex(this.x, this.y + this.h);
			                endShape();
			                break;
			            case "ladder":
			                pushStyle();
			                strokeCap(SQUARE);
			                stroke(this.color);
			                strokeWeight(3);
			                noFill();
			                bezier(
			                    this.x, this.y, 
			                    this.x + sin(frameCount + this.x + this.y) * 3, this.y + this.h / 3, 
			                    this.x + sin(frameCount + this.x + this.y + 90) * 3, this.y + this.h / 3 * 2, 
			                    this.x, this.y + this.h
			                );
			                bezier(
			                    this.x + this.w, this.y, 
			                    this.x + this.w + sin(frameCount + this.x + this.y) * 3, this.y + this.h / 3, 
			                    this.x + this.w + sin(frameCount + this.x + this.y + 90) * 3, this.y + this.h / 3 * 2, 
			                    this.x + this.w, this.y + this.h
			                );
			                strokeWeight(2);
			                for (var i = 0; i < this.h / 10; i++) {
			                    line(this.x, this.y + i * 10 + cos(i * 173) + 5, this.x + this.w - 1, this.y + i * 10 + sin(i * 97) + 5);
			                }
			                popStyle();
			                break;
			        }
			    };
			    
			    Block.prototype.collide = function(x, y, w, h, prevX, prevY, moveType) {
			        switch (this.type) {
			            case "circle":
			                if (
			                    dist(x, y, this.x, this.y) < this.w / 2 ||
			                    dist(x + w, y, this.x, this.y) < this.w / 2 ||
			                    dist(x, y + h, this.x, this.y) < this.w / 2 ||
			                    dist(x + w, y + h, this.x, this.y) < this.w / 2
			                ) {
			                    if (moveType === "x") {
			                        if (prevX < this.x && prevX + w < this.x) {
			                            this.collideType = "left";
			                        } else if (prevX > this.x && prevX + w > this.x) {
			                            this.collideType = "right";
			                        }
			                    } else if (moveType === "y") {
			                        if (prevY < this.y && prevY + h < this.y) {
			                            this.collideType = "top";
			                        } else if (prevY > this.y && prevY + h > this.y) {
			                            this.collideType = "bottom";
			                        }
			                    }
			                    return true;
			                }
			                break;
			            case "rect":
			                if (x + w > this.x && x < this.x + this.w && y + h > this.y && y < this.y + this.h) {
			                    if (moveType === "x") {
			                        if (prevX < this.x) {
			                            this.collideType = "left";
			                        } else if (prevX > this.x) {
			                            this.collideType = "right";
			                        }
			                    } else if (moveType === "y") {
			                        if (prevY < this.y) {
			                            this.collideType = "top";
			                        } else if (prevY > this.y) {
			                            this.collideType = "bottom";
			                        }
			                    }
			                    
			                    return true;
			                }
			                break;
			            case "water":
			            case "ladder":
			                if (x + w > this.x && x < this.x + this.w && y + h > this.y && y < this.y + this.h) {
			                    return true;
			                }
			                break;
			        }
			        return false;
			    };
			    
			    Block.prototype.getCollideType = function() {
			        return this.collideType;
			    };
			    
			    Block.prototype.getType = function() {
			        return this.type;
			    };
			    
			    return Block;
			})();
			
			// Controls the main ground.
			var MAP = [
			    [
			        [], [], [], [], [],
			        // Hurt man
			        [[-200, 700], [800, 700], [800, 800], [-200, 800]],
			        // Wall
			        [[-200, 700], [800, 700], [800, 800], [-200, 800]],
			        // Ladder and clouds
			        [[-200, 700], [800, 700], [800, 800], [-200, 800]],
			        // Old building
			        [[-200, 700], [800, 700], [800, 800], [-200, 800]],
			        // Bored man
			        [[-200, 700], [800, 700], [800, 800], [-200, 800]]
			    ], [
			        // Starting room
			        [[-200, 450], [800, 450], [800, 600], [-200, 600]],
			        // Stairs inside
			        [[-200, 450], [200, 450], [600, 150], [800, 150], [800, 600], [-200, 600]],
			        // Stairs outside
			        [[-200, 150], [20, 150], [220, 250], [300, 255], [400, 265], [500, 280], [600, 300], [800, 300], [800, 600], [0, 600]],
			        // Tree
			        [[-200, 300], [50, 305], [100, 320], [200, 340], [300, 340], [450, 310], [600, 300], [800, 300], [800, 600], [-200, 600], [-200, 300]],
			        // Bridge
			        [[-200, 300], [100, 305], [150, 310], [170, 310], [200, 300], [230, 280], [270, 260], [310, 250], [350, 250], [380, 255], [440, 280], [480, 295], [500, 300], [550, 310], [600, 300], [800, 300], [800, 600], [0, 600]],
			        // Sign
			        [[-200, 300], [0, 300], [150, 330], [600, 340], [800, 320], [800, 600], [0, 600]],
			        // Ruins and Cypress trees
			        [[-200, 340], [0, 340], [50, 355], [400, 350], [450, 320], [550, 300], [600, 320], [800, 320], [800, 600], [0, 600]],
			        // Ladder and Pumpkins
			        [[-200, 320], [0, 320], [100, 370], [800, 370], [800, 600], [-200, 600]],
			        // Girl
			        [[-200, 370], [800, 380], [800, 600], [-200, 600]],
			        // Dock
			        [[-200, 380], [150, 380], [60, 500], [20, 600], [-200, 600]], [],
			        // World's Edge
			        [[-200, 700], [800, 700], [800, 800], [-200, 800]]
			    ], [
			        // Stairs down
			        [[-200, 200], [100, 200], [400, 400], [800, 400], [800, 600], [-200, 600]],
			        // Ground
			        [[-200, 400], [800, 400], [800, 600], [-200, 600]],
			        // Portal
			        [[-200, 400], [800, 400], [800, 600], [-200, 600]],
			        [], [], [], [], [], [],
			        // Underwater
			        [[-200, 500], [0, 500], [150, 550], [450, 560], [580, 510], [600, 480], [800, 480], [800, 400], [600, 400], [580, 200], [500, 0], [800, 0], [800, 600], [-200, 600]],
			        // The Dark Wastes
			        [[-200, 480], [20, 480], [25, 510], [50, 520], [100, 525], [120, 510], [160, 510], [170, 525], [305, 520], [330, 460], [370, 470], [400, 380], [600, 375], [800, 375], [800, 600], [-200, 600]],
			        // Beginning of World's Edge
			        [[-200, 375], [0, 375], [50, 380], [100, 450], [120, 550], [400, 550], [350, 600], [-200, 600]]
			    ]
			];
			
			// Holds blocks
			var blocks = [
			    [
			        [], [], [], [], [], [
			            new Block("rect", 200, 400, 400, 60, color(255, 255, 255, 0)),
			            new Block("circle", 200, 430, 60, color(255, 255, 255, 0)),
			            new Block("rect", 100, 415, 100, 30, color(255, 255, 255, 0)),
			            new Block("circle", 100, 430, 30, color(255, 255, 255, 0)),
			            new Block("rect", 0, 0, 5, 600, color(255, 255, 255, 0))
			        ], [
			            new Block("rect", 0, 400, 600, 60, color(255, 255, 255, 0)),
			            new Block("rect", 270, 200, 60, 200, color(100, 100, 105))
			        ], [
			            new Block("ladder", 380, 450, 30, 150, color(255, 255, 255, 0)),
			            new Block("rect", 0, 400, 300, 50, color(255, 255, 255, 0)),
			            new Block("rect", 0, 440, 350, 20, color(255, 255, 255, 0)),
			            new Block("rect", 500, 430, 100, 50, color(255, 255, 255, 0)),
			            new Block("rect", 450, 460, 150, 20, color(255, 255, 255, 0))
			        ], [
			            new Block("rect", 0, 430, 120, 50, color(255, 255, 255, 0)),
			            new Block("rect", 225, 438, 50, 50, color(255, 255, 255, 0)),
			            new Block("rect", 280, 450, 320, 50, color(255, 255, 255, 0)),
			            new Block("rect", 280, 435, 230, 30, color(255, 255, 255, 0)),
			            new Block("circle", 120, 455, 50, color(255, 255, 255, 0))
			        ], [
			            new Block("rect", 0, 450, 310, 50, color(255, 255, 255, 0)),
			            new Block("rect", 310, 0, 30, 600, color(255, 255, 255, 0))
			        ], [], []
			    ], [
			        [
			            new Block("rect", 250, 400, 100, 50, color(50, 50, 60))
			        ], [], [], [], [], [], [
			            new Block("rect", 390, 260, 30, 135, color(255, 255, 255, 0)),
			            new Block("circle", 460, 315, 135, color(255, 255, 255, 0)),
			            new Block("circle", 310, 360, 100, color(255, 255, 255, 0))
			        ], [
			            new Block("circle", 180, 380, 80, color(245, 140, 30)),
			            new Block("ladder", 380, 0, 30, 400)
			        ], [], [
			            new Block("water", 0, 430, 600, 170),
			            new Block("rect", 10, 380, 300, 20, color(160, 120, 90)),
			            new Block("rect", 500, 440, 100, 160, color(100, 90, 85)),
			            new Block("circle", 590, 440, 400, color(100, 90, 85)),
			            new Block("rect", 0, 590, 20, 10, color(255, 255, 255, 0))
			        ], [], [
			            new Block("rect", 400, 0, 20, 600, color(255, 255, 255, 0)),
			            new Block("rect", 200, 595, 50, 25, color(255, 255, 255, 0)),
			            new Block("rect", 220, 570, 100, 25, color(255, 255, 255, 0)),
			            new Block("rect", 270, 530, 60, 25, color(255, 255, 255, 0)),
			            new Block("rect", 300, 480, 80, 25, color(255, 255, 255, 0)),
			            new Block("rect", 150, 440, 90, 25, color(255, 255, 255, 0)),
			            new Block("rect", 30, 410, 50, 25, color(255, 255, 255, 0)),
			            new Block("rect", 15, 365, 40, 25, color(255, 255, 255, 0)),
			            new Block("rect", 105, 310, 60, 25, color(255, 255, 255, 0)),
			            new Block("rect", 150, 260, 60, 25, color(255, 255, 255, 0)),
			            new Block("rect", 190, 215, 50, 25, color(255, 255, 255, 0)),
			            new Block("rect", 205, 190, 50, 25, color(255, 255, 255, 0)),
			            new Block("rect", 250, 140, 100, 25, color(255, 255, 255, 0))
			        ]
			    ], [
			        [], [], [], [], [], [], [], [], [], [
			            new Block("water", 0, -15, 600, 615),
			            new Block("rect", 500, 0, 100, 10, color(80, 110, 95)),
			            new Block("rect", 560, 395, 40, 10, color(255, 255, 255, 0)),
			            new Block("rect", 560, 475, 40, 10, color(255, 255, 255, 0)),
			            new Block("rect", 590, 0, 10, 400, color(80, 110, 95)),
			            new Block("rect", 0, 0, 20, 10, color(100, 90, 85))
			        ], [
			            new Block("rect", 0, 0, 20, 400, color(20, 20, 20)),
			            new Block("rect", 0, 480, 20, 120, color(20, 20, 20)),
			            new Block("rect", 0, 395, 40, 10, color(255, 255, 255, 0)),
			            new Block("rect", 0, 475, 40, 10, color(255, 255, 255, 0))
			        ], [
			            new Block("rect", 400, 0, 20, 600, color(255, 255, 255, 0)),
			            new Block("rect", 0, 550, 600, 50, color(255, 255, 255, 0)),
			            new Block("rect", 150, 375, 80, 25, color(255, 255, 255, 0)),
			            new Block("rect", 200, 350, 40, 25, color(255, 255, 255, 0)),
			            new Block("rect", 250, 300, 50, 25, color(255, 255, 255, 0)),
			            new Block("rect", 320, 250, 50, 25, color(255, 255, 255, 0)),
			            new Block("rect", 100, 200, 190, 25, color(255, 255, 255, 0)),
			            new Block("rect", 50, 150, 60, 25, color(255, 255, 255, 0)),
			            new Block("rect", 20, 100, 40, 25, color(255, 255, 255, 0)),
			            new Block("rect", 100, 50, 50, 25, color(255, 255, 255, 0)),
			            new Block("rect", 150, 35, 55, 25, color(255, 255, 255, 0))
			        ]
			    ]
			];
			
			// Current level
			var level = MAP[cameraY];
			
			// New land object
			var land = new Land(level[curScene]);
			
			/** Player constructor **/
			Player = (function() {
			    // Makes a new player.
			    Player = function(x, y) {
			        this.x = x;
			        this.y = y;
			        this.startX = x;
			        this.startY = y;
			        this.w = Size / 3 * 2;
			        this.h = Size;
			        this.direc = "left";
			        this.setPoints();
			        this.size = Size;
			        this.res = 3;
			        this.prevX = this.x;
			        this.prevY = this.y;
			        this.gravity = 0;
			        this.fall = false;
			        this.next = {change: false, direc : 0, axis: ""};
			        this.touchWater = false;
			        this.touchLadder = false;
			        this.foam = [];
			        this.animAmount = 0;
			        this.xChange = 0;
			        this.yChange = 0;
			        this.collideType = "";
			        this.talking = false;
			        this.items = [];
			        this.seenLock = false;
			        this.canFindFlower = false;
			        this.open = [false, false];
			        this.leftDoor = true;
			    };
			    
			    // Draws the player.
			    Player.prototype.display = function() {
			        playerRig.setPos(this.x, this.y);
			        for (var i = this.foam.length - 1; i >= 0; i--) {
			            this.foam[i].opac --;
			            fill(255, 255, 255, this.foam[i].opac);
			            ellipse(this.foam[i].x, this.foam[i].y, this.foam[i].w, this.foam[i].h);
			            if (this.foam[i].opac <= 0) {
			                this.foam.splice(i, 1);
			            }
			        }
			        if (this.items[0] !== undefined) {
			            pushMatrix();
			            translate(playerRig.x, playerRig.y);
			            scale(playerRig.size / 100);
			            scale(playerRig.direc === "right" ? -1 : 1, 1);
			            translate(0, 30);
			            scale(1, 1 + Math.abs(sin(playerRig.walkAmount - 90) / 10));
			            translate(0, -30);
			            rotate(playerRig.bodyR);
			            noStroke();
			            translate(-2, 0);
			            rotate(playerRig.arm1R * 1.5);
			            translate(0, 5);
			            translate(0, 13);
			            rotate(playerRig.arm2R * 1.2);
			            item(0, 13, 20, -90, this.items[0]);
			            popMatrix();
			        }
			        playerRig.display();
			        if (this.items[1] !== undefined) {
			            pushMatrix();
			            translate(playerRig.x, playerRig.y);
			            scale(playerRig.size / 100);
			            scale(playerRig.direc === "right" ? -1 : 1, 1);
			            translate(0, 30);
			            scale(1, 1 + Math.abs(sin(playerRig.walkAmount - 90) / 10));
			            translate(0, -30);
			            rotate(playerRig.bodyR);
			            noStroke();
			            translate(-2, 0);
			            rotate(playerRig.arm1L * 1.5);
			            translate(0, 5);
			            translate(0, 13);
			            rotate(playerRig.arm2L * 1.2);
			            item(0, 13, 20, -90, this.items[1]);
			            popMatrix();
			        }
			    };
			    
			    // Sets collision points for the player.
			    Player.prototype.setPoints = function() {
			        this.points = [
			            {x : this.x - this.w / 2, y : this.y - this.h / 4},
			            {x : this.x + this.w / 2, y : this.y - this.h / 4},
			            {x : this.x + this.w / 2, y : this.y + this.h * 3 / 4},
			            {x : this.x - this.w / 2, y : this.y + this.h * 3 / 4}
			        ];
			    };
			    
			    // Calculates movement with land.
			    Player.prototype.moveWithLand = function(xChange, yChange, other) {
			        this.xChange = 0;
			        this.yChange = 0;
			        while (this.xChange * this.xChange + this.yChange * this.yChange < speed2 * this.res) {
			            this.x -= xChange;
			            if (this.collideWithLand(land)) {
			                this.x += xChange;
			                this.y += yChange * (this.collideType === "bottom" ? -1 : 1);
			                this.setPoints();
			                this.yChange ++;
			                this.canJump = true;
			                this.gravity = 0;
			                this.fall = false;
			                
			                if (other !== undefined) {
			                    other();
			                }
			            } else {
			                this.xChange ++;
			            }
			        }
			    };
			    
			    // Collides the player with the land.
			    Player.prototype.collideWithLand = function(land) {
			        for (var i = this.points.length - 1; i >= 0; i--) {
			            if (land.check(this.points[i].x, this.points[i].y)) {
			                if (i < this.points.length / 2) {
			                    this.collideType = "top";
			                } else {
			                    this.collideType = "bottom";
			                }
			                return true;
			            }
			        }
			        return false;
			    };
			    
			    // Collides the player with the blocks.
			    Player.prototype.collideWithBlocks = function(blocks, mode) {
			        if (mode === "x") {
			            for (var i = 0; i < blocks.length; i++) {
			                if (blocks[i].collide(this.x - this.w / 2, this.y - this.h / 4, this.w, this.h, this.prevX, this.prevY, "x")) {
			                    if (blocks[i].getType === "circle" && this.y -this.h / 4 <= blocks[i].y && this.y + this.h / 4 * 3 >= blocks[i].y) {
			                        if (blocks[i].getCollideType() === "left") {
			                            this.x = blocks[i].x - blocks[i].w / 2 - Size / 2;
			                        } else if (blocks[i].getCollideType() === "right") {
			                            this.x = blocks[i].x + blocks[i].w / 2 + Size / 2;
			                        }
			                    } else if (blocks[i].getType() === "rect") {
			                        if (blocks[i].getCollideType() === "left") {
			                            player.x = blocks[i].x - player.w / 2;
			                        } else if (blocks[i].getCollideType() === "right") {
			                            player.x = blocks[i].x + blocks[i].w + player.w / 2;
			                        }
			                    }
			                }
			            }
			        } else if (mode === "y") {
			            for (var i = 0; i < blocks.length; i++) {
			                if (blocks[i].collide(this.x - this.w / 2, this.y - this.h / 4, this.w, this.h, this.prevX, this.prevY, "y")) {
			                    if (blocks[i].getType() === "circle") {
			                        if (blocks[i].getCollideType() === "top") {
			                            this.y = getEllipsePoint(this.x + ((this.x + this.w / 2) > blocks[i].x ? -this.w / 2 : this.w / 2), this.y + this.h, blocks[i].x, blocks[i].y, blocks[i].w, blocks[i].h, "y") - this.h / 4 * 3;
			                            this.canJump = true;
			                            this.gravity = 0;
			                            this.fall = false;
			                        } else if (blocks[i].getCollideType() === "bottom") {
			                            this.y = getEllipsePoint(this.x + ((this.x + this.w / 2) > blocks[i].x ? -this.w / 2 : this.w / 2), this.y, blocks[i].x, blocks[i].y, blocks[i].w, blocks[i].h, "y") + this.h / 4;
			                            this.gravity = 0;
			                        }
			                    } else if (blocks[i].getType() === "rect") {
			                        if (blocks[i].getCollideType() === "top") {
			                            this.y = blocks[i].y - this.h / 4 * 3;
			                            this.canJump = true;
			                            this.gravity = 0;
			                            this.fall = false;
			                        } else if (blocks[i].getCollideType() === "bottom") {
			                            this.y = blocks[i].y + blocks[i].h + this.h / 4;
			                            this.gravity = 0;
			                        }
			                    } else if (blocks[i].getType() === "water") {
			                        this.gravity /= 1.3;
			                        this.canJump = true;
			                        this.touchWater = true;
			                        this.fall = false;
			                        if (this.y > blocks[i].y) {
			                            this.foam.push({x : this.x + (this.direc === "left" ? Size / 1.5 : -Size / 1.5), y : this.y, w : random(30, 40), h : 20, opac : 20});
			                        }
			                    } else if (blocks[i].getType() === "ladder") {
			                        this.touchLadder = true;
			                        this.canJump = true;
			                        this.fall = false;
			                    }
			                }
			            }
			        }
			    };
			    
			    // Moves the player.
			    Player.prototype.move = function(lastTime) {
			        this.prevX = this.x;
			        this.prevY = this.y;
			        if (this.getKey("left") && !this.getKey("right")) {
			            this.moveWithLand(1 / this.res, 1 / this.res);
			            this.direc = "left";
			            playerRig.animate(speed * 3);
			        }
			        if (this.getKey("right") && !this.getKey("left")) {
			            this.moveWithLand(-1 / this.res, 1 / this.res);
			            this.direc = "right";
			            playerRig.animate(speed * 3);
			        }
			        this.touchWater = false;
			        this.touchLadder = false;
			        
			        if (lastTime) {
			            this.collideWithBlocks(blocks[cameraY][curScene], "x");
			        }
			        
			        playerRig.setDirec(this.direc, 50);
			        
			        if (this.x < 0 && level[curScene - 1] !== undefined && level[curScene - 1].length > 0) {
			            this.next.change = true;
			            this.next.direc = -1;
			            this.next.axis = "x";
			            this.foam = [];
			        } else if (this.x > 600 && level[curScene + 1] !== undefined && level[curScene + 1].length > 0) {
			            this.next.change = true;
			            this.next.direc = 1;
			            this.next.axis = "x";
			            this.foam = [];
			        }
			        
			        if (((!this.getKey("right") && !this.getKey("left")) || (this.getKey("right") && this.getKey("left"))) && this.canJump) {
			            playerRig.setRot(0, 0, -35 + sin(frameCount) * 5, 55 - sin(frameCount) * 5, 10 - sin(frameCount) * 5, 20 + sin(frameCount) * 5, -20, 0, 20, -10);
			            playerRig.walkAmount = 0;
			        }
			        this.canJump = false;
			        
			        this.gravity += change;
			        this.gravity = constrain(this.gravity, -10, 10);
			        this.y += this.gravity;
			        
			        if (lastTime) {
			            this.collideWithBlocks(blocks[cameraY][curScene], "y");
			        }            
			
			        if (this.y < 0 && MAP[cameraY - 1] !== undefined) {
			            this.next.change = true;
			            this.next.direc = -1;
			            this.next.axis = "y";
			            this.foam = [];
			        } else if (this.y > 600 && MAP[cameraY + 1] !== undefined) {
			            this.next.change = true;
			            this.next.direc = 1;
			            this.next.axis = "y";           
			            this.foam = [];
			        }
			        
			        this.x = constrain(this.x, 0, 600);
			        this.y = constrain(this.y, 0, 600);
			        
			        this.setPoints();
			        
			        if (lastTime) {
			            this.moveWithLand(0, 1, function() {
			                this.y ++;
			                this.canJump = true;
			                this.gravity = 0;
			                this.fall = false;
			            });
			        }
			        
			        if (this.getKey("up") && this.canJump) {
			            this.gravity = -start / (this.touchWater ? 3 : 1);
			            this.fall = true;
			        }
			        
			        if (this.touchLadder) {
			            if (this.getKey("up")) {
			                this.gravity = -3;
			            } else {
			                this.gravity = 3;
			            }
			        }
			        
			        this.animAmount = frameCount * 3;
			        if (this.fall || this.gravity > 3) {
			            if (this.touchLadder && this.fall) {
			                playerRig.setRot(0, 0, -50 - sin(this.animAmount * 4 + 180) * 20, -70 + sin(this.animAmount * 4) * 20, 50 + sin(this.animAmount * 4) * 20, 70 - sin(this.animAmount * 4 + 180) * 20, 50 + sin(this.animAmount * 4 + 180) * 40, -50 + sin(this.animAmount * 4) * 40, -50 - sin(this.animAmount * 4) * 40, 50 - sin(this.animAmount * 4 + 180) * 40);
			            } else {
			                playerRig.setRot(0, 0, -50, 15, 45, 20, -50, -40, 60, -20);
			            }
			        }
			        if (this.touchWater) {
			            playerRig.setRot(0, -90, -this.animAmount * 2, -10 + sin(this.animAmount * 6) * 10, -this.animAmount * 2 + 120, -10 + sin(this.animAmount * 6) * 10, sin(this.animAmount * 6) * 15, -15 + sin(this.animAmount * 6) * 15, sin(this.animAmount * 6 + 180) * 15, -15 + sin(this.animAmount * 6) * 15);
			        } else {
			            playerRig.bodyR = 0;
			        }
			    };
			    
			    // Finds which direction the player is moving.
			    Player.prototype.getKey = function(direc) {
			        if (this.talking) {
			            return false;
			        }
			        if (direc === "left") {
			            return keys[LEFT] || keys[65];
			        } else if (direc === "right") {
			            return keys[RIGHT] || keys[68];
			        } else if (direc === "up") {
			            return keys[UP] || keys[87];
			        } else if (direc === "down") {
			            return keys[DOWN] || keys[83];
			        }
			    };
			    
			    // Finds a certain item in the player's items.
			    Player.prototype.getItem = function(item) {
			        for (var i = 0; i < this.items.length; i++) {
			            if (this.items[i] === item) {
			                return i;
			            }
			        }
			    };
			    
			    // Resets the player.
			    Player.prototype.reset =  function() {
			        this.x = this.startX;
			        this.y = this.startY;
			        this.prevX = this.x;
			        this.prevY = this.y;
			        this.gravity = 0;
			        this.fall = true;
			        this.next = {change: false, direc : 0, axis: ""};
			        this.touchWater = false;
			        this.touchLadder = false;
			        this.foam = [];
			        this.animAmount = 0;
			        this.xChange = 0;
			        this.yChange = 0;
			        this.collideType = "";
			        this.talking = false;
			        this.items = [];
			        this.seenLock = false;
			        this.canFindFlower = false;
			        this.open = [false, false];
			        this.leftDoor = true;
			        this.setPoints();
			    };
			    
			    return Player;
			})();
			player = new Player(x, y);
			
			/** Interactive constructor **/
			var Interactive = (function() {
			    Interactive = function(pic, func, condition) {
			        this.pic = pic;
			        this.func = func;
			        this.condition = condition;
			        this.counter = 0;
			        this.started = false;
			    };
			    
			    Interactive.prototype.pack = function() {
			        if (this.condition()) {
			            this.func(this);
			        }
			        this.pic();
			    };
			    
			    Interactive.prototype.done = function(parent) {
			        player.talking = false;
			        this.started = false;
			        talk.mode = "down";
			        this.counter ++;
			    };
			    
			    return Interactive;
			})();
			
			/** Other characters **/
			// {
			    // Wizard
			    var wizard = new Interactive(
			        function() {
			            drawCharacter(100, 330, "wizard", 0);
			            stroke(0, 0, 0);
			            strokeWeight(2);
			            line(88, 325, 90, 355);
			            noStroke();
			        }, function(parent) {
			            if (parent.counter < 1 && !parent.started) {
			                player.talking = true;
			                parent.started = true;
			                talk.change(
			                    "Do you wish to find a way out?",
			                    [
			                        "Yes, I do!",
			                        "Ummm..."
			                    ], [
			                        function() {
			                            talk.change(
			                                "Seek the Roamer of the Dark Wastes...",
			                                [
			                                    "Okay."
			                                ], [
			                                    function() {
			                                        parent.done();
			                                    }
			                                ]
			                            );
			                        }, function() {
			                            talk.change(
			                                "You will find what you seek...",
			                                [
			                                    "What?"
			                                ], [
			                                    function() {
			                                        talk.change(
			                                            "...from the Roamer of the Dark Wastes.",
			                                            [
			                                                "Huh..."
			                                            ], [
			                                                function() {
			                                                   parent.done();
			                                                }
			                                            ]
			                                        );
			                                    }
			                                ]
			                            );
			                        }
			                    ]
			                );
			                talk.mode = "up";
			            }
			        }, function() {
			            return dist(player.x, player.y, 100, 325) < 35;
			        }
			    );
			    
			    // Fisherman
			    var fisherman = new Interactive(
			        function() {
			            drawCharacter(250, 360, "fisherman", 0);
			            fishingPole(263, 367, 90);
			        }, function(parent) {
			            parent.itemCheck = player.getItem("coin");
			            if (parent.counter < 1 && !parent.started && player.seenLock) {
			                player.talking = true;
			                parent.started = true;
			                talk.change(
			                    "Hey kid...",
			                    [
			                        "Hello.",
			                        "What?"
			                    ], [
			                        function() {
			                            talk.change(
			                                "Yah got any change, kid?",
			                                [
			                                    "Yes, I do!",
			                                    "No, sorry."
			                                ], [
			                                    function() {
			                                        if (parent.itemCheck !== undefined) {
			                                            talk.change(
			                                                "Thanks kid, take this key.",
			                                                [
			                                                    "Thanks."
			                                                ], [
			                                                    function() {
			                                                        player.items.splice(parent.itemCheck, 1);
			                                                        player.items.push("key");
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        } else {
			                                            talk.change(
			                                                "Y're bad at lying.",
			                                                [
			                                                    "Well..."
			                                                ], [
			                                                    function() {
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        }
			                                    }, function() {
			                                        if (parent.itemCheck !== undefined) {
			                                            talk.change(
			                                                "Are yah sure? Alrigh'...",
			                                                [
			                                                    "Bye..."
			                                                ], [
			                                                    function() {
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        } else {
			                                            talk.change(
			                                                "Well, yah know where to find me...",
			                                                [
			                                                    "Yeah."
			                                                ], [
			                                                    function() {
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        }
			                                    }
			                                ]
			                            );
			                        }, function() {
			                            talk.change(
			                                "I need some money.",
			                                [
			                                    "I have some.",
			                                    "Sorry, I can't help you"
			                                ], [
			                                    function() {
			                                        if (parent.itemCheck !== undefined) {
			                                            talk.change(
			                                                "Here kid, take this key.",
			                                                [
			                                                    "Thanks."
			                                                ], [
			                                                    function() {
			                                                        player.items.splice(parent.itemCheck, 1);
			                                                        player.items.push("key");
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        } else {
			                                            talk.change(
			                                                "Y're bad at lying.",
			                                                [
			                                                    "Huh..."
			                                                ], [
			                                                    function() {
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        }
			                                    }, function() {
			                                        if (parent.itemCheck !== undefined) {
			                                            talk.change(
			                                                "Yah sure? Okay then...",
			                                                [
			                                                    "Yeah."
			                                                ], [
			                                                    function() {
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        } else {
			                                            talk.change(
			                                                "Okay, yah know where to find me...",
			                                                [
			                                                    "Okay."
			                                                ], [
			                                                    function() {
			                                                        parent.done();
			                                                    }
			                                                ]
			                                            );
			                                        }
			                                    }
			                                ]
			                            );
			                        }
			                    ]
			                );
			                talk.mode = "up";
			            } else if (parent.counter < 2 && !parent.started && player.seenLock && parent.itemCheck !== undefined) {
			                player.talking = true;
			                parent.started = true;
			                talk.change(
			                    "Yah got some money now?",
			                    [
			                        "Yup!"
			                    ], [
			                        function() {
			                            talk.change(
			                                "Great, take this here key!",
			                                [
			                                    "Thanks!"
			                                ], [
			                                    function() {
			                                        player.items.splice(parent.itemCheck, 1);
			                                        player.items.push("key");
			                                        parent.done();
			                                    }
			                                ]
			                            );
			                        }
			                    ]
			                );
			                talk.mode = "up";
			            }
			        }, function() {
			            return dist(player.x, player.y, 250, 355) < 35;
			        }
			    );
			    
				// Girl
				var girl = new Interactive(
					function() {
						drawCharacter(400, 360, "girl", 0);
					}, function(parent) {
						parent.itemCheck = player.getItem("flower");
						if (parent.counter < 1 && !parent.started) {
						    player.talking = true;
							parent.started = true;
							talk.change(
								"Hi there, mister!",
								[
									"Hi there... you?"
								], [
									function() {
										talk.change(
											"Listen, can do me a favor?",
											[
												"Sure!",
												"What kind of favor?"
											], [
												function() {
													talk.change(
														"Cool! There's an old tree...",
														[
															"Okay."
														], [
															function() {
																talk.change(
																	"...will you get me a flower from it?",
																	[
																		"Yes!"
																	], [
																		function() {
																			talk.change(
																				"Thanks!",
																				[
																					"Sure..."
																				], [
																					function() {
																						player.canFindFlower = true;
																						parent.done();
																					}
																				]
																			);
																		}
																	]
																);
															}
														]
													);
												}, function() {
													talk.change(
														"Can you get me a flower?",
														[
															"Why can't you?"
														], [
															function() {
																talk.change(
																	"Mama says I can't go that far.",
																	[
																		"Okay."
																	], [
																		function() {
																			talk.change(
																				"It's that tree you passed earlier.",
																				[
																					"Okay, sure. Wait, how did you...?"
																				], [
																					function() {
																						talk.change(
																							"Thanks!",
																							[
																								"No problem..."
																							], [
																								function() {
																									player.canFindFlower = true;
																									parent.done();
																								}
																							]
																						);
																					}
																				]
																			);
																		}
																	]
																);
															}
														]
													);
												}
											]
										);
									}
								]
							);
							talk.mode = "up";
						} else if (parent.counter < 2 && !parent.started && parent.itemCheck !== undefined) {
						    player.talking = true;
							parent.started = true;
							talk.change(
								"Did you get me a flower?",
								[
									"Yes!"
								], [
									function() {
										talk.change(
											"Here, have this turnip!",
											[
												"Ummm..."
											], [
												function() {
													talk.change(
														"It's magic, it has healing power.",
														[
															"Okay, thanks!"
														], [
															function() {
																player.items.splice(parent.itemCheck, 1);
																player.items.push("turnip");
																parent.done();
															}
														]
													);
												}
											]
										);
									}
								]
							);
							talk.mode = "up";
						}
					}, function() {
						return dist(player.x, player.y, 400, 355) < 35;
					}
				);
				
				// Hurt
				var hurtPos = 0;
				var hurt = new Interactive(
					function() {
			            drawCharacter(250, 395 - hurtPos * 5, "hurt", hurtPos);
					}, function(parent) {
						parent.itemCheck = player.getItem("turnip");
						if (parent.counter < 1 && !parent.started) {
						    player.talking = true;
							parent.started = true;
							talk.change(
								"H-help, HELP!!!",
								[
									"Are you hurt?"
								], [
									function() {
										talk.change(
											"Yes, I broke my leg bouncing.",
											[
												"Oof, that must hurt.",
												"What can I do?"
											], [
												function() {
													talk.change(
														"Yes, can you find a magic turnip?",
														[
															"Okay, from where?"
														], [
															function() {
																talk.change(
																	"Someone's bound to have one.",
																	[
																		"Okay, I'll try to find one."
																	], [
																		function() {
																			talk.change(
																				"Thanks!",
																				[
																					"Yeah."
																				], [
																					function() {
																						parent.done();
																					}
																				]
																			);
																		}
																	]
																);
															}
														]
													);
												}, function() {
													talk.change(
														"Will you find for me a magic turnip?",
														[
															"Why? Can it heal you?"
														], [
															function() {
																talk.change(
																	"Yes. Someone should have one.",
																	[
																		"Okay."
																	], [
																		function() {
																			talk.change(
																				"Thank you!",
																				[
																					"No problem..."
																				], [
																					function() {
																						parent.done();
																					}
																				]
																			);
																		}
																	]
																);
															}
														]
													);
												}
											]
										);
									}
								]
							);
							talk.mode = "up";
						}
						if (parent.counter < 2 && !parent.started && parent.itemCheck !== undefined) {
						    player.talking = true;
							parent.started = true;
							talk.change(
								"You have a magic turnip?",
								[
									"Yes, take it!"
								], [
									function() {
										talk.change(
											"Thank you so much!",
											[
												"Yup!"
											], [
												function() {
													talk.change(
														"Uh, take this telescope.",
														[
															"Huh, cool!"
														], [
															function() {
																player.items.splice(parent.itemCheck, 1);
																player.items.push("telescope");
																hurtPos = 1;
																parent.done();
															}
														]
													);
												}
											]
										);
									}
								]
							);
							talk.mode = "up";
						}
					}, function() {
						return dist(player.x, player.y, 250, 390) < 35;
					}
				);
				
				// Bored
			    var boredPos = 0;
				var bored = new Interactive(
					function() {
						drawCharacter(290, 435, "bored", boredPos);
						if (boredPos === 1) {	
			                item(305, 435, 10, -90, "telescope");
			            }
					}, function(parent) {
						parent.itemCheck = player.getItem("telescope");
						if (parent.counter < 1 && !parent.started) {
						    player.talking = true;
							parent.started = true;
							talk.change(
								"Nothing ever changes around here...",
								[
									"Hmmm..."
								], [
									function() {
										talk.change(
											"Wish I had something to do.",
											[
												"Huh."
											], [
												function() {
													parent.done();
												}
											]
										);
									}
								]
							);
							talk.mode = "up";
						}
						if (parent.counter < 2 && !parent.started && parent.itemCheck !== undefined) {
						    player.talking = true;
							parent.started = true;
							talk.change(
								"Ooh, a telescope? For me?",
								[
									"Yes, to give you something to do."
								], [
									function() {
										talk.change(
											"Thanks!",
											[
												"Of course."
											], [
												function() {
													talk.change(
														"Here's some money.",
														[
															"Could come in handy!"
														], [
															function() {
																player.items.splice(parent.itemCheck, 1);
																player.items.push("coin");
																boredPos = 1;
																parent.done();
															}
														]
													);
												}
											]
										);
									}
								]
							);
							talk.mode = "up";
						}
					}, function() {
						return dist(player.x, player.y, 290, 430) < 35;
					}
				);
			// }
			
			// Glowing orb
			var orb = {
			    x : 300,
			    y : 120,
			    flashOpac : 255,
			    flashSize : 0,
			    collected : false,
			    display : function() {
			        if (!this.collected) {
			            item(this.x, this.y, 10, sin(frameCount * 2) * 5, "orb");
			            if (dist(player.x, player.y + Size / 4, this.x, this.y) < 10) {
			                this.collected = true;
			                player.items.push("orb");
			            }
			        } else {
			            noStroke();
			            this.flashSize += 8;
			            this.flashOpac -= 10;
			            fill(255, 255, 255, this.flashOpac);
			            ellipse(this.x, this.y, this.flashSize, this.flashSize);
			        }
			    }
			};
			
			// Moving words for the Roamer of the Dark Wastes. 
			var speech = (function() {
			    speech = {};
			    speech.message = "\u0000\u0003\u0001\u0005 ";
			    speech.curMessage = 0;
			    speech.x = 440;
			    speech.y = 460;
			    speech.chars = [];
			    speech.startTime = 35;
			    speech.timer = speech.startTime;
			    speech.pack = function() {
			        this.timer --;
			        if (this.timer < 0) {
			            this.chars.push(
			                {
			                    x : this.x,
			                    y : this.y,
			                    xMove : 0,
			                    opac : 255,
			                    txt : this.message[this.curMessage],
			                    timer : 10
			                }
			            );
			            this.curMessage = (this.curMessage + 1) % this.message.length;
			            this.timer = this.startTime;
			        }
			        strokeWeight(3);
			        for (var i = this.chars.length - 1; i >= 0; i--) {
			            pushMatrix();
			            translate(this.chars[i].x, this.chars[i].y);
			            rotate(sin(frameCount * 2 + i * 50) * 5);
			            scriptFont(this.chars[i].txt, 0, 0, 50, 50, color(255, 255, 255, this.chars[i].opac));
			            popMatrix();
			            this.chars[i].xMove += 0.01;
			            this.chars[i].x -= this.chars[i].xMove;
			            this.chars[i].y -= 0.5;
			            this.chars[i].timer --;
			            if (this.chars[i].timer <= 0) {
			                this.chars[i].opac -= 5;
			            }
			            if (this.chars[i].opac <= 0) {
			                this.chars.splice(i, 1);
			            }
			        }
			    };
			    
			    return speech;
			})();
			
			/** Environment **/
			// {
			    /** Flower constructor **/
			    Flower = (function() {
			        var Flower = function(x, y) {
			            this.x = x;
			            this.y = y;
			            this.r = random(360);
			            this.angle = 220 + random(-40, 40);
			            this.rPlus = random(2, 3);
			            this.grav = 0;
			            this.fade = 255;
			        };
			        
			        Flower.prototype.display = function() {
			            drawFlower(this.x, this.y, 10, this.r, this.fade);
			            this.r += this.rPlus;
			        };
			        
			        Flower.prototype.move = function() {
			            this.angle += this.grav;
			            this.x += sin(this.angle);
			            this.y -= cos(this.angle);
			            if (this.angle < 190) {
			                this.grav += 0.03;
			            }
			            if (this.angle > 250) {
			                this.grav -= 0.03;
			            }
			            this.grav = constrain(this.grav, -12, 12);
			            if (this.out()) {
			                this.fade -= 15;
			            }
			        };
			        
			        Flower.prototype.out = function() {
			            return this.x > 600 || this.y < 0 || this.y > 330;
			        };
			        
			        Flower.prototype.dead = function() {
			            return this.fade < 1;
			        };
			        
			        return Flower;
			    })();
			    
			    /** Sliver constructor **/
			    Sliver = (function() {
			        Sliver = function(x, y, yPlus) {
			            this.size = Math.floor(random(50, 100));
			            this.x = x;
			            this.y = y + yPlus + random(100);
			            this.opacity = Math.floor(random(30, 70));
			            this.startY = y;
			            this.start = true;
			            this.goal = random(40, 60);
			            this.fade = random(3, 6);
			        };
			        
			        Sliver.prototype.display = function() {
			            noStroke();
			            sliver(this.x, this.y, this.size / 6, this.size, this.opacity);
			            this.y += 3;
			            if (this.start) {
			                if (this.opacity < this.goal) {
			                    this.opacity += 5;
			                }
			                if (this.opacity >= this.goal && this.y > 500) {
			                    this.start = false;
			                }
			            } else {
			                this.opacity -= this.fade;
			            }
			            if (this.opacity < 1) {
			                this.goal = Math.floor(random(30, 70));
			                this.size = Math.floor(random(50, 100));
			                this.y = this.startY;
			                this.start = true;
			                this.fade = random(0.2, 0.5);
			            }
			        };
			        
			        return Sliver;
			    })();
			    var slivers = (function() {
			        slivers = [];
			        for (var i = 0; i < 8; i++) {
			            slivers.push(new Sliver(random(255, 375), 330, i * 20));
			        }
			        return slivers;
			    })();
			    
			    /** Particle constructor **/
			    Particle = (function() {
			        Particle = function(x, y, color) {
			            this.x = x;
			            this.y = y;
			            this.color = color;
			            this.startX = x;
			            this.startY = y;
			            this.size = Math.floor(random(10, 15));
			            this.opacity = random(50, 100);
			            this.angle = Math.floor(random(90)) - 45;
			            this.speed = random(0.5, 2);
			            this.fade = random(0.5, 1.5);
			        };
			        
			        Particle.prototype.display = function() {
			            noStroke();
			            fill(this.color, this.opacity);
			            ellipse(this.x, this.y, this.size, this.size);
			            this.x += sin(this.angle) * this.speed;
			            this.y -= cos(this.angle) * this.speed / 1.5;
			            this.opacity -= this.fade;
			            if (this.opacity < 1) {
			                this.opacity = 100;
			                this.x = this.startX;
			                this.y = this.startY;
			                this.angle = Math.floor(random(90)) - 45;
			                this.speed = random(0.5, 2);
			                this.fade = random(1.5, 3);
			            }
			        };
			        
			        return Particle;
			    })();
			    var particles = (function() {
			        particles = [];
			        for (var i = 0; i < 50; i++) {
			            particles.push(new Particle(random(255, 385), 610, color(255, 255, 255)));
			        }
			        return particles;
			    })();
			    var sparks = (function() {
			        sparks = [];
			        for (var i = 0; i < 30; i++) {
			            sparks.push(new Particle(random(470, 490), 525, color(255, 120, 10)));
			        }
			        return sparks;
			    })();
			    
			    /** windLeaf constructor **/
			    windLeaf = (function() {
			        windLeaf = function() {
			            this.x = random(width);
			            this.y = random(height / 3 * 2);
			            this.r = random(360);
			            this.color = color(220 + random(-10, 10), 190 + random(-10, 10), 120 + random(-10, 10));
			            this.speed = random(-0.25, 0.25);
			        };
			        
			        windLeaf.prototype.move = function() {
			            this.x += 1 + this.speed;
			            this.x = this.x > width + 20 ? -0 : this.x;
			            this.r += constrain(this.speed * 50, -2, 2);
			        };
			        
			        windLeaf.prototype.display = function() {
			            pushMatrix();
			            translate(this.x, this.y + sin(this.x) * 40 * this.speed);
			            rotate(this.r);
			            fill(this.color);
			            noStroke();
			            ellipse(0, 0, 5, 10);
			            popMatrix();
			        };
			        
			        windLeaf.prototype.pack = function() {
			            this.move();
			            this.display();
			        };
			        
			        return windLeaf;
			    })();
			    var windLeaves = (function() {
			        windLeaves = [];
			        for (var i = 0; i < 10; i++) {
			            windLeaves.push(new windLeaf());
			        }
			        return windLeaves;
			    })();
			    
			    /** windGrass constructor **/
			    windGrass = (function() {
			        windGrass = function(x, y, w, h) {
			            this.x = random(x, x + w);
			            this.y = random(y, y + h);
			            this.r = 2;
			            this.color = color(220 + random(-10, 10), 190 + random(-10, 10), 120 + random(-10, 10));
			            this.veloc = 0;
			            this.time = this.x * 3 + this.y / 8;
			        };
			        
			        windGrass.prototype.move = function(x, y, amount) {
			            this.time += 25;
			            if (dist(this.x, this.y - 20, x, y) < 20) {
			                this.veloc = constrain(amount, -1, 1) * 10;
			            }
			            this.r += this.veloc;
			            this.r = constrain(this.r, -70, 70);
			            this.r += this.r.smooth(25 + sin(this.time) * 15, 5);
			            this.veloc += this.veloc.smooth(0, 4);
			        };
			        
			        windGrass.prototype.display = function() {
			            stroke(lerpColor(this.color, color(255, 250, 200), map(constrain(Math.abs(this.r), 20, 40), 20, 40, 0, 0.3)));
			            strokeWeight(1.5 + sin(this.x * 175) / 5 + cos(this.y * 170) / 5);
			            noFill();
			            pushMatrix();
			            translate(this.x, this.y);
			            bezier(0, 0, sin(this.r / 4) * 10, -cos(this.r / 4) * 10, sin(this.r / 2) * 20, -cos(this.r / 2) * 20, sin(this.r) * 30, -cos(this.r) * 30);
			            popMatrix();
			        };
			        
			        windGrass.prototype.pack = function() {
			            this.move(player.x, player.y + Size / 4, player.x - player.prevX);
			            this.display();
			        };
			        
			        return windGrass;
			    })();
			    var windGrassAll = (function() {
			        windGrassAll = [[], [], [], []];
			        for (var i = 0; i < 80; i++) {
			            windGrassAll[0].push(new windGrass(195, 340, 405, 15));
			            windGrassAll[1].push(new windGrass(0, 355, width, 15));
			            windGrassAll[2].push(new windGrass(0, 370, width, 15));
			            windGrassAll[3].push(new windGrass(0, 380, width, 15));
			        }
			        return windGrassAll;
			    })();
			    
			    /** Fish constructor **/
			    Fish = (function() {
			        Fish = function() {
			            this.x = random(width);
			            this.y = random(height);
			            this.speed = random(0.3);
			            this.direc = Math.floor(random(2)) * 2 - 1;
			        };
			        
			        Fish.prototype.pack = function() {
			            fill(30, 70, 90);
			            noStroke();
			            ellipse(this.x, this.y, 10, 5);
			            triangle(this.x, this.y, this.x + 10 * this.direc, this.y - 3, this.x + 10 * this.direc, this.y + 3);
			            this.x += this.speed * -this.direc;
			        };
			        
			        return Fish;
			    })();
			    var fishAll = (function() {
			        fishAll = [];
			        for (var i = 0; i < 20; i++) {
			            fishAll.push(new Fish());
			        }
			        
			        return fishAll;
			    })();
			    
			    /** Rain constructor **/
			    Rain = (function() {
			        Rain = function() {
			            this.x = random(width);
			            this.y = random(height);
			            this.angle = random(-3, 3);
			            this.speed = random(14, 16);
			        };
			        
			        Rain.prototype.pack = function() {
			            noStroke();
			            fill(245, 245, 255, 20);
			            pushMatrix();
			            translate(this.x, this.y);
			            rotate(this.angle);
			            rect(0, 0, 2, 30, 5);
			            popMatrix();
			            this.x -= sin(this.angle) * this.speed;
			            this.y += cos(this.angle) * this.speed;
			            if (this.y > height) {
			                this.x = random(width);
			                this.y = -30;
			                this.angle = random(-3, 3);
			                this.speed = random(14, 16);
			            }
			            if (this.x < 0) {
			                this.x = width + 30;
			            }
			            if (this.x > width) {
			                this.x = -30;
			            }
			        };
			        
			        return Rain;
			    })();
			    var rainAll = (function() {
			        rainAll = [];
			        
			        for (var i = 0; i < 80; i++) {
			            rainAll.push(new Rain());
			        }
			        
			        return rainAll;
			    })();
			    
			    /** Clouds **/
			    var clouds = (function() {
			        clouds = [];
			        for (var i = 0; i < 8; i++) {
			            clouds.push({x : random(width), y : random(height / 2), size : random(30, 60), speed : random(0.3, 0.4)});
			        }
			        return clouds;
			    })();
			// }
			
			/** Image loading **/
			var curImg = 0;
			var loadMode = "backgrounds";
			var grassAng, grassDist, grassX, grassY, Color, shade;
			var backgroundLoad = backgroundLoad || {
			    darkRoom : function() {
			        background(0, 0, 0);
			        noStroke();
			        for (var i = 0; i < 500; i++) {
			            fill(80, 80, 85, i / 2.5);
			            rect(0, i, 600, 1);
			        }
			        fill(30, 30, 30, 100);
			        rect(100, 200, 450, 5, 5);
			        rect(90, 300, 460, 5, 5);
			        rect(70, 400, 430, 5, 5);
			        bricks(80, 430, 2);
			        bricks(460, 350, 3);
			        
			        fill(200, 195, 180);
			        rect(250, 100, 100, 90);
			        
			        fill(80, 80, 75);
			        rect(270, 100, 5, 90);
			        rect(325, 100, 5, 90);
			        
			        fill(55, 55, 60);
			        rect(240, 90, 120, 10);
			        rect(240, 190, 120, 10);
			        
			        strokeWeight(1);
			        for (var i = 0; i < 310; i++) {
			            stroke(255, 255, 255, i / 4);
			            line(250 - i / 12, 190 + i, 350 + i / 12, 190 + i);
			        }
			    }, stairsInBackground : function() {
			        background(0, 0, 0);
			        noStroke();
			        for (var i = 0; i < 500; i++) {
			            fill(80, 80, 85, i / 2.5);
			            rect(0, i, 600, 1);
			        }
			        fill(20, 20, 20, 200);
			        rect(285, 200, 10, 60);
			        rect(305, 200, 10, 60);
			        rect(135, 200, 10, 60);
			        rect(155, 200, 10, 60);
			        rect(435, 200, 10, 60);
			        rect(455, 200, 10, 60);
			        fill(30, 30, 30, 100);
			        rect(100, 180, 450, 5, 5);
			        rect(80, 300, 500, 5, 5);
			        rect(110, 400, 420, 5, 5);
			        bricks(100, 430, 3);
			        bricks(450, 150, 2);
			        pushMatrix();
			        translate(0, -30);
			        strokeWeight(1);
			        for (var i = 0; i < 200; i++) {
			            stroke(255, 255, 255, i / 2);
			            line(400 + i, 50 + i / 10, 400 + i, 150 - i / 10);
			        }
			        for (var i = 0; i < 200; i++) {
			            stroke(255, 255, 255, i / 2);
			            line(400 + i, 110 - i / 100, 450 + i, 190 - i / 8);
			        }
			        noStroke();
			        popMatrix();
			    }, dismalBackground : function() {
			        background(225, 220, 205);
			        noStroke();
			        fill(215, 210, 195);
			        rect(0, 0, 600, 160);
			        fill(205, 200, 185);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 20, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 7);
			        mountain(400, 500, 500);
			        mountain(200, 500, 700);
			        mountain2(-400, 500, 1000);
			        mountain2(0, 500, 700);
			        filter(BLUR, 2);
			    }, grassHill : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(190, 165, 95);
			        ellipse(300, 600, 1200, 600);            
			        noFill();
			        for (var i = 0; i < 1400; i++) {
			            grassAng = random(180) - 90;
			            grassDist = 60 + Math.abs(sin(i * 103)) * 240;
			            grassX = 300 + sin(grassAng) * grassDist * 2;
			            grassY = 600 - cos(grassAng) * grassDist;
			            Color = random(20);
			            shade = dist(grassX, grassY, 0, 600) / 30;
			            stroke(160 + Color + shade, 130 + Color + shade, 60 + Color + shade);
			            strokeWeight(0.4 + grassY / 500);
			            bezier(grassX, grassY, grassX, grassY / 10 * 9.9, grassX, grassY / 10 * 9.7, grassX + grassY / 80, grassY / 10 * 9.5);
			        }
			    }, dismalTransition : function() {
			        background(225, 220, 205);
			        noStroke();
			        fill(215, 210, 195);
			        rect(0, 0, 600, 160);
			        fill(205, 200, 185);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 20, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 7);
			        mountain(150, 500, 500);
			        mountain2(-400, 500, 1000);
			        mountain2(-100, 500, 700);
			        fill(220, 195, 110);
			        beginShape();
			        vertex(360, 340);
			        bezierVertex(420, 280, 510, 280, 600, 340);
			        vertex(600, 600);
			        vertex(400, 600);
			        bezierVertex(480, 500, 280, 420, 360, 340);
			        endShape();
			        filter(BLUR, 2);
			    }, dismalHill : function() {
			        background(225, 220, 205);
			        noStroke();
			        fill(215, 210, 195);
			        rect(0, 0, 600, 160);
			        fill(205, 200, 185);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 20, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 7);
			        fill(235, 210, 115);
			        beginShape();
			        vertex(0, 280);
			        for (var i = 0; i < 3; i++) {
			            bezierVertex(i * 200 + 50, 230, i * 200 + 100, 230, i * 200 + 150, 280);
			            bezierVertex(i * 200 + 165, 300, i * 200 + 185, 300, i * 200 + 200, 280);
			        }
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        fill(220, 195, 110);
			        beginShape();
			        vertex(0, 340);
			        for (var i = 0; i < 2; i++) {
			            bezierVertex(i * 300 + 50, 280, i * 300 + 150, 280, i * 300 + 200, 340);
			            bezierVertex(i * 300 + 215, 360, i * 300 + 285, 360, i * 300 + 300, 340);
			        }
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        filter(BLUR, 2);
			    }, swampBackground : function() {
			        background(110, 130, 125);
			        noStroke();
			        fill(100, 120, 120);
			        rect(0, 0, 600, 160);
			        fill(90, 110, 115);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 20, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 8); 
			    }, twilightBackground : function() {
			        background(250, 180, 140);
			        noStroke();
			        fill(210, 150, 225);
			        rect(0, 0, 600, 160);
			        fill(230, 170, 200);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 20, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 8);
			        for (var i = 0; i < 100; i++) {
			            starSize = random(2, 5);
			            fill(255, 255, 255, random(100, 130));
			            ellipse(random(width), random(height), starSize, starSize);
			        }
			    }, nightBackground : function() {
			        background(70, 50, 150);
			        noStroke();
			        fill(45, 30, 140);
			        rect(0, 0, 600, 160);
			        fill(20, 30, 140);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 20, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 8);
			        
			        for (var i = 0; i < 200; i++) {
			            starSize = random(2, 5);
			            fill(255, 255, 255, random(100, 130));
			            ellipse(random(width), random(height), starSize, starSize);
			        }
			        fill(220, 220, 230, 5);
			        for (var i = 0; i < 10; i++) {
			            ellipse(500, 70, 70 + i * 4, 70 + i * 4);
			        }
			        fill(220, 220, 230);
			        ellipse(500, 70, 70, 70);
			        fill(0, 0, 0, 20);
			        ellipse(490, 65, 40, 40);
			        ellipse(485, 85, 15, 15);
			        fill(25, 15, 130);
			        arc(500, 70, 71, 71, -80, 50);
			        arc(511, 67, 60, 65, 65, 260);
			    }, darkShade : function() {
			        background(255, 255, 255, 0);
			        for (var i = 0; i < 200; i++) {
			            stroke(90, 110, 115, i / 2);
			            line(400 + i, 0, 600 + i, 400);
			        }
			    }, statueBackground : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(140, 140, 135);
			        beginShape();
			        vertex(240, 360);
			        vertex(260, 330);
			        vertex(270, 328);
			        vertex(290, 310);
			        vertex(320, 305);
			        vertex(345, 320);
			        vertex(360, 340);
			        vertex(360, 360);
			        endShape();
			        fill(0, 0, 50, 50);
			        beginShape();
			        vertex(270, 360);
			        vertex(270, 340);
			        vertex(280, 335);
			        vertex(300, 340);
			        vertex(330, 330);
			        vertex(350, 360);
			        endShape();
			        
			        statue(450, 320, 180, 40);
			    }, waterBackground : function() {
			        background(110, 130, 125);
			        noStroke();
			        fill(0, 0, 0, 50);
			        beginShape();
			        vertex(0, 200);
			        bezierVertex(70, 195, 150, 200, 150, 205);
			        bezierVertex(155, 210, 155, 230, 155, 240);
			        bezierVertex(190, 260, 200, 240, 200, 270);
			        bezierVertex(230, 290, 260, 300, 300, 290);
			        bezierVertex(280, 290, 270, 280, 260, 270);
			        bezierVertex(270, 270, 290, 260, 310, 260);
			        bezierVertex(270, 255, 245, 250, 230, 255);
			        bezierVertex(230, 245, 220, 235, 225, 230);
			        bezierVertex(260, 230, 320, 225, 400, 230);
			        bezierVertex(400, 250, 430, 270, 450, 270);
			        bezierVertex(550, 270, 600, 290, 650, 300);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        filter(BLUR, 1);
			        beginShape();
			        vertex(0, 320);
			        bezierVertex(100, 320, 140, 330, 150, 350);
			        bezierVertex(450, 390, 500, 320, 600, 340);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        filter(BLUR, 2);
			    }, darkBackground : function() {
			        background(50, 50, 50);
			        noStroke();
			        fill(40, 40, 40);
			        rect(0, 0, 600, 160);
			        fill(30, 30, 30);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 20, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 7);
			        deadTree(130, 260, 25);
			        deadTree(160, 300, 50);
			        deadTree(390, 300, 60);
			        noStroke();
			        fill(40, 40, 40);
			        beginShape();
			        vertex(0, 300);
			        vertex(100, 330);
			        vertex(120, 280);
			        vertex(150, 285);
			        vertex(155, 320);
			        vertex(280, 340);
			        vertex(290, 320);
			        vertex(310, 320);
			        vertex(325, 270);
			        vertex(370, 275);
			        vertex(400, 350);
			        vertex(500, 330);
			        vertex(520, 300);
			        vertex(550, 310);
			        vertex(560, 340);
			        vertex(600, 345);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        filter(BLUR, 2);
			    }, darkTransition : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(0, 0, 0, 10);
			        for (var i = 0; i < 20; i++) {
			            ellipse(0, 400, 100 + i * 16, 100 + i * 16);
			        }
			    }, nightShade : function() {
			        background(255, 255, 255, 0);
			        for (var i = 0; i < 200; i++) {
			            stroke(70, 50, 150, i / 2);
			            line(400 + i, 0, 600 + i, 400);
			        }
			    }, darkHouse : function() {
			        background(0, 0, 0);
			        noStroke();
			        for (var i = 0; i < 500; i++) {
			            fill(80, 80, 85, i / 2.5);
			            rect(0, i, 600, 1);
			        }
			        fill(20, 20, 20, 200);
			        rect(285, 200, 10, 60);
			        rect(305, 200, 10, 60);
			        rect(135, 200, 10, 60);
			        rect(155, 200, 10, 60);
			        rect(435, 200, 10, 60);
			        rect(455, 200, 10, 60);
			        fill(30, 30, 30, 100);
			        rect(100, 180, 450, 5, 5);
			        rect(80, 300, 500, 5, 5);
			        rect(110, 400, 420, 5, 5);
			        bricks(300, 330, 3);
			        bricks(450, 200, 2);
			    }, glowPart : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        for (var i = 0; i < 20; i++) {
			            fill(lerpColor(color(255, 220, 50), color(80, 190, 255), i / 20), 10 + i * 5);
			            ellipse(900, 350, 1400 - i * 60, 1400 - i * 60);
			        }
			    }, glowFull : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        for (var i = 0; i < 20; i++) {
			            fill(lerpColor(color(255, 220, 50), color(80, 190, 255), i / 20), 10 + i * 5);
			            ellipse(300, 350, 1400 - i * 60, 1400 - i * 60);
			        }
			    }, thumbnail : function() {
			        // Background
			        background(255, 210, 190);
			        noStroke();
			        fill(100, 70, 160);
			        rect(0, 0, 600, 120);
			        fill(200, 150, 200);
			        for (var i = 0; i < width / 4; i++) {
			            bgNoiseAmt = 50 + map(noise((i + 180) / 25), 0, 1, 0, 200);
			            rect(i * 4, bgNoiseAmt - 60, 4, 140 + map(noise(i / 25), 0, 1, 0, 200) - bgNoiseAmt, 2);
			        }
			        filter(BLUR, 8);
			        
			        for (var i = 0; i < 50; i++) {
			            starSize = random(2, 5);
			            fill(255, 255, 255, random(100, 130));
			            ellipse(random(width), random(50), starSize, starSize);
			        }
			        
			        // Trees
			        noStroke();
			        birch(30, 310, 100);
			        birch(-20, 250, 150);
			        
			        cypress(600, 270, 65, 210);
			        cypress(560, 300, 55, 180);
			        statue(450, 440, 120, 25);
			        
			        // Ground
			        strokeWeight(15);
			        stroke(10, 60, 40);
			        fill(120, 95, 80);
			        beginShape();
			        vertex(0, 420);
			        bezierVertex(100, 420, 200, 490, 300, 490);
			        bezierVertex(400, 490, 550, 420, 610, 420);
			        vertex(610, 610);
			        vertex(0, 610);
			        endShape();
			        
			        // Ground shadow
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 450);
			        vertex(100, 480);
			        vertex(200, 500);
			        vertex(300, 530);
			        vertex(400, 520);
			        vertex(500, 480);
			        vertex(600, 460);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        fill(0, 0, 0, 30);
			        ellipse(40, 570, 100, 100);
			        ellipse(150, 620, 120, 120);
			        ellipse(500, 600, 80, 80);
			        ellipse(620, 550, 140, 140);
			        
			        // Hanging foliage
			        strokeCap(ROUND);
			        stroke(10, 60, 40);
			        line(30, 425, 30, 500);
			        line(50, 430, 50, 480);
			        line(500, 450, 500, 490);
			        
			        // Other details
			        lantern(570, 410, 80);
			        
			        scarecrow(140, 410, 30, -5, 3);
			        pumpkin(120, 430, 50, 50, 5);
			        pumpkin(150, 445, 40, 30, 15);
			        
			        // Text
			        strokeJoin(MITER);
			        drawWaves(300, 265, 10, 280, 123);
			        
			        fill(255, 255, 255, 40);
			        rect(0, 0, width, height);
			        
			        title(300, 200, 120);
			        
			        strokeWeight(4);
			        align = CENTER;
			        scriptFont("<BY GREEN GHOST>", 300, 550, 80, 80, color(255, 255, 255));
			        
			        // Scripty thing
			        stroke(100, 100, 110);
			        pushMatrix();
			        translate(0, -40);
			        noFill();
			        beginShape();
			        vertex(230, 390);
			        bezierVertex(270, 390, 330, 430, 370, 430);
			        bezierVertex(400, 430, 400, 410, 360, 415);
			        bezierVertex(330, 415, 280, 450, 250, 450);
			        bezierVertex(230, 450, 220, 440, 260, 440);
			        bezierVertex(290, 440, 310, 470, 340, 470);
			        bezierVertex(370, 470, 370, 460, 330, 460);
			        bezierVertex(300, 460, 300, 490, 280, 490);
			        bezierVertex(260, 495, 260, 475, 290, 480);
			        bezierVertex(300, 480, 310, 500, 320, 500);
			        endShape();
			        popMatrix();
			    }
			};
			var foregroundLoad = foregroundLoad || {
			    darkRoom : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        brickFloor();
			        glowTree(265, 280, 150);
			        fill(30, 30, 40);
			        rect(250, 400, 100, 50);
			        fill(70, 70, 65);
			        rect(245, 400, 110, 5);
			        fill(0, 0, 50, 25);
			        rect(255, 400, 90, 5);
			        for (var i = 0; i < 100; i++) {
			            stroke(255, 255, 245, 20 + sin(i / 5 * 9 + 180) * 20);
			            line(250 + i, 405, 250 + i, 450);
			        }
			        noStroke();
			        bricks(255, 420, 3);
			        bricks(325, 410, 2);
			        
			        light(300, 240, color(70, 190, 255));
			        light(310, 245, color(70, 190, 255));
			        light(240, 250, color(70, 190, 255));
			        light(255, 220, color(70, 190, 255));
			        light(530, 420, color(255, 255, 255));
			        light(545, 430, color(255, 255, 255));
			        light(585, 410, color(255, 255, 255));
			        light(575, 425, color(255, 255, 255));
			        light(550, 400, color(255, 255, 255));
			        
			        // Door
			        fill(30, 30, 35);
			        rect(40, 350, 10, 100);
			        rect(110, 350, 10, 100);
			        (rect)(60, 335, 40, 15, 10, 10, 0, 0);
			        
			        fill(50, 50, 55);
			        rect(50, 350, 60, 100);
			        
			        fill(0, 0, 10, 50);
			        arc(45, 450, 10, 25, 181, 360);
			        arc(115, 450, 10, 30, 181, 360);
			        
			        rect(65, 350, 5, 100);
			        rect(90, 350, 5, 100);
			        
			        fill(255, 255, 245, 30);
			        for (var i = 0; i < 3; i++) {
			            ellipse(60, 370 + i * 30, 5, 5);
			            ellipse(100, 370 + i * 30, 5, 5);
			        }
			        
			        fill(25, 25, 30);
			        ellipse(80, 370, 10, 5);
			        rect(76, 380, 8, 4);
			        pushStyle();
			        noFill();
			        stroke(25, 25, 30);
			        strokeWeight(2);
			        ellipse(80, 376, 10, 12);
			        
			        strokeJoin(BEVEL);
			        stroke(0, 0, 10, 50);
			        strokeWeight(3);
			        beginShape();
			        vertex(65, 335);
			        vertex(72, 350);
			        vertex(80, 335);
			        vertex(88, 350);
			        vertex(95, 335);
			        endShape();
			        popStyle();
			        
			        fill(70, 70, 70);
			        beginShape();
			        vertex(70, 330);
			        vertex(90, 330);
			        vertex(90, 322);
			        vertex(85, 325);
			        vertex(80, 320);
			        vertex(75, 325);
			        vertex(70, 322);
			        endShape();
			        
			        fill(60, 60, 65);
			        beginShape();
			        vertex(35, 340);
			        vertex(35, 350);
			        vertex(55, 350);
			        bezierVertex(65, 350, 65, 345, 65, 345);
			        bezierVertex(65, 340, 70, 335, 75, 335);
			        vertex(85, 335);
			        bezierVertex(90, 335, 95, 340, 95, 345);
			        bezierVertex(95, 345, 95, 350, 105, 350);
			        vertex(125, 350);
			        vertex(125, 340);
			        vertex(110, 340);
			        bezierVertex(105, 340, 100, 340, 100, 335);
			        bezierVertex(100, 325, 60, 325, 60, 335);
			        bezierVertex(60, 340, 55, 340, 50, 340);
			        endShape();
			    }, stairsIn : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(0, 0, 30, 50);
			        triangle(600, 300, 600, 455, 370, 455);
			        brickFloor();
			        for (var i = 0; i < 30; i++) {
			            fill(25 + sin(i * 15) + cos(i * 5), 25 + sin(i * 15) + cos(i * 5), 30 + sin(i * 15) + cos(i * 5));
			            rect(200 + i * 13.3, 440 - i * 10, 20, 10);
			        }
			        for (var i = 0; i < 20; i++) {
			            light(200 + i * 20, 400 - i * 15.5 + sin(i * 137) * 10, color(255, 255, 255));
			        }
			        light(175, 410, color(255, 255, 255));
			    }, stairsOut : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 290);
			        vertex(50, 295);
			        vertex(100, 335);
			        vertex(200, 350);
			        vertex(300, 345);
			        vertex(450, 380);
			        vertex(600, 370);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        beginShape();
			        vertex(0, 390);
			        vertex(50, 395);
			        vertex(100, 425);
			        vertex(200, 450);
			        vertex(300, 435);
			        vertex(450, 440);
			        vertex(600, 470);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        rock(100, 460, 50, 0);
			        rock(130, 400, 40, 90);
			        rock(420, 420, 60, 75);
			        rock(400, 380, 15, 80);
			        
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 5; i++) {
			            for (var j = 0; j < width / 30; j ++) {
			                dotSize = random(20);
			                ellipse(j * 30 + dotSize * 6, 475 + sin(j * 135 + i * 10) * 25 + i * 20, 10 + i * 5 + dotSize, 10 + i * 5 + dotSize);
			            }
			        }
			        
			        birch(250, 140, 100);
			        birch(270, 160, 80);
			        birch(450, 170, 95);
			        
			        plank(80, 70, 120, 20, 90);
			        noStroke();
			        
			        fill(90, 90, 90);
			        for (var i = 0; i < 7; i++) {
			            rect(0, 150 + i * 15, 50 + i * 30, 15);
			        }
			        
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 70; i++) {
			            ellipse(random(150), 210 + random(40), sin(i * 105) * 10, sin(i * 105) * 10);
			        }
			        
			        rect(20, 200, 40, 10);
			        rect(43, 215, 40, 10);
			        rect(66, 200, 40 ,10); 
			        
			        pushMatrix();
			        translate(0, 235);
			        for (var i = 0; i < width / 40 + 1; i++) {
			            strokeWeight(3);
			            stroke(0, 0, 0, 50);
			            fill(170, 145, 130);
			            if (i < 30) {
			                rotate(0.7);
			            }
			            rect(0, 0, 40, 10);
			            rect(-20, 10, 40, 10);
			            translate(40, 0);
			        }
			        popMatrix();
			        
			        plank(0, 50, 100, 30, 14);
			        plank(80, 70, 90, 20, 190);
			                
			        light(35, 130, color(255, 255, 255));
			        light(5, 135, color(255, 255, 255));
			        light(20, 110, color(255, 255, 255));
			    }, bigTree : function() {
			        background(255, 255, 255, 0);
			        
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 400);
			        vertex(100, 420);
			        vertex(200, 420);
			        vertex(300, 410);
			        vertex(320, 415);
			        vertex(360, 400);
			        vertex(400, 410);
			        vertex(450, 390);
			        vertex(500, 410);
			        vertex(600, 400);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        beginShape();
			        vertex(0, 500);
			        vertex(100, 480);
			        vertex(200, 500);
			        vertex(300, 510);
			        vertex(320, 525);
			        vertex(360, 530);
			        vertex(400, 500);
			        vertex(450, 510);
			        vertex(500, 515);
			        vertex(600, 520);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        rock(100, 450, 50, 0);
			        rock(140, 400, 30, 50);
			        rock(400, 420, 40, 180);
			        rock(420, 500, 20, 95);
			        rock(460, 470, 20, 165);
			        
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 5; i++) {
			            for (var j = 0; j < width / 30; j ++) {
			                dotSize = random(20);
			                ellipse(j * 30 + dotSize * 6, 475 + sin(j * 135 + i * 10) * 25 + i * 20, 10 + i * 5 + dotSize, 10 + i * 5 + dotSize);
			            }
			        }
			        
			        pushMatrix();
			        translate(0, 300);
			        for (var i = 0; i < width / 40 + 1; i++) {
			            strokeWeight(3);
			            stroke(0, 0, 0, 50);
			            fill(170, 145, 130);
			            if (i < 4) {
			                rotate(4);
			            } else if (i < 9) {
			                rotate(-6);
			            } else {
			                rotate(2);
			            }
			            rect(0, 0, 40, 10);
			        
			            rect(-20, 10, 40, 10);
			        
			            translate(40, 0);
			        }
			        popMatrix();
			        
			        leaves(570, 115, 100);
			        leaves(450, 80, 200);
			        
			        pushMatrix();
			        translate(0, 13);
			        fill(50, 35, 25);
			        noStroke();
			        beginShape();
			        vertex(460, 250);
			        bezierVertex(460, 315, 375, 255, 360, 320);
			        bezierVertex(380, 300, 390, 300, 390, 300);
			        bezierVertex(370, 320, 370, 360, 370, 380);
			        bezierVertex(350, 390, 350, 390, 350, 420);
			        bezierVertex(360, 390, 360, 390, 380, 390);
			        bezierVertex(385, 370, 390, 370, 395, 400);
			        bezierVertex(400, 360, 385, 360, 385, 360); 
			        vertex(390, 340);
			        vertex(400, 340);
			        bezierVertex(400, 330, 430, 305, 440, 310);
			        vertex(450, 300);
			        bezierVertex(450, 320, 410, 340, 430, 360);
			        bezierVertex(425, 330, 470, 315, 470, 300);
			        bezierVertex(485, 310, 500, 290, 510, 300);
			        bezierVertex(505, 290, 505, 295, 500, 290);
			        bezierVertex(505, 285, 510, 285, 535, 290);
			        bezierVertex(510, 270, 500, 290, 495, 280);
			        vertex(490, 260);
			        bezierVertex(480, 255, 480, 250, 490, 240);
			        bezierVertex(495, 200, 480, 215, 500, 180);
			        bezierVertex(500, 170, 525, 160, 550, 150);
			        bezierVertex(560, 150, 570, 150, 580, 120);
			        bezierVertex(570, 130, 570, 145, 555, 140);
			        bezierVertex(550, 140, 560, 145, 570, 100);
			        bezierVertex(560, 110, 560, 140, 500, 155);
			        bezierVertex(500, 140, 530, 110, 500, 80);
			        bezierVertex(520, 130, 470, 120, 475, 160);
			        bezierVertex(450, 120, 410, 130, 410, 60);
			        bezierVertex(390, 140, 430, 130, 445, 155);
			        bezierVertex(430, 170, 410, 170, 400, 155);
			        bezierVertex(370, 120, 350, 150, 330, 100);
			        bezierVertex(340, 150, 380, 140, 385, 165);
			        bezierVertex(320, 170, 300, 160, 290, 150);
			        bezierVertex(300, 190, 420, 180, 455, 180);
			        vertex(465, 190);
			        vertex(460, 230);
			        endShape();
			        popMatrix();
			        
			        leaves(300, 160, 100);
			        leaves(320, 100, 130);
			        leaves(500, 120, 60);
			        leaves(400, 130, 120);
			    }, waterfallBridge : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(0, 0, 0, 100);
			        arc(330, 320, 310, 110, 191, 350);
			        fill(100, 100, 100);
			        arc(345, 310, 150, 50, 181, 360);
			        
			        rock(60, 490, 40, 190);
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 400);
			        vertex(100, 380);
			        vertex(190, 370);
			        vertex(200, 430);
			        vertex(160, 500);
			        vertex(130, 600);
			        vertex(0, 600);
			        endShape();
			        beginShape();
			        vertex(540, 500);
			        vertex(480, 470);
			        vertex(465, 430);
			        vertex(455, 400);
			        vertex(500, 380);
			        vertex(550, 400);
			        vertex(600, 430);
			        vertex(600, 600);
			        endShape();
			        
			        beginShape();
			        vertex(0, 450);
			        vertex(80, 430);
			        vertex(170, 400);
			        vertex(180, 430);
			        vertex(130, 500);
			        vertex(70, 600);
			        vertex(0, 600);
			        endShape();
			        beginShape();
			        vertex(580, 500);
			        vertex(510, 470);
			        vertex(495, 430);
			        vertex(490, 420);
			        vertex(530, 410);
			        vertex(580, 450);
			        vertex(600, 450);
			        vertex(600, 600);
			        endShape();
			        
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 5; i++) {
			            for (var j = 0; j < width / 30; j ++) {
			                dotSize = random(20);
			                ellipse(j * 30 + dotSize * 6, 475 + sin(j * 135 + i * 10) * 25 + i * 20, 10 + i * 5 + dotSize, 10 + i * 5 + dotSize);
			            }
			        }
			        
			        rock(100, 460, 60, 30);
			        rock(520, 430, 50, 120);
			        
			        // Stone behind waterfall
			        pushMatrix();
			        translate(15, 0);
			        fill(50, 50, 55);
			        (rect)(215, 330, 210, 270, 30, 10, 0, 0);
			        (rect)(200, 450, 235, 150, 30, 10, 0, 0);
			        fill(255, 255, 255, 40);
			        rect(220, 340, 30, 15, 10);
			        rect(220, 360, 190, 20, 5);
			        rect(385, 335, 35, 20, 5);
			        quad(220, 390, 420, 385, 415, 430, 220, 415);
			        quad(220, 430, 420, 440, 380, 580, 210, 590);
			        rect(395, 560, 35, 20, 5);
			        rect(350, 585, 80, 10, 10);
			        
			        // Foliage
			        
			        // Birch trees
			        birch(150, 200, 90);
			        birch(180, 210, 75);
			        
			        // Right
			        greenLeaves(380, 410, -5, 80);
			        leaf(390, 420, -10, 70);
			        greenLeaves(400, 440, 0, 100);
			        greenLeaves(395, 470, 5, 80);
			        greenLeaves(400, 500, -5, 120);
			        greenLeaves(410, 530, -15, 115);
			        leaf(415, 540, 5, 130);
			        leaf(430, 550, -15, 125);
			        grass(420, 600, 60, 120, 8);
			        grass(380, 600, 60, 80, 6);
			        grass(400, 600, 60, 150, 4);
			        
			        // Left
			        greenLeaves(230, 400, 15, 100);
			        greenLeaves(225, 450, 10, 130);
			        leaf(230, 480, 15, 140);
			        greenLeaves(220, 510, 5, 120);
			        leaf(215, 530, 10, 130);
			        grass(230, 600, 80, 100, 7);
			        grass(220, 600, 70, 130, 9);
			        grass(200, 600, 50, 80, 4);
			        
			        // Waterfall
			        fill(60, 80, 110);
			        quad(255, 310, 405, 310, 415, 330, 245, 330);
			        for (var i = 0; i < 5; i++) {
			            beginShape();
			            vertex(255 + i * 30, 310);
			            bezierVertex(260 + i * 30, 310, 265 + i * 30, 310, 270 + i * 30, 305);
			            bezierVertex(275 + i * 30, 310, 280 + i * 30, 310, 285 + i * 30, 310);
			            endShape();
			        }
			        strokeWeight(1);
			        for (var i = 0; i < 10; i++) {
			            stroke(255, 255, 255, i * 1.5);
			            line(255 - i, 320 + i, 405 + i, 320 + i);
			        }
			        
			        popMatrix();
			        
			        pushMatrix();
			        translate(0, 300);
			        for (var i = 0; i < width / 40 + 1; i++) {
			            strokeWeight(3);
			            stroke(0, 0, 0, 50);
			            fill(170, 145, 130);
			            if (i < 3) {
			                rotate(1);
			            } else if (i < 6) {
			                rotate(-10);
			            } else if (i < 13) {
			                rotate(8);
			            } else {
			                rotate(-15);
			            }
			            rect(0, 0, 40, 10);
			            rect(-20, 10, 40, 10);
			            translate(40, 0);
			        }
			        popMatrix();
			        
			        light(320, 305, color(255, 255, 255));
			        light(360, 315, color(255, 255, 255));
			        light(380, 305, color(255, 255, 255));
			    }, brickEnd : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(120, 95, 80, 100);
			        triangle(0, 305, 150, 400, 0, 500);
			    
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 360);
			        vertex(50, 370);
			        vertex(100, 355);
			        vertex(200, 380);
			        vertex(300, 375);
			        vertex(450, 385);
			        vertex(600, 420);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        beginShape();
			        vertex(0, 460);
			        vertex(50, 450);
			        vertex(100, 455);
			        vertex(200, 470);
			        vertex(300, 465);
			        vertex(450, 475);
			        vertex(600, 470);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 5; i++) {
			            for (var j = 0; j < width / 30; j ++) {
			                dotSize = random(20);
			                ellipse(j * 30 + dotSize * 6, 475 + sin(j * 145 + i * 10) * 25 + i * 20, 10 + i * 5 + dotSize, 10 + i * 5 + dotSize);
			            }
			        }
			        
			        birch(100, 160, 130);
			        
			        plank(240, 305, 30, 10, 95);
			        plank(340, 308, 30, 10, 85);
			        plank(440, 311, 30, 10, 90);
			        plank(540, 314, 30, 10, 85);
			        plank(200, 290, 380, 20, 2);
			
			        
			        pushMatrix();
			        translate(0, 280);
			        rotate(10);
			        for (var i = 0; i < 5; i++) {
			            strokeWeight(3);
			            stroke(0, 0, 0, 50);
			            fill(170, 145, 130);
			            if (i < 3) {
			                rotate(2);
			            } 
			            rect(0, 0, 40, 10);
			            rect(-20, 10, 40, 10);
			            translate(40, 0);
			        }
			        popMatrix();
			    }, cypressRuins : function() {
			        background(255, 255, 255, 0);
			        
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 400);
			        vertex(100, 415);
			        vertex(200, 405);
			        vertex(250, 420);
			        vertex(350, 445);
			        vertex(520, 390);
			        vertex(600, 400);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        beginShape();
			        vertex(0, 510);
			        vertex(100, 500);
			        vertex(200, 505);
			        vertex(250, 490);
			        vertex(350, 535);
			        vertex(520, 520);
			        vertex(600, 480);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			            
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 5; i++) {
			            for (var j = 0; j < width / 30; j ++) {
			                dotSize = random(20);
			                ellipse(j * 30 + dotSize * 6, 475 + sin(j * 185 + i * 10) * 25 + i * 20, 10 + i * 3 + dotSize, 10 + i * 3 + dotSize);
			            }
			        }
			        
			        cypress(80, 275, 35, 120);
			        cypress(120, 268, 35, 130);
			        cypress(180, 272, 35, 125);
			        
			        light(70, 300, color(255, 255, 255));
			        light(100, 320, color(255, 255, 255));
			        light(120, 290, color(255, 255, 255));
			    }, ladderPumpkins : function() {
			        background(255, 255, 255, 0);
			        
			        light(360, 30, color(255, 255, 255));
			        light(350, 45, color(255, 255, 255));
			        light(365, 50, color(255, 255, 255));
			        light(425, 35, color(255, 255, 255));
			        light(430, 45, color(255, 255, 255));
			        
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 450);
			        vertex(100, 465);
			        vertex(200, 445);
			        vertex(250, 440);
			        vertex(350, 460);
			        vertex(520, 470);
			        vertex(600, 455);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        beginShape();
			        vertex(0, 530);
			        vertex(100, 515);
			        vertex(200, 525);
			        vertex(250, 540);
			        vertex(350, 530);
			        vertex(520, 520);
			        vertex(600, 540);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 5; i++) {
			            for (var j = 0; j < width / 30; j ++) {
			                dotSize = random(20);
			                ellipse(j * 30 + dotSize * 6, 475 + sin(j * 245 + i * 215) * 25 + i * 20, 10 + i * 5 + dotSize, 10 + i * 5 + dotSize);
			            }
			        }
			        
			        pumpkin(160, 360, 40, 40, -5);
			        pumpkin(180, 355, 50, 50, -5);
			        pumpkin(210, 365, 40, 30, 5);
			        
			        plank(130, 330, 50, 15, 80);
			        plank(250, 330, 50, 14, 95);
			        plank(125, 360, 120, 13, 0);
			    }, girlTransition : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(0, 0, 0, 70);
			        beginShape();
			        vertex(0, 470);
			        vertex(100, 465);
			        vertex(200, 445);
			        vertex(250, 450);
			        vertex(350, 435);
			        vertex(520, 450);
			        vertex(600, 440);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        beginShape();
			        vertex(0, 530);
			        vertex(100, 525);
			        vertex(200, 535);
			        vertex(250, 545);
			        vertex(350, 550);
			        vertex(520, 540);
			        vertex(600, 540);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			        
			        fill(0, 0, 0, 20);
			        for (var i = 0; i < 5; i++) {
			            for (var j = 0; j < width / 30; j ++) {
			                dotSize = random(20);
			                ellipse(j * 30 + dotSize * 6, 475 + sin(j * 230 + i * 120) * 25 + i * 20, 10 + i * 5 + dotSize, 10 + i * 5 + dotSize);
			            }
			        }
			        
			        cypress(80, 275, 40, 140);
			        cypress(130, 265, 40, 160);
			        
			        cypress(280, 270, 40, 150);
			        cypress(335, 255, 40, 175);
			        cypress(380, 280, 40, 135);
			    }, willowDock : function() {
			        background(255, 255, 255, 0);
			        
			        noStroke();
			        fill(0, 0, 0, 70);
			        ellipse(590, 440, 220, 260);
			        ellipse(590, 440, 340, 320);
			        beginShape();
			        vertex(0, 400);
			        vertex(100, 400);
			        vertex(50, 500);
			        vertex(10, 600);
			        vertex(0, 600);
			        endShape();
			        beginShape();
			        vertex(0, 400);
			        vertex(60, 400);
			        vertex(20, 500);
			        vertex(5, 600);
			        vertex(0, 600);
			        endShape();
			        
			        noFill();
			        stroke(10, 60, 40);
			        strokeCap(ROUND);
			        strokeWeight(15);
			        for (var i = 0; i < 5; i++) {
			            arc(590, 440, 405 - i * 10, 400 - i * 20, 180 + sin(i * 179) * 20, 300);
			        }
			        for (var i = 0; i < 10; i++) {
			            strokeWeight(10 + sin(i * 167) * 2);
			            line(590 + sin(i * 10 - 90) * 200, 440 - cos(i * 10 - 90) * 200, 590 + sin(i * 10 - 90) * 200, 440 + sin(i * 273) * 50);
			        }
			        line(0, 405, 130, 405);
			        line(20, 405, 20, 470);
			        line(50, 405, 50, 435);
			        line(70, 405, 70, 460);
			        line(90, 405, 90, 440);
			        line(120, 405, 120, 480);
			        
			        light(240, 320, color(255, 255, 255));
			        light(320, 325, color(255, 255, 255));
			        light(270, 350, color(255, 255, 255));
			        light(340, 400, color(255, 255, 255));
			        light(330, 405, color(255, 255, 255));
			        light(270, 410, color(255, 255, 255));
			        light(290, 420, color(255, 255, 255));
			        light(275, 430, color(255, 255, 255));
			        plank(220, 390, 220, 30, 90);
			        plank(0, 375, 320, 15, 0);
			        plank(320, 402, 320, 15, 180);
			        
			        willow(425, 80, 100);
			        
			        noStroke();
			        fill(0, 0, 0, 10);
			        ellipse(320, 630, 100, 180);
			    }, waterGround : function() {
			        noStroke();
			        background(255, 255, 255, 0);
			        fill(0, 0, 50, 50);
			        (rect)(0, 550, 100, 50, 0, 30, 0, 0);
			        (rect)(100, 575, 60, 25, 0, 30, 0, 0);
			        rect(500, 560, 150, 30, 30);
			        
			        noStroke();
			        fill(0, 0, 0, 10);
			        ellipse(320, 30, 100, 180);
			        ellipse(390, 200, 50, 90);
			        ellipse(240, 400, 80, 190);
			    }, darkWastes : function() {
			        noStroke();
			        background(255, 255, 255, 0);
			        fill(10, 10, 15);
			        rect(0, 560, 600, 40);
			        ellipse(10, 560, 40, 70);
			        ellipse(340, 560, 40, 60);
			        ellipse(380, 560, 40, 100);
			        ellipse(200, 560, 300, 15);
			        ellipse(400, 560, 20, 40);
			        
			        fill(45, 40, 35);
			        beginShape();
			        vertex(420, 400);
			        vertex(600, 400);
			        vertex(600, 530);
			        vertex(450, 530);
			        vertex(400, 500);
			        endShape();
			
			        light(75, 500, color(255, 255, 255));
			        light(70, 495, color(255, 255, 255));
			        light(72, 510, color(255, 255, 255));
			        light(35, 505, color(255, 255, 255));
			        light(30, 495, color(255, 255, 255));
			    }, mossGround : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        fill(0, 0, 0, 70);
			        triangle(0, 500, 50, 600, 0, 600);
			        triangle(0, 440, 90, 600, 0, 600);
			        strokeCap(ROUND);
			        strokeJoin(ROUND);
			        strokeWeight(30);
			        noFill();
			        stroke(0, 40, 20);
			        beginShape();
			        vertex(0, 375);
			        vertex(50, 380);
			        vertex(100, 450);
			        vertex(120, 550);
			        vertex(400, 550);
			        vertex(400, 570);
			        endShape();
			        stroke(0, 30, 15);
			        beginShape();
			        vertex(0, 395);
			        vertex(50, 400);
			        vertex(100, 470);
			        vertex(120, 570);
			        vertex(390, 570);
			        vertex(390, 580);
			        endShape();
			        noStroke();
			        cloud2(195, 375, -0.8, 0.9, 70, color(70, 50, 150));
			        cloud2(280, 305, 0.3, 0.5, 110, color(70, 50, 150));
			        cloud2(345, 255, -0.3, 0.5, 105, color(70, 50, 150));
			        cloud2(75, 165, 1, 2, 70, color(70, 50, 150));
			        cloud2(190, 205, 1, 0.5, 105, color(70, 50, 150));
			        cloud2(150, 50, 0.6, 0.5, 90, color(70, 50, 150));
			        cloud2(150, 60, -0.5, 0.5, 110, color(70, 50, 150));
			    }, worldEdge : function() {
			        background(255, 255, 255, 0);
			        cloud2(240, 600, -1, 1, 60, color(255, 180, 140));
			        cloud2(270, 570, -1.2, 1.1, 60, color(255, 180, 140));
			        cloud2(320, 550, -1, 1.5, 70, color(255, 180, 140));
			        cloud2(340, 485, 0.4, 0.5, 110, color(255, 180, 140));
			        cloud2(200, 445, 0.45, 0.5, 110, color(255, 180, 140));
			        cloud2(60, 420, 0.3, 0.4, 110, color(255, 180, 140));
			        cloud2(45, 400, 0.3, 0.4, 110, color(255, 180, 140));
			        cloud2(35, 370, 0.2, 0.5, 110, color(255, 180, 140));
			        cloud2(135, 315, 0.3, 0.5, 110, color(255, 180, 140));
			        cloud2(180, 270, -0.18, 0.25, 200, color(255, 180, 140));
			        cloud2(220, 215, -0.5, 1, 70, color(255, 180, 140));
			        cloud2(230, 190, 0.2, 0.3, 110, color(255, 180, 140));
			        cloud2(300, 145, 0.5, 0.5, 110, color(255, 180, 140));
			    }, hurtCloud : function() {
			        background(255, 255, 255, 0);
			        pushMatrix();
			        translate(450, 410);
			        scale(3, 1.2);
			        cloud(0, 0, 105, color(255, 180, 140));
			        popMatrix();
			        pushMatrix();
			        translate(175, 415);
			        scale(0.9, 1);
			        cloud(0, 0, 105, color(255, 180, 140));
			        popMatrix();
			    }, wallCloud : function() {
			        background(255, 255, 255, 0);
			        pushMatrix();
			        translate(300, 405);
			        scale(4, 1.4);
			        cloud(0, 0, 105, color(255, 180, 140));
			        popMatrix();
			    }, holeCloud : function() {
			        background(255, 255, 255, 0);
			        cloud(240, 420, 110, color(255, 180, 140));
			        pushMatrix();
			        translate(235, 415);
			        scale(-1, 0.5);
			        cloud(0, 0, 80, color(255, 180, 140));
			        popMatrix();
			        pushMatrix();
			        translate(20, 420);
			        scale(-2, 1);
			        cloud(0, 0, 110, color(255, 180, 140));
			        popMatrix();
			        cloud(600, 440, 110, color(255, 180, 140));
			        pushMatrix();
			        translate(600, 460);
			        scale(-1.3, 0.5);
			        cloud(0, 0, 120, color(255, 180, 140));
			        popMatrix();
			    }, ruinsCloud : function() {
			        background(255, 255, 255, 0);
			        pushMatrix();
			        translate(400, 250);
			        deadTree(20, 0, 100);
			        
			        noStroke();
			        fill(80, 80, 85);
			        rect(-60, 100, 120, 80);
			        rect(40, 85, 20, 15, 5);
			        
			        fill(100, 100, 95);
			        rect(-55, 100, 40, 30);
			        rect(-55, 135, 20, 20);
			        rect(-30, 135, 20, 30);
			        rect(-55, 160, 20, 20);
			        rect(-10, 100, 50, 20);
			        rect(45, 110, 10, 10);
			        rect(10, 125, 20, 40);
			        rect(35, 125, 20, 30);
			        rect(35, 160, 20, 20);
			        rect(20, 170, 20, 20);
			        
			        fill(0, 0, 50, 30);
			        rect(-60, 100, 20, 80);
			        rect(40, 100, 20, 80);
			        
			        plank(-65, 100, 130, 10, 0);
			        noStroke();
			        
			        fill(105, 105, 100);
			        ellipse(45, 84, 5, 4);
			        beginShape();
			        vertex(0, 40);
			        vertex(0, 60);
			        vertex(30, 75);
			        vertex(30, 90);
			        vertex(70, 100);
			        bezierVertex(25, 105, -25, 105, -70, 100);
			        bezierVertex(-70, 60, -40, 10, 5, 0);
			        endShape();
			        
			        fill(0, 0, 50, 50);
			        beginShape();
			        vertex(-40, 40);
			        bezierVertex(-45, 50, -45, 60, -45, 70);
			        vertex(-20, 80);
			        vertex(-20, 90);
			        vertex(0, 95);
			        bezierVertex(25, 100, -25, 100, -65, 95);
			        bezierVertex(-65, 80, -50, 40, -40, 40);
			        endShape();
			        ellipse(-10, 30, 5, 5);
			        ellipse(-35, 50, 3, 3);
			        ellipse(-25, 65, 3, 3);
			        ellipse(-30, 70, 4, 4);
			        
			        beginShape();
			        vertex(-20, 20);
			        vertex(-25, 40);
			        vertex(-15, 40);
			        vertex(-15, 55);
			        vertex(-10, 38);
			        vertex(-20, 35);
			        endShape();
			        
			        triangle(0, 80, 5, 85, 10, 70);
			        
			        plank(0, 120, 70, 20, 90);
			        plank(20, 190, 70, -20, -90);
			        
			        noStroke();
			        fill(60, 30, 10);
			        ellipse(-10, 150, 6, 6);
			        rect(-12, 150, 4, 6);
			        
			        lantern(-55, 130, 50);
			        lantern(-45, 125, 40);
			        lantern(50, 135, 60);
			        light(-50, 100, color(255, 240, 0));
			        light(-65, 120, color(255, 240, 0));
			        light(-30, 130, color(255, 240, 0));
			        light(50, 110, color(255, 240, 0));
			        light(70, 140, color(255, 240, 0));
			        popMatrix();
			        
			        pushMatrix();
			        translate(35, 440);
			        scale(-1, 1);
			        cloud(0, 0, 110, color(255, 180, 140));
			        popMatrix();
			        cloud(300, 455, 80, color(255, 180, 140));
			        pushMatrix();
			        translate(470, 460);
			        scale(2, 1);
			        cloud(0, 0, 115, color(255, 180, 140));
			        popMatrix();
			    }, boredCloud : function() {
			        background(255, 255, 255, 0);
			        pushMatrix();
			        translate(160, 460);
			        scale(3, 1);
			        cloud(0, 0, 110, color(70, 50, 150));
			        popMatrix();
			    }, stairsDown : function() {
			        background(255, 255, 255, 0);
			        noStroke();
			        for (var i = 0; i < 20; i++) {
			            fill(25 + sin(i * 35) + cos(i * 5), 25 + sin(i * 35) + cos(i * 5), 30 + sin(i * 35) + cos(i * 5));
			            rect(100 + i * 15, 200 + i * 10, 25, 10);
			        }
			        fill(0, 0, 30, 50);
			        beginShape();
			        vertex(0, 230);
			        vertex(100, 245);
			        vertex(300, 380);
			        vertex(150, 400);
			        vertex(0, 410);
			        endShape();
			        brickFloor();
			    }, brickFloor : function() {
			        background(255, 255, 255, 0);
			        brickFloor();
			    }
			};
			
			// Gets information on images.
			var imageNames = {
			    backgrounds : Object.keys(backgroundLoad),
			    foregrounds : Object.keys(foregroundLoad),
			    setVals : function() {
			        this.length = this.backgrounds.length + this.foregrounds.length;
			        this.percent = (curImg + (loadMode === "foregrounds" ? this.backgrounds.length : 0)) / this.length * 100;
			    }
			};
			
			// Sets specific images to certain scenes.
			var setScenes = function() {
			    backgroundImages = [
			        [
			            [], [], [], [], [], [
			                backgroundLoad.twilightBackground
			            ], [
			                backgroundLoad.twilightBackground
			            ], [
			                backgroundLoad.twilightBackground
			            ], [
			                backgroundLoad.twilightBackground,
			                backgroundLoad.nightShade
			            ], [
			                backgroundLoad.nightBackground
			            ]
			        ], [
			            [
			                backgroundLoad.darkRoom
			            ], [
			                backgroundLoad.stairsInBackground
			            ], [
			                backgroundLoad.dismalBackground
			            ], [
			                backgroundLoad.dismalBackground
			            ], [
			                backgroundLoad.dismalBackground
			            ], [
			                backgroundLoad.dismalTransition,
			                backgroundLoad.grassHill
			            ], [
			                backgroundLoad.dismalHill,
			                backgroundLoad.grassHill,
			                backgroundLoad.statueBackground
			            ], [
			                backgroundLoad.dismalHill,
			                backgroundLoad.grassHill
			            ], [
			                backgroundLoad.dismalHill,
			                backgroundLoad.darkShade,
			                backgroundLoad.grassHill
			            ], [
			                backgroundLoad.swampBackground
			            ], [], [
			                backgroundLoad.twilightBackground
			            ]
			        ], [
			            [
			                backgroundLoad.darkHouse
			            ], [
			                backgroundLoad.darkHouse,
			                backgroundLoad.glowPart
			            ], [
			                backgroundLoad.darkHouse,
			                backgroundLoad.glowFull
			            ], [], [], [], [], [], [], [
			                backgroundLoad.waterBackground
			            ], [
			                backgroundLoad.darkBackground
			            ], [
			                backgroundLoad.nightBackground,
			                backgroundLoad.darkTransition
			            ]
			        ]
			    ];
			    foregroundImages = [
			        [
			            [], [], [], [], [],
			            [
			                foregroundLoad.hurtCloud
			            ], [
			                foregroundLoad.wallCloud
			            ], [
			                foregroundLoad.holeCloud
			            ], [
			                foregroundLoad.ruinsCloud
			            ], [
			                foregroundLoad.boredCloud
			            ]
			        ], [
			            [
			                foregroundLoad.darkRoom
			            ], [
			                foregroundLoad.stairsIn
			            ], [
			                foregroundLoad.stairsOut
			            ], [
			                foregroundLoad.bigTree
			            ], [
			                foregroundLoad.waterfallBridge
			            ], [
			                foregroundLoad.brickEnd
			            ], [
			                foregroundLoad.cypressRuins
			            ], [
			                foregroundLoad.ladderPumpkins
			            ], [
			                foregroundLoad.girlTransition
			            ], [
			                foregroundLoad.willowDock
			            ], [], [
			                foregroundLoad.worldEdge
			            ]
			        ], [
			            [
			                foregroundLoad.stairsDown
			            ], [
			                foregroundLoad.brickFloor
			            ], [
			                foregroundLoad.brickFloor
			            ], [], [], [], [], [], [], [
			                foregroundLoad.waterGround
			            ], [
			                foregroundLoad.darkWastes
			            ], [
			                foregroundLoad.mossGround
			            ]
			        ]
			    ];
			};
			
			// Controls which effects show up in a scene.
			var offsetEffects = 3;
			
			// Lists to control colors and place names.
			var groundColors = [
			    [
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255),
			        color(255, 255, 255)
			    ], [
			        color(20, 20, 30),
			        color(20, 20, 30),
			        color(120, 95, 80),
			        color(120, 95, 80),
			        color(120, 95, 80),
			        color(115, 105, 90),
			        color(115, 105, 90),
			        color(115, 105, 90),
			        color(115, 105, 90),
			        color(100, 90, 85),
			        color(0, 0, 0),
			        color(0, 0, 0)
			    ], [
			        color(20, 20, 30),
			        color(20, 20, 30),
			        color(20, 20, 30),
			        color(0, 0, 0),
			        color(0, 0, 0),
			        color(0, 0, 0),
			        color(0, 0, 0),
			        color(0, 0, 0),
			        color(0, 0, 0),
			        color(80, 110, 95),
			        color(20, 20, 20),
			        color(20, 20, 20)
			    ]
			];
			var placeNames = {
			    "70" : function(color) {
			        scriptFont("ETHEREAL", 0, 0, 400, 400, color);
			    },
			    "01" : function(color) {
			        scriptFont("THE OLD", -430, 10, 270, 250, color);
			        scriptFont("MANSION", 450, 20, 270, 250, color);
			    },
			    "21" : function(color) {
			        scriptFont("BRICK", 0, 290, 420, 250, color);
			        scriptFont("PATH", 0, 390, 520, 250, color);
			    },
			    "51" : function(color) {
			        scriptFont("THE VAST", 0, 310, 350, 250, color);
			        scriptFont("PLAINS", 0, 410, 450, 250, color);
			    },
			    "91" : function(color) {
			        scriptFont("THE DREARY", -90, 20, 250, 250, color);
			        scriptFont("SWAMP", -90, 120, 480, 250, color);
			    },
			    "111" : function(color) {
			        scriptFont("WORLD'S", -400, -10, 300, 250, color);
			        scriptFont("EDGE", 400, 100, 550, 250, color);
			    },
			    "102" : function(color) {
			        scriptFont("THE DARK", 0, 0, 350, 250, color);
			        scriptFont("WASTES", 0, 100, 450, 250, color);
			    }
			};
			var curPlace, placeFade = 0;
			
			// Draw details
			var detailsBefore = function() {
				if (curScene === offsetEffects + 3 && cameraY === 0) {
			        fill(0, 0, 50, 50);
			        noStroke();
			        pushMatrix();
			        translate(blocks[0][6][1].x, blocks[0][6][1].y);
			        triangle(blocks[0][6][1].w / 3 * 2, 0, 0, 0, 0, blocks[0][6][1].h / 2);
			        triangle(blocks[0][6][1].w, blocks[0][6][1].h, blocks[0][6][1].w / 3, blocks[0][6][1].h, blocks[0][6][1].w, blocks[0][6][1].h / 2);
			        ellipse(blocks[0][6][1].w / 2, blocks[0][6][1].h / 2, 10, 10);
			        if (blocks[0][6][1].y === 30) {
			            item(blocks[0][6][1].w / 2, blocks[0][6][1].h / 2, 10, 0, "orb");
			        }
			        popMatrix();
			    } else if (curScene === offsetEffects + 6 && cameraY === 0) {
			        for (var i = 0; i < clouds.length; i++) {
			            cloud(clouds[i].x, clouds[i].y, clouds[i].size, color(20, 10, 130));
			            clouds[i].x -= clouds[i].speed;
			            if (clouds[i].x < -70) {
			                clouds[i].x = width + 70;
			            }
			        }
			    } else if (curScene === offsetEffects - 1 && cameraY === 1) {
			        noStroke();
			        pushMatrix();
			        fill(130, 125, 115);
			        translate(105, 180);
			        ellipse(0, 0, 60, 60);
			        rotate(frameCount);
			        for (var i = 0; i < 10; i++) {
			            rotate(36);
			            quad(-40, -5, -40, 5, 0, 15, 0, -15);
			        }
			        fill(0, 0, 20, 100);
			        ellipse(0, 0, 30, 30);
			        popMatrix();
			        pushMatrix();
			        fill(130, 125, 115);
			        translate(155, 200);
			        ellipse(0, 0, 30, 30);
			        rotate(-frameCount * 2 + 35);
			        for (var i = 0; i < 5; i++) {
			            rotate(72);
			            quad(-20, -3, -20, 3, 0, 5, 0, -5);
			        }
			        fill(0, 0, 20, 100);
			        ellipse(0, 0, 10, 10);
			        popMatrix();
			    } else if (curScene === offsetEffects + 4 && cameraY === 1) {
			        scarecrow(170, 325, 30, -5, 3);
			    } else if (curScene === offsetEffects + 5 && cameraY === 1) {
			        windmill(200, 200, 90);
			    } else if (curScene === offsetEffects + 6 && cameraY === 2) {
			        for (var i = 0; i < fishAll.length; i++) {
			            fishAll[i].pack();
			        }
			    } else if (curScene === offsetEffects + 7 && cameraY === 2) {
			        for (var i = 0; i < rainAll.length; i++) {
			            rainAll[i].pack();
			        }
			        lightningAmount --;
			        if (lightningAmount < 0) {
			            noStroke();
			            fill(255, 255, 255, 150);
			            rect(0, 0, 600, 600);
			        } 
			        if (lightningAmount < -15) {
			            lightningAmount = Math.floor(random(5)) < 1 ? random(20, 40) : random(180, 300);
			        }
			    }
			};
			var detailsAfter = function() {
				if (curScene === offsetEffects + 2 && cameraY === 0) {
			        hurt.pack();
			    } else if (curScene === offsetEffects + 3 && cameraY === 0) {
			        if (player.getItem("orb") !== undefined && player.x < 380 && blocks[0][6][1].y > 30) {
			            blockFlash.mode = "in";
			        }
			        blockFlash.pack(blocks[0][6][1]);
			    } else if (curScene === offsetEffects + 5 && cameraY === 0  && !player.talking) {
			        if (player.x > 380 && player.x < 420) {
			            if (!player.seenLock && !player.open[1]) {
			                player.talking = true;
			                talk.change(
			                    "",
			                    [
			                        "It's locked."
			                    ], [
			                        function() {
			                            player.seenLock = true;
			                            player.talking = false;
			                            talk.mode = "down";
			                        }
			                    ]
			                );
			                talk.mode = "up";
			            } else if (player.seenLock && !player.open[1] && player.getItem("key") !== undefined) {
			                player.talking = true;
			                talk.change(
			                    "",
			                    [
			                        "Cool, the key fits!"
			                    ], [
			                        function() {
			                            player.items.splice(player.getItem("key"), 1);
			                            player.open[1] = true;
			                            player.talking = false;
			                            talk.mode = "down";
			                        }
			                    ]
			                );
			                talk.mode = "up";
			            } else if (player.open[1] && player.leftDoor) {
			                player.talking = true;
			                talk.change(
			                    "Enter?",
			                    [
			                        "Yes",
			                        "No"
			                    ], [
			                        function() {
			                            player.leftDoor = false;
			                            codeButtons.code = "";
			                            sceneChange.reset(codeScene);
			                            player.talking = false;
			                            talk.mode = "down";
			                        }, function() {
			                            player.leftDoor = false;
			                            player.talking = false;
			                            talk.mode = "down";
			                        }
			                    ]
			                );
			                talk.mode = "up";
			            }
			        } else {
			            player.leftDoor = true;
			        }
			    } else if (curScene === offsetEffects + 6 && cameraY === 0) {
			        bored.pack();
			    } else if (curScene === offsetEffects - 3 && cameraY === 1 && player.open[0]) {
			        noStroke();
			        fill(0, 0, 10);
			        rect(50, 350, 60, 100);
			        fill(50, 50, 55);
			        rect(50, 350, 10, 100);
			        if (player.x > 50 && player.x < 110) {
			            player.next.change = true;
			            player.next.axis = "y";
			            player.next.direc = 1;
			            player.talking = true;
			            talk.change(
			                "",
			                [
			                    "I know these stairs..."
			                ], [
			                    function() {
			                        player.talking = false;
			                        talk.mode = "down";
			                    }
			                ]
			            );
			            talk.mode = "up";
			        }
			    } else if (curScene === offsetEffects && cameraY === 1) {
			        if (frameCount % 20 === 0) {
			            flowers.push(new Flower(flowerX, flowerY));
			        }
			        for (var i = flowers.length - 1; i > -1; i--) {
			            flowers[i].move();
			            flowers[i].display();
			            if (flowers[i].dead()) {
			                flowers.splice(i, 1);
			            }
			        }
			        if (player.canFindFlower && player.x < 450 && !foundFlower) {
			            foundFlower = true;
			            player.talking = true;
			            talk.change(
			                "",
			                [
			                    "Guess I should grab a flower..."
			                ], [
			                    function() {
			                        player.items.push("flower");
			                        player.talking = false;
			                        talk.mode = "down";
			                    }
			                ]
			            );
			            talk.mode = "up";
			        }
			    } else if (curScene === offsetEffects + 1 && cameraY === 1) {
			        fill(60, 80, 110);
			        pushMatrix();
			        translate(20, 0);
			        beginShape();
			        vertex(250, 330);
			        vertex(380, 330);
			        bezierVertex(380 + sin(frameCount * 10) * 5, 400, 380 + sin(frameCount * 10 + 90) * 5, 500, 380, 600);
			        vertex(230, 600);
			        bezierVertex(230 + sin(frameCount * 10 + 90) * 5, 500, 230 + sin(frameCount * 10) * 5, 400, 230, 350);
			        bezierVertex(230, 340, 235, 335, 250, 330);
			        endShape();
			        popMatrix();
			        for (var i = 0; i < slivers.length; i++) {
			            slivers[i].display();
			        }
			        for (var i = 0; i < particles.length; i++) {
			            particles[i].display();
			        }
			    } else if (curScene === offsetEffects + 2 && cameraY === 1) {
			        for (var i = 0; i < windLeaves.length; i++) {
			            windLeaves[i].pack();
			        }
			        for (var i = 0; i < windGrassAll[0].length; i++) {
			            windGrassAll[0][i].pack();
			        }
			    } else if (curScene === offsetEffects + 3 && cameraY === 1) {
			        wizard.pack();
			    } else if (curScene === offsetEffects + 5 && cameraY === 1) {
			        girl.pack();
			    } else if (curScene === offsetEffects + 6 && cameraY === 1) {
			        fisherman.pack();
			    } else if (curScene === offsetEffects + 8 && cameraY === 1) {
			        orb.display();
			    } else if (curScene === offsetEffects - 1 && cameraY === 2) {
			        portal(300, 350, 60, color(255, 220, 50), color(80, 190, 255), color(130, 80, 255));
			        if (dist(player.x, player.y, 300, 350) < 40) {
			            sceneChange.reset(creditsPage);
			        }
			    } else if (curScene === offsetEffects + 6 && cameraY === 2) {
			        fishingPole(263, -233, 90);
			        pipe(600, 440);
			    } else if (curScene === offsetEffects + 7 && cameraY === 2) {
			        pipe(0, 440);
			        noStroke();
			        fill(30, 50, 80);
			        beginShape();
			        vertex(40, 460);
			        bezierVertex(50 + sin(frameCount * 10) * 2, 460 + sin(frameCount * 10) * 2, 60+ sin(frameCount * 10 + 90) * 2, 470 + sin(frameCount * 10 + 90) * 2, 60 + sin(frameCount * 10 + 90) * 2, 480 + sin(frameCount * 10 + 90) * 2);
			        bezierVertex(60 + sin(frameCount * 10 + 180) * 2, 500 + sin(frameCount * 10 + 180) * 2, 70 + sin(frameCount * 10 + 270) * 2, 510 + sin(frameCount * 10 + 270) * 2, 70, 520);
			        bezierVertex(80 + sin(frameCount * 10) * 2, 520 + sin(frameCount * 10) * 2, 90 + sin(frameCount * 10 + 90) * 2, 520 + sin(frameCount * 10 + 90) * 2, 90, 530);
			        bezierVertex(90 + sin(frameCount * 10 + 180) * 2, 560 + sin(frameCount * 10 + 180) * 2, 90 + sin(frameCount * 10 + 270) * 2, 580 + sin(frameCount * 10 + 270) * 2, 90, 600);
			        vertex(55, 600);
			        bezierVertex(55 + sin(frameCount * 10 + 270) * 2, 580 + sin(frameCount * 10 + 270) * 2, 55 + sin(frameCount * 10 + 180) * 2, 560 + sin(frameCount * 10 + 180) * 2, 55, 540);
			        bezierVertex(55 + sin(frameCount * 10 + 90) * 2, 525 + sin(frameCount * 10 + 90) * 2, 45 + sin(frameCount * 10) * 2, 520 + sin(frameCount * 10) * 2, 45, 518);
			        bezierVertex(40 + sin(frameCount * 10 + 270) * 2, 510 + sin(frameCount * 10 + 270) * 2, 40 + sin(frameCount * 10 + 180) * 2, 490 + sin(frameCount * 10 + 180) * 2, 40, 480);
			        endShape();
			        strokeWeight(2);
			        stroke(0, 0, 50, 50);
			        bezier(70 + sin(frameCount * 10 + 90) * 2, 600 + sin(frameCount * 10 + 90) * 2, 70 + sin(frameCount * 10 + 180) * 2, 580 + sin(frameCount * 10 + 180) * 2, 65 + sin(frameCount * 10) * 2, 550 + sin(frameCount * 10 + 270) * 2, 65 + sin(frameCount * 10 + 270) * 2, 530 + sin(frameCount * 10) * 2);
			        bezier(80 + sin(frameCount * 10) * 2, 600 + sin(frameCount * 10) * 2, 80 + sin(frameCount * 10 + 90) * 2, 580 + sin(frameCount * 10 + 90) * 2, 75 + sin(frameCount * 10 + 180) * 2, 560 + sin(frameCount * 10 + 180) * 2, 75 + sin(frameCount * 10 + 270) * 2, 550 + sin(frameCount * 10 + 270) * 2);
			        noStroke();
			        drawCharacter(430, 505, "roamer", 0);
			        flame(462, 530, 40, 0);
			        flame(465, 530, 50, 70);
			        flame(470, 530, 70, 230);
			        flame(475, 530, 60, 2190);
			        flame(478, 530, 40, 120);
			        for (var i = 0; i < sparks.length; i++) {
			            sparks[i].display();
			        }
			        speech.pack();
			    }
			};
			
			// THE GAME
			
			// Fix timing
			var moveWithTimeLock = function() {
			    deltaTime = millis() - prevTime;
			    prevTime = millis();
			    
			    if (Math.abs(deltaTime - 1 / 120) < 0.0002) {
			        deltaTime = 1 / 120;
			    }
			    if (Math.abs(deltaTime - 1 / 60) < 0.0002) {
			        deltaTime = 1 / 60;
			    }
			    if (Math.abs(deltaTime - 1 / 30) < 0.0002) {
			        deltaTime = 1 / 30;
			    }
			    
			    // Make sure you don't run too many frames
			    if (deltaTime > 1000) {
			        deltaTime = 1000;
			    }
			    
			    allTime += deltaTime / 1000;
			    
			    while (allTime >= 1 / 60) {
			        frameCount ++;
			        player.move(allTime - 1 < 1 / 60);
			        
			        if (placeNames[curPlace] !== undefined) {
			            if (placeFade < 255) {
			                placeFade += 2;
			            }
			        } else {
			            placeFade = 0;
			        }
			        
			        talk.move();
			        allTime -= 1 / 60;
			    }
			};
			
			// Game function
			game = function() {
			    // Movement
			    moveWithTimeLock();
			    
			    if (player.next.change) {
			        player.next.change = false;
			        placeFade = 0;
			        if (player.next.axis === "x") {
			            curScene += player.next.direc;
			            land.setPoints(level[curScene]);
			            player.x = (-player.next.direc + 1) * 300;
			        } else {
			            cameraY += player.next.direc;
			            level = MAP[cameraY];
			            land.setPoints(level[curScene]);
			            player.y = (-player.next.direc + 1) * 300;
			            if (curScene === offsetEffects - 3 && cameraY === 2) {
			                player.y += 100;
			            }
			        }
			    }
			    
			    // Display
			    background(255, 255, 255);
			    for (var i = 0; i < backgroundImages[cameraY][curScene].length; i++) {
			        image(backgroundImages[cameraY][curScene][i], 0, 0);
			    }
			    for (var i = 0; i < blocks[cameraY][curScene].length; i++) {
			        blocks[cameraY][curScene][i].display();
			    }
			    detailsBefore();
			    land.display(groundColors[cameraY][curScene]);
			    for (var i = 0; i < foregroundImages[cameraY][curScene].length; i++) {
			        image(foregroundImages[cameraY][curScene][i], 0, 0);
			    }
			
			    player.display();
			
			    detailsAfter();
			    
			    if (curScene < offsetEffects - 1 && cameraY === 2) {
			        fill(50, 70, 100, 150);
			        noStroke();
			        beginShape();
			        vertex(0, 380);
			        bezierVertex(200, 380 + sin(frameCount * 3) * 10, 400, 380 + sin(frameCount * 3 + 90) * 10, 600, 380);
			        vertex(600, 600);
			        vertex(0, 600);
			        endShape();
			    }
			    
			    if (curScene > offsetEffects + 2 && curScene < offsetEffects + 6 && cameraY === 1) {
			        for (var i = 0; i < windGrassAll[curScene - 5].length; i++) {
			            windGrassAll[curScene - 5][i].pack();
			        }
			    }
			    
			    curPlace = curScene.toString() + cameraY.toString();
			    
			    if (placeNames[curPlace] !== undefined) {
			        pushMatrix();
			        translate(300, 70);
			        rotate(-2);
			        scale(0.4, 1);
			        rotate(4);
			        strokeWeight(2);
			        pushMatrix();
			        translate(0, 5);
			        placeNames[curPlace](color(0, 0, 0, constrain(map(placeFade, 0, 255, 0, 40), 1, 40)));
			        popMatrix();
			        placeNames[curPlace](color(255, 255, 255, placeFade));
			        popMatrix();
			    }
			    
			    talk.display();
			};
			
			// Resets the game.
			resetGame = function() {
			    flowers = [];
			    curScene = 0;
			    cameraY = 1;
			    level = MAP[cameraY];
			    land = new Land(level[curScene]);
			    codeButtons.code = "";
			    player.reset();
			};
			
			// Draws copyright in the corner.
			var drawCopyright = function(yearStart) {
			    textAlign(RIGHT, BOTTOM);
			    textFont(fonts[0], 10);
			    fill(255, 255, 255, 150);
			    text(yearStart + (yearStart !== year() ? " - " + year() : "") + " Green Ghost", 590, 595);
			};
			
			// The menu
			menu = function() {
			    noStroke();
			    background(255, 255, 255);
			    image(backgroundLoad.dismalBackground, 0, 0);
			    image(backgroundLoad.grassHill, 0, 0);
			    
			    for (var i = 0; i < windLeaves.length; i++) {
			        windLeaves[i].pack();
			    }
			    
			    waveTree(190, 305, 70);
			    waveTree(370, 320, 100);
			    
			    fill(60, 80, 110);
			    noStroke();
			    beginShape();
			    vertex(0, 420);
			    bezierVertex(150, 430 + sin(frameCount * 3) * 5, 350, 460 + sin(frameCount * 3 + 90) * 5, 500, 500);
			    vertex(0, 500);
			    endShape();
			    fill(255, 255, 255, 30);
			    beginShape();
			    vertex(0, 450);
			    bezierVertex(150, 460 + sin(frameCount * 3) * 5, 350, 490 + sin(frameCount * 3 + 90) * 5, 500, 530);
			    vertex(0, 500);
			    endShape();
			    
			    statue(570, 470, 180, 40);
			    noStroke();
			    
			    pushMatrix();
			    translate(150, 0);
			    scale(-1, 1);
			    willow(0, 305, 90);
			    popMatrix();
			    
			    fill(170, 155, 85);
			    noStroke();
			    beginShape();
			    vertex(0, 445);
			    bezierVertex(100, 445, 200, 480, 300, 500);
			    vertex(0, 500);
			    endShape();
			    
			    drawWaves(300, 135, 10, 280, 123);
			    fill(255, 255, 255, 20);
			    rect(0, 0, width, height);
			    
			    title(300, 70, 120);
			    
			    light(65 + sin(frameCount) * 5, 205 - cos(frameCount) * 5, color(255, 255, 255));
			    light(500 + sin(frameCount + 110) * 5, 220 - cos(frameCount + 110) * 5, color(255, 255, 255));
			    light(480 + sin(frameCount + 60) * 5, 240 - cos(frameCount + 60) * 5, color(255, 255, 255));
			    light(455 + sin(frameCount + 230) * 5, 55 - cos(frameCount + 230) * 5, color(255, 255, 255));
			    
			    fill(0, 0, 0, 5);
			    for (var i = 0; i < 30; i++) {
			        ellipse(300, 600, 600 + i * 10, i * 10);
			    }
			    
			    playerRig.setPos(60, 435);
			    playerRig.setDirec("right", 300);
			    playerRig.setRot(0, 0, 70, 110, -35, 40, 0, 0, -20, 20);
			    playerRig.display();
			    
			    noStroke();
			    fill(50, 50, 50);
			    rect(0, 500, 600, 100);
			    
			    noStroke();
			    fill(0, 0, 0, 70);
			    beginShape();
			    vertex(0, 550);
			    vertex(100, 560);
			    vertex(200, 545);
			    vertex(300, 550);
			    vertex(400, 555);
			    vertex(500, 540);
			    vertex(600, 550);
			    vertex(600, 600);
			    vertex(0, 600);
			    endShape();
			    
			    buttons.play.pack();
			    light(120, 570, color(255, 255, 255));
			    light(140, 575, color(255, 255, 255));
			    light(440, 560, color(255, 255, 255));
			    drawCopyright(2019);
			};
			
			// Page after the loading screen.
			continuePage = function() {
			    background(0, 0, 0);
			    strokeWeight(3);
			    scriptFont("<::The::>", 300, 200, 65, 70, color(255, 255, 255));
			    scriptFont("Secret", 300, 245, 100, 100, color(255, 255, 255));
			    scriptFont("World", 300, 300, 115, 100, color(255, 255, 255));
			    strokeWeight(10);
			    scriptFont("<::The::>", 300, 200, 65, 70, color(255, 255, 255, 50));
			    scriptFont("Secret", 300, 245, 100, 100, color(255, 255, 255, 50));
			    scriptFont("World", 300, 300, 115, 100, color(255, 255, 255, 50));
			    for (var i = 0; i < 10; i++) {
			        light(300 + sin(frameCount * 0.7 + i * 273) * 120, 255 + sin(frameCount * 1.2 + i * 141) * 120, color(255, 255, 255));
			    }
			    
			    buttons.cont.pack();
			    
			    if (keys[32] && keys[16]) {
			        image(backgroundLoad.thumbnail, 0, 0);
			    }
			};
			
			// Logo and intro
			var greenGhostLogo = function(x, y, size, color) {
			    noStroke();
			    fill(color);
			    pushMatrix();
			    translate(x, y);
			    scale(size / 600, size / 600);
			    translate(0, -100);
			    beginShape();
			    vertex(-270, 20);
			    bezierVertex(-600, 250, -700, 600, -50, 600);
			    vertex(-125, 400);
			    vertex(-255, 480);
			    bezierVertex(-305, 430, -395, 280, -205, 180);
			    endShape();
			    beginShape();
			    vertex(270, 20);
			    bezierVertex(600, 250, 700, 600, 50, 600);
			    vertex(125, 400);
			    vertex(255, 480);
			    bezierVertex(305, 430, 395, 280, 205, 180);
			    endShape();
			    arc(0, 600, 1200, 1300, 249, 291);
			    popMatrix();
			};
			var intro = (function() {
			    intro = {};
			    intro.messages = [
			        "Where am I...?",
			        "Wake up Benjamin!"
			    ];
			    intro.stars = [];
			    for (var i = 0; i < 150; i++) {
			        intro.stars.push({
			            x : random(width),
			            y : random(height),
			            size : random(2, 5)
			        });
			    }
			    intro.scene = 0;
			    intro.timer = 0;
			    intro.fade = {opac : 255, mode : "out"};
			    intro.logoPos = {x : 0, y : 400};
			    intro.presentPos = {x : 600, y : 100};
			    intro.ripples = [];
			    
			    intro.nextScene = function() {
			        this.timer = 0;
			        this.fade.mode = "in";
			    };
			    
			    intro.pack = function() {
			        background(0, 0, 0);
			        noStroke();
			        this.timer ++;
			        if (this.scene === 0) {
			            strokeWeight(3);
			            scriptFont(this.messages[0], 300, 300, 100, 100, color(255, 255, 255));
			            if (this.timer > 200) {
			                this.nextScene();
			            }
			        } if (this.scene === 1) {
			            strokeCap(ROUND);
			            for (var i = 0; i < this.stars.length; i++) {
			                fill(240, 255, 240, 130 + sin(frameCount * 5 + i * 175) * 50);
			                ellipse(this.stars[i].x + sin(frameCount * 3 + this.stars[i].y) * 5, this.stars[i].y + sin(frameCount * 3 + this.stars[i].x) * 5, this.stars[i].size, this.stars[i].size);
			            }
			            pushMatrix();
			            translate(this.logoPos.x, this.logoPos.y);
			            rotate(sin(frameCount * 2) * 10);
			            greenGhostLogo(0, 0, 170, color(60, 170, 100, 170));
			            popMatrix();
			            this.logoPos.x += 1;
			            this.logoPos.y -= 0.75;
			            if (frameCount % 8 === 0) {
			                this.ripples.push({x : this.logoPos.x - 100, y : this.logoPos.y + 100, size : random(100, 140), opac : 0, change : random(2, 4)});
			            }
			            noFill();
			            for (var i = this.ripples.length - 1; i >= 0; i--) {
			                stroke(60, 170, 100, this.ripples[i].opac * 1.3);
			                strokeWeight(50 - this.ripples[i].size / 6);
			                arc(this.ripples[i].x, this.ripples[i].y, this.ripples[i].size, this.ripples[i].size, 20 + this.ripples[i].opac, 290 - this.ripples[i].opac);
			                this.ripples[i].size += this.ripples[i].change;
			                this.ripples[i].opac += 0.5;
			                if (50 - this.ripples[i].size / 6 <= 0) {
			                    this.ripples.splice(i, 1);
			                }
			            }
			            if (this.timer > 300) {
			                this.nextScene();
			            }
			        } else if (this.scene === 2) {
			            strokeWeight(3);
			            scriptFont(this.messages[1], 300, 300, 90, 100, color(255, 255, 255));
			            if (this.timer > 200) {
			                this.nextScene();
			                this.ripples = [];
			            }
			        } else if (this.scene === 3) {
			            strokeCap(ROUND);
			            for (var i = 0; i < this.stars.length; i++) {
			                fill(240, 255, 240, 130 + sin(frameCount * 5 + i * 175) * 50);
			                ellipse(this.stars[i].x + sin(frameCount * 3 + this.stars[i].y) * 5, this.stars[i].y + sin(frameCount * 3 + this.stars[i].x) * 5, this.stars[i].size, this.stars[i].size);
			            }
			            pushMatrix();
			            translate(this.presentPos.x, this.presentPos.y);
			            rotate(sin(frameCount * 2) * 10);
			            strokeWeight(3);
			            scriptFont("Green Ghost Presents...", 0, 0, 80, 100, color(60, 170, 100, 170));
			            popMatrix();
			            this.presentPos.x -= 1;
			            this.presentPos.y += 0.75;
			            if (frameCount % 8 === 0) {
			                this.ripples.push({x : this.presentPos.x + 80, y : this.presentPos.y, size : random(100, 140), opac : 0, change : random(2, 4)});
			            }
			            noFill();
			            for (var i = this.ripples.length - 1; i >= 0; i--) {
			                stroke(60, 170, 100, this.ripples[i].opac * 1.3);
			                strokeWeight(50 - this.ripples[i].size / 6);
			                arc(this.ripples[i].x, this.ripples[i].y, this.ripples[i].size, this.ripples[i].size, 170 + this.ripples[i].opac, 520 - this.ripples[i].opac);
			                this.ripples[i].size += this.ripples[i].change;
			                this.ripples[i].opac += 0.5;
			                if (50 - this.ripples[i].size / 6 <= 0) {
			                    this.ripples.splice(i, 1);
			                }
			            }
			            if (this.timer > 300) {
			                sceneChange.reset(menu);
			            }
			        } 
			        noStroke();
			        fill(0, 0, 0, this.fade.opac);
			        rect(0, 0, width, height);
			        if (this.fade.mode === "out") {
			            if (this.fade.opac > 0) {
			                this.fade.opac -= 10;
			            }
			        } else {
			            this.fade.opac += 10;
			            if (this.fade.opac > 255) {
			                this.scene ++;
			                this.fade.mode = "out";
			            }
			        }
			    };
			    
			    return intro;
			})();
			introPage = function() {
			    intro.pack();
			    if (click) {
			        sceneChange.reset(menu);
			    }
			};
			
			// Page where the code is.
			codeScene = function() {
			    background(80, 50, 30);
			    noStroke();
			    fill(10, 0, 30, 50);
			    triangle(0, 0, 500, 0, 0, 310);
			    triangle(0, 0, 385, 0, 0, 225);
			    triangle(0, 0, 245, 0, 0, 140);
			    triangle(0, 0, 125, 0, 0, 75);
			    triangle(530, 400, 600, 430, 600, 600);
			    
			    fill(120, 90, 60);
			    quad(30, 390, 530, 390, 700, 600, -100, 600);
			    
			    for (var i = 0; i < 150; i++) {
			        strokeWeight(2 + sin(i * 173));
			        stroke(0, 0, 0, 10 + sin(i * 243) * 5);
			        line(map(i, 0, 150, 30, 530), 420 + sin(i * 213) * 30, map(i, 0, 150, -100, 700), 570 + sin(i * 153) * 30);
			    }
			    
			    candle(100, 400, 100);
			    candle(150, 370, 150);
			    codeButtons.display();
			    buttons.back.pack();
			    
			    talk.move();
			    talk.display();
			};
			
			// Credits at the end of the game.
			credits = (function() {
			    credits = {};
			    credits.messages = [
			        "<THE END>",
			        "::----------------------::",
			        "Story written by Green Ghost",
			        "Game designed by Green Ghost",
			        "All code written by Green Ghost",
			        "::----------------------::",
			        "This game was started in 2018.",
			        "It was finished a year later.",
			        "Released in May, 2019."
			    ];
			    credits.timer = 0;
			    credits.fade = 0;
			    credits.y = 0;
			    credits.speed = 0;
			    
			    credits.pack = function() {
			        background(0, 0, 0);
			        noStroke();
			        this.timer ++;
			        if (this.timer > 60) {
			            this.fade += 4;
			        }
			        if (this.timer > 140) {
			            this.speed += this.speed.smooth(2, 10);
			        }
			        this.y -= this.speed;
			        strokeWeight(3);
			        scriptFont("Wake up Benjamin!", 300, this.y + 270, 80, 80, color(255, 255, 255));
			        scriptFont("Wake up...", 300, this.y + 330, 80, 80, color(255, 255, 255, this.fade));
			        for (var i = 0; i < this.messages.length; i++) {
			            scriptFont(this.messages[i], 300, this.y + 650 + i * 100, 60, 70, color(255, 255, 255));
			        }
			        if (this.y + 650 + this.messages.length * 100 < 300) {
			            sceneChange.reset(continuePage);
			        }
			    };
			    
			    return credits;
			})();
			creditsPage = function() {
			    credits.pack();
			};
			
			// Image loading scene.
			var curLoadName = "";
			var load = function() {
			    try {
			        if (loadMode === "backgrounds") {
			            curLoadName = imageNames.backgrounds[curImg];
			            backgroundLoad[curLoadName]();
			            backgroundLoad[curLoadName] = get(0, 0, width, height);
			            curImg ++;
			        } else if (loadMode === "foregrounds") {
			            curLoadName = imageNames.foregrounds[curImg];
			            foregroundLoad[curLoadName]();
			            foregroundLoad[curLoadName] = get(0, 0, width, height);
			            curImg ++;
			        }
			    } catch (e) {}
			    imageNames.setVals();
			    background(0, 0, 0);
			    textAlign(CENTER, CENTER);
			    textFont(fonts[2], 50);
			    fill(255, 255, 255);
			    text("LOADING" + (function(str) {
			        for (var i = 0; i < Math.floor(frameCount / 10) % 4; i++) {
			            str += ".";
			        }
			        return str;
			    })("") + "\n" + Math.round(imageNames.percent) + "%", 300, 300);
			    textSize(20);
			    text(loadMode.toUpperCase() + " - " + String(curLoadName).toUpperCase(), 300, 540);
			    strokeWeight(30);
			    strokeCap(SQUARE);
			    noFill();
			    stroke(255, 255, 255);
			    arc(300, 300, 350, 350, imageNames.percent * 3.6 / 4, imageNames.percent * 3.6 / 4 * 5);
			    strokeWeight(1);
			    if (loadMode === "backgrounds") {
			        if (curImg >= imageNames.backgrounds.length) {
			            loadMode = "foregrounds";
			            curImg = 0;
			        }
			    } else if (loadMode === "foregrounds") {
			        if (curImg >= imageNames.foregrounds.length) {
			            loaded = true;
			            setScenes();
			        }
			    }
			};
			
			// Current scene.
			scene = continuePage;
			
			// Draw function for animation.
			draw = function() {
			    align = CENTER;
			    if (!loaded) {
			        load();
			    } else {
			        scene();
			        sceneChange.pack();
			    }
			    cursor(overButton ? "pointer" : "default");
			    overButton = false;
			    click = false;
			    if (width !== 600 || height !== 600) {
			        throw {
			            message: "Make sure you change the width and height of the canvas! You can do so in the settings under the canvas, next to the vote button."
			        };
			    }
			};
			
			// Handles mouse clicks.
			mouseClicked = function() {
			    click = true;
			};
			
			// Handles when a key is pressed.
			keyPressed = function() {
			    keys[keyCode] = true;
			};
			
			// Handles when a key is released.
			keyReleased = function() {
			    keys[keyCode] = false;
			};
			
			
			
		}
		
		runPJS(program);
		
		// Add reload button on KA --> <script>
		
	</script>
</body>

</html>